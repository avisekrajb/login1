<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta content="width=device-width, initial-scale=1" name="viewport" />
  <title>Rajbanshi Family Website</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link
   href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
   rel="stylesheet"
  />
  <link
   href="https://fonts.googleapis.com/css2?family=Jokerman&display=swap"
   rel="stylesheet"
  />
  <link
   href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&amp;display=swap"
   rel="stylesheet"
  />
  <link
   href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap"
   rel="stylesheet"
  />
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    emailjs.init("_3mBgareTH6uRd8Jz");
  </script>
  <style>
    body {
     font-family: "Roboto", sans-serif;
    }
    #welcomeHeading {
     font-family: "Jokerman", cursive;
     text-align: left;
     margin-left: 0 !important;
    }
    #sidebar {
     transition: transform 0.3s ease-in-out;
    }
    #sidebar.closed {
     transform: translateX(-100%);
    }
    /* Toast styles */
    .toast {
     position: fixed;
     top: 20px;
     right: 20px;
     padding: 15px 25px;
     border-radius: 4px;
     color: white;
     font-weight: 500;
     box-shadow: 0 4px 12px rgba(0,0,0,0.15);
     z-index: 1000;
     transform: translateX(150%);
     transition: transform 0.3s ease-in-out;
    }
    .toast.show {
     transform: translateX(0);
    }
    .toast.success {
     background-color: #48BB78;
    }
    .toast.error {
     background-color: #F56565;
    }
    .toast.info {
     background-color: #4299E1;
    }
    /* Modal styles */
    .modal {
     display: none;
     position: fixed;
     top: 0;
     left: 0;
     width: 100%;
     height: 100%;
     background-color: rgba(0,0,0,0.5);
     z-index: 1000;
     justify-content: center;
     align-items: center;
    }
    .modal-content {
     background-color: white;
     padding: 25px;
     border-radius: 8px;
     width: 90%;
     max-width: 400px;
     box-shadow: 0 4px 20px rgba(0,0,0,0.15);
     position: relative;
    }
    .close-modal {
     position: absolute;
     top: 10px;
     right: 10px;
     background: none;
     border: none;
     font-size: 20px;
     cursor: pointer;
     color: #666;
    }
    .form-group {
     margin-bottom: 15px;
    }
    .form-group label {
     display: block;
     margin-bottom: 5px;
     font-weight: 500;
     color: #4A5568;
    }
    .form-group input {
     width: 100%;
     padding: 10px;
     border: 1px solid #E2E8F0;
     border-radius: 4px;
     font-size: 16px;
    }
    .form-group input:focus {
     outline: none;
     border-color: #667EEA;
     box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.2);
    }
    .form-actions {
     display: flex;
     justify-content: space-between;
     margin-top: 20px;
    }
    .btn {
     padding: 10px 20px;
     border-radius: 4px;
     font-weight: 500;
     cursor: pointer;
     border: none;
    }
    .btn-primary {
     background-color: #667EEA;
     color: white;
    }
    .btn-secondary {
     background-color: #E2E8F0;
     color: #4A5568;
    }
    .btn-link {
     background: none;
     color: #667EEA;
     text-decoration: underline;
     padding: 0;
    }
    .btn-danger {
     background-color: #F56565;
     color: white;
    }
    .photo-upload {
     display: flex;
     align-items: center;
     margin-top: 10px;
    }
    .photo-preview {
     width: 50px;
     height: 50px;
     border-radius: 50%;
     object-fit: cover;
     margin-right: 15px;
     border: 2px solid #E2E8F0;
    }
    /* Profile table */
    .profile-table {
     width: 100%;
     border-collapse: collapse;
     margin-top: 20px;
    }
    .profile-table th, .profile-table td {
     padding: 12px 15px;
     text-align: left;
     border-bottom: 1px solid #E2E8F0;
    }
    .profile-table th {
     background-color: #F7FAFC;
     font-weight: 600;
     color: #4A5568;
    }
    .profile-table input {
     width: 100%;
     padding: 8px;
     border: 1px solid #E2E8F0;
     border-radius: 4px;
    }
    /* Notification dot */
    .notification-dot {
     position: absolute;
     top: 0;
     right: 0;
     width: 12px;
     height: 12px;
     background-color: #F56565;
     border-radius: 50%;
     border: 2px solid white;
    }
    /* Notification modal */
    .notification-item {
     padding: 10px;
     border-bottom: 1px solid #E2E8F0;
     cursor: pointer;
    }
    .notification-item:hover {
     background-color: #F7FAFC;
    }
    .notification-item.unread {
     background-color: #EBF8FF;
    }
    /* Dashboard styles */
    .dashboard-card {
     background-color: white;
     padding: 20px;
     border-radius: 8px;
     box-shadow: 0 2px 4px rgba(0,0,0,0.1);
     margin-bottom: 20px;
    }
    .dashboard-card h3 {
     font-size: 18px;
     font-weight: 600;
     margin-bottom: 15px;
     color: #4A5568;
    }
    .contacts-modal {
     max-height: 400px;
     overflow-y: auto;
    }
    /* Dropdown styles */
    .dropdown-menu {
     position: absolute;
     right: 0;
     top: 100%;
     margin-top: 10px;
     background: white;
     border-radius: 8px;
     box-shadow: 0 4px 20px rgba(0,0,0,0.15);
     width: 220px;
     z-index: 100;
     transform-origin: top right;
     transform: scale(0.95);
     opacity: 0;
     visibility: hidden;
     transition: all 0.2s ease;
    }
    .dropdown-menu.show {
     transform: scale(1);
     opacity: 1;
     visibility: visible;
    }
    .dropdown-item {
     padding: 10px 15px;
     display: flex;
     align-items: center;
     color: #4A5568;
     transition: all 0.2s;
    }
    .dropdown-item:hover {
     background: #F7FAFC;
     color: #667EEA;
    }
    .dropdown-item i {
     margin-right: 10px;
     width: 20px;
     text-align: center;
    }
    .dropdown-divider {
     height: 1px;
     background: #E2E8F0;
     margin: 5px 0;
    }
    /* Active sessions */
    .session-item {
     display: flex;
     align-items: center;
     padding: 10px;
     border-bottom: 1px solid #E2E8F0;
    }
    .session-info {
     flex: 1;
    }
    .session-current {
     color: #48BB78;
     font-weight: 600;
    }
    /* File size indicator */
    .file-size {
     font-size: 12px;
     color: #718096;
     margin-top: 5px;
    }
    /* Confirmation modal */
    .confirmation-modal {
     text-align: center;
    }
    .confirmation-buttons {
     display: flex;
     justify-content: center;
     gap: 15px;
     margin-top: 20px;
    }
    /* News section styles */
    .mini-photo {
     width: 80px;
     height: 64px;
     object-fit: cover;
     border-radius: 0.125rem;
     flex-shrink: 0;
    }
    .comment-grid {
     display: grid;
     grid-template-columns: repeat(3, 1fr);
     gap: 0.5rem;
    }
    .comment-box {
     padding: 0.5rem;
     border-radius: 0.375rem;
     color: #1a202c;
     font-size: 0.875rem;
     word-break: break-word;
     white-space: nowrap;
     overflow: hidden;
     text-overflow: ellipsis;
    }
    /* Members section styles */
    #photoCarousel {
     scroll-behavior: smooth;
    }
    #photoCarousel::-webkit-scrollbar {
     display: none;
    }
    #photoCarousel {
     -ms-overflow-style: none;
     scrollbar-width: none;
    }
    /* Popup modal */
    #popupModal {
     display: none;
     position: fixed;
     inset: 0;
     background-color: rgba(0,0,0,0.5);
     z-index: 1050;
     align-items: center;
     justify-content: center;
    }
    #popupModal.show {
     display: flex;
    }
    /* Image slider styles */
    .mySlides {
      display: none;
    }
    /* Fading animation */
    .fade {
      animation-name: fade;
      animation-duration: 2s;
    }
    @keyframes fade {
      from {
        opacity: 0.4;
      }
      to {
        opacity: 1;
      }
    }
    .mySlides img {
      width: 800px;
      height: 400px;
      object-fit: cover;
      object-position: center bottom;
    }
    @media (max-width: 640px) {
      .mySlides img {
        width: 100% !important;
        height: auto !important;
        object-position: center bottom;
      }
    }
    .circle-image img {
      width: 200px;
      height: 200px;
      object-fit: cover;
      transition: transform 0.3s ease;
    }
    .circle-image:hover img {
      transform: scale(1.05);
    }
    .dot {
      transition: background-color 0.3s ease;
    }
    .dot:hover {
      background-color: #b91c1c; /* darker red on hover */
    }
    /* Calendar styles */
    .calendar-container {
      background-color: white;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      overflow: hidden;
      margin-bottom: 20px;
    }
    .calendar-header {
      background-color: #667EEA;
      color: white;
      padding: 10px;
      text-align: center;
      font-weight: bold;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .calendar-nav {
      background: none;
      border: none;
      color: white;
      font-size: 16px;
      cursor: pointer;
      padding: 5px 10px;
    }
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 1px;
      background-color: #E2E8F0;
    }
    .calendar-day-header {
      background-color: #F7FAFC;
      padding: 8px;
      text-align: center;
      font-weight: 600;
      color: #4A5568;
    }
    .calendar-day {
      background-color: white;
      padding: 8px;
      min-height: 60px;
      border: 1px solid #E2E8F0;
      position: relative;
    }
    .calendar-day.empty {
      background-color: #F7FAFC;
    }
    .calendar-day.today {
      background-color: #EBF8FF;
      font-weight: bold;
    }
    .calendar-day.birthday {
      background-color: #FEFCBF;
    }
    .calendar-day.festival {
      background-color: #FEB2B2;
    }
    .day-number {
      font-weight: bold;
      margin-bottom: 2px;
    }
    .event-indicator {
      position: absolute;
      bottom: 2px;
      left: 0;
      right: 0;
      text-align: center;
      font-size: 10px;
    }
    .birthday-indicator {
      color: #D69E2E;
    }
    .festival-indicator {
      color: #E53E3E;
    }
    /* Birthday table styles */
    .birthday-table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    .birthday-table th, .birthday-table td {
      padding: 10px;
      text-align: left;
      border-bottom: 1px solid #E2E8F0;
    }
    .birthday-table th {
      background-color: #F7FAFC;
      font-weight: 600;
      color: #4A5568;
    }
    /* Download app button */
    .download-app-btn {
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(135deg, #667EEA 0%, #764BA2 100%);
      color: white;
      padding: 12px;
      border-radius: 8px;
      font-weight: 600;
      margin: 15px 0;
      text-decoration: none;
      transition: transform 0.2s, box-shadow 0.2s;
    }
    .download-app-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    .download-app-btn i {
      margin-right: 8px;
      font-size: 18px;
    }
  </style>
</head>
<body class="flex flex-col min-h-screen bg-gray-50 overflow-x-hidden">
  <!-- Toast container -->
  <div id="toastContainer"></div>

  <!-- Login Modal -->
  <div id="loginModal" class="modal">
   <div class="modal-content">
    <button class="close-modal" id="closeLoginModal">&times;</button>
    <h2 class="text-2xl font-semibold text-indigo-800 mb-6">Login to Your Account</h2>
    <form id="loginForm">
     <div class="form-group">
      <label for="loginEmail">Email</label>
      <input type="email" id="loginEmail" required placeholder="Enter your email">
     </div>
     <div class="form-group">
      <label for="loginPassword">Password</label>
      <input type="password" id="loginPassword" required placeholder="Enter your password">
     </div>
     <div class="form-actions">
      <button type="button" class="btn btn-secondary" id="cancelLoginBtn">Cancel</button>
      <button type="submit" class="btn btn-primary">Login</button>
     </div>
     <div class="mt-4 text-center">
      <span class="text-gray-600">Don't have an account? </span>
      <button type="button" class="btn-link" id="showSignupBtn">Sign up</button>
     </div>
    </form>
   </div>
  </div>

  <!-- Signup Modal -->
  <div id="signupModal" class="modal">
   <div class="modal-content">
    <button class="close-modal" id="closeSignupModal">&times;</button>
    <h2 class="text-2xl font-semibold text-indigo-800 mb-6">Create Your Account</h2>
    <form id="signupForm">
     <div class="form-group">
      <label for="signupName">Full Name</label>
      <input type="text" id="signupName" required placeholder="Enter your full name">
     </div>
     <div class="form-group">
      <label for="signupEmail">Email</label>
      <input type="email" id="signupEmail" required placeholder="Enter your email">
     </div>
     <div class="form-group">
      <label for="signupPhone">Phone Number</label>
      <input type="tel" id="signupPhone" placeholder="Enter your phone number">
     </div>
     <div class="form-group">
      <label>Profile Photo (Max 2MB)</label>
      <div class="photo-upload">
       <img id="photoPreview" class="photo-preview" src="https://via.placeholder.com/50" alt="Profile preview">
       <input type="file" id="photoUpload" accept="image/*" style="display: none;">
       <button type="button" class="btn btn-secondary" id="uploadBtn">Upload Photo</button>
      </div>
      <div class="file-size" id="fileSizeInfo"></div>
     </div>
     <div class="form-group">
      <label for="signupPassword">Password</label>
      <input type="password" id="signupPassword" required placeholder="Create a password">
     </div>
     <div class="form-actions">
      <button type="button" class="btn btn-secondary" id="cancelSignupBtn">Cancel</button>
      <button type="submit" class="btn btn-primary">Sign Up</button>
     </div>
     <div class="mt-4 text-center">
      <span class="text-gray-600">Already have an account? </span>
      <button type="button" class="btn-link" id="showLoginBtn">Login</button>
     </div>
    </form>
   </div>
  </div>

  <!-- Notification Modal -->
  <div id="notificationModal" class="modal">
   <div class="modal-content">
    <button class="close-modal" id="closeNotificationModal">&times;</button>
    <div class="flex justify-between items-center mb-4">
     <h2 class="text-2xl font-semibold text-indigo-800">Notifications</h2>
     <button id="clearNotificationsBtn" class="btn btn-danger">Clear All</button>
    </div>
    <div id="notificationList" class="max-h-80 overflow-y-auto">
     <!-- Notifications will be inserted here -->
    </div>
   </div>
  </div>

  <!-- Contacts Modal -->
  <div id="contactsModal" class="modal">
   <div class="modal-content contacts-modal">
    <button class="close-modal" id="closeContactsModal">&times;</button>
    <h2 class="text-2xl font-semibold text-indigo-800 mb-4">Family Contacts</h2>
    <table class="w-full">
     <thead>
      <tr>
       <th class="text-left py-2">Name</th>
       <th class="text-left py-2">Phone</th>
      </tr>
     </thead>
     <tbody id="contactsList">
      <!-- Contacts will be inserted here -->
     </tbody>
    </table>
   </div>
  </div>

  <!-- Sessions Modal -->
  <div id="sessionsModal" class="modal">
   <div class="modal-content">
    <button class="close-modal" id="closeSessionsModal">&times;</button>
    <h2 class="text-2xl font-semibold text-indigo-800 mb-4">Active Sessions</h2>
    <div id="sessionsList" class="max-h-80 overflow-y-auto">
     <!-- Sessions will be inserted here -->
    </div>
    <div class="mt-4">
     <button id="logoutOtherSessionsBtn" class="btn btn-danger w-full">Logout Other Devices</button>
    </div>
   </div>
  </div>

  <!-- Confirmation Modal -->
  <div id="confirmationModal" class="modal">
    <div class="modal-content confirmation-modal">
      <button class="close-modal" id="closeConfirmationModal">&times;</button>
      <h2 class="text-2xl font-semibold text-indigo-800 mb-4">Are you sure?</h2>
      <p>Do you want to logout?</p>
      <div class="confirmation-buttons">
        <button id="confirmLogoutBtn" class="btn btn-danger">Yes, Logout</button>
        <button id="cancelLogoutBtn" class="btn btn-secondary">No, Stay</button>
      </div>
    </div>
  </div>

  <!-- Member Popup Modal -->
  <div id="popupModal" class="modal">
    <div class="modal-content">
      <button class="close-modal" id="closePopupModal">&times;</button>
      <h3 id="popupTitle" class="text-xl font-semibold mb-4 text-indigo-800"></h3>
      <p class="mb-2"><strong>Age:</strong> <span id="popupAge"></span></p>
      <p class="mb-2"><strong>Phone:</strong> <span id="popupPhone"></span></p>
      <p class="mb-4"><strong>Email:</strong> <span id="popupEmail"></span></p>
      <p id="popupBio" class="mb-4 hidden text-gray-700"></p>
      <button
        id="readMoreBtn"
        class="btn btn-primary"
        onclick="toggleReadMore()"
      >
        Read More
      </button>
    </div>
  </div>

  <header
   class="flex items-center justify-between px-6 py-4 bg-white shadow-md relative z-50"
  >
   <div>
    <h1 class="text-xl font-semibold text-gray-900">Rajbanshi</h1>
   </div>
   <div class="flex items-center space-x-4 relative">
    <div class="text-right -mb-1">
     <h1 class="text-sm font-semibold text-gray-900" id="headerUserName" title=""></h1>
    </div>
    <div
     aria-expanded="false"
     aria-haspopup="true"
     aria-label="User profile menu"
     class="w-10 h-10 rounded-full overflow-hidden border-2 border-indigo-600 cursor-pointer relative"
     id="profileBtn"
     tabindex="0"
    >
     <img
      id="headerProfileImage"
      alt="Profile picture"
      class="w-full h-full object-cover"
      height="64"
      src="https://via.placeholder.com/64"
      width="64"
     />
     <div id="notificationDot" class="notification-dot" style="display: none;"></div>
    </div>
    <div class="dropdown-menu" id="dropdownMenu">
     <a href="#profileSection" class="dropdown-item" id="profileDropdownBtn" style="display: none;">
      <i class="fas fa-user"></i> Profile
     </a>
     <div class="dropdown-item relative" id="notificationDropdownBtn" style="display: none;">
      <i class="fas fa-bell"></i> Notifications
      <span id="notificationCountBadge" class="ml-auto bg-red-500 text-white text-xs px-2 py-1 rounded-full" style="display: none;"></span>
     </div>
     <a href="#dashboardSection" class="dropdown-item" id="dashboardDropdownBtn" style="display: none;">
      <i class="fas fa-tachometer-alt"></i> Dashboard
     </a>
     <a href="#calendarSection" class="dropdown-item" id="calendarDropdownBtn" style="display: none;">
      <i class="fas fa-calendar"></i> Calendar
     </a>
     <a href="#" class="dropdown-item" id="sessionsDropdownBtn" style="display: none;">
      <i class="fas fa-laptop"></i> Active Sessions
     </a>
     <div class="dropdown-divider"></div>
     <a href="#" class="dropdown-item text-red-600 hover:text-red-700" id="logoutDropdownBtn" style="display: none;">
      <i class="fas fa-sign-out-alt"></i> Logout
     </a>
     <a href="#" class="dropdown-item" id="loginLink">
      <i class="fas fa-sign-in-alt"></i> Login
     </a>
     <a href="#" class="dropdown-item" id="signupLink">
      <i class="fas fa-user-plus"></i> Sign Up
     </a>
    </div>
   </div>
  </header>

  <!-- Sidebar -->
  <aside
   id="sidebar"
   class="fixed top-0 left-0 h-full w-64 bg-white shadow-lg border-r border-gray-300 transform -translate-x-full z-50 flex flex-col"
  >
   <div class="flex flex-col h-full">
    <div class="px-6 py-5 border-b border-gray-300 flex items-center justify-between">
     <h2 class="text-2xl font-bold text-indigo-700 font-jokerman">Rajbanshi</h2>
     <button
      id="sidebarCloseBtn"
      aria-label="Close sidebar"
      class="text-gray-600 hover:text-indigo-700 focus:outline-none"
     >
      <i class="fas fa-times fa-lg"></i>
     </button>
    </div>
    <nav id="sidebarNav" class="flex-grow px-6 py-4 space-y-4 overflow-y-auto">
     <!-- Links will be inserted here dynamically -->
    </nav>
    <div class="px-6 py-4 border-t border-gray-300">
     <a href="#" class="download-app-btn" id="downloadAppBtn">
      <i class="fas fa-download"></i>
      <span>Download App</span>
     </a>
     <button
      id="sidebarAuthLink"
      class="flex items-center space-x-3 text-red-600 hover:bg-red-600 hover:text-white font-semibold w-full px-4 py-2 rounded"
      style="display:none"
     >
      <i class="fas fa-sign-out-alt fa-lg"></i><span>Logout</span>
     </button>
    </div>
   </div>
  </aside>

  <nav
   class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-300 shadow-inner z-40"
  >
   <ul class="flex justify-between max-w-md mx-auto px-4">
    <li>
     <button
      aria-label="Show Home section"
      class="flex flex-col items-center justify-center py-2 text-indigo-600 hover:text-indigo-800 focus:outline-none"
      data-section="homeSection"
      type="button"
     >
      <i class="fas fa-home fa-lg"></i>
      <span class="text-xs mt-1 font-medium">Home</span>
     </button>
    </li>
    <li>
     <button
      aria-label="Show Events section"
      class="flex flex-col items-center justify-center py-2 text-gray-600 hover:text-indigo-800 focus:outline-none"
      data-section="eventsSection"
      type="button"
     >
      <i class="fas fa-calendar-alt fa-lg"></i>
      <span class="text-xs mt-1 font-medium">Events</span>
     </button>
    </li>
    <li>
     <button
      aria-label="Show Members section"
      class="flex flex-col items-center justify-center py-2 text-gray-600 hover:text-indigo-800 focus:outline-none"
      data-section="membersSection"
      type="button"
     >
      <i class="fas fa-users fa-lg"></i>
      <span class="text-xs mt-1 font-medium">Members</span>
     </button>
    </li>
    <li>
     <button
      aria-label="Show Dashboard section"
      class="flex flex-col items-center justify-center py-2 text-gray-600 hover:text-indigo-800 focus:outline-none"
      data-section="dashboardSection"
      type="button"
     >
      <i class="fas fa-tachometer-alt fa-lg"></i>
      <span class="text-xs mt-1 font-medium">Dashboard</span>
     </button>
    </li>
    <li>
     <button
      aria-label="Open menu"
      class="flex flex-col items-center justify-center py-2 text-gray-600 hover:text-indigo-800 focus:outline-none"
      id="menuBtn"
      type="button"
     >
      <i class="fas fa-bars fa-lg"></i>
      <span class="text-xs mt-1 font-medium">Menu</span>
     </button>
    </li>
   </ul>
  </nav>

  <main class="flex-grow pt-6 pb-20 px-6 max-w-4xl mx-auto space-y-12">
    <section class="mb-12" id="homeSection">
      <h2 class="text-3xl font-bold text-indigo-700 mb-4" id="welcomeHeading">
        Welcome Guest !!
      </h2>
      <!-- Image slider -->
      <div class="relative h-64 mb-6 overflow-hidden rounded-lg">
        <div class="slideshow-container h-full">
          <div class="mySlides fade h-full">
            <img
              alt="A warm family gathering in a cozy living room with smiles and laughter"
              class="w-full h-full"
              height="400"
              src="https://storage.googleapis.com/a1aa/image/ff725114-5fb8-46fa-f988-97e7585e5709.jpg"
              style=""
              width="800"
            />
          </div>
          <div class="mySlides fade h-full">
            <img
              alt="Family enjoying a sunny picnic outdoors with children playing and adults chatting"
              class="w-full h-full"
              height="400"
              src="https://storage.googleapis.com/a1aa/image/d44ef087-3f5c-4477-ddb6-d3a785299083.jpg"
              style=""
              width="800"
            />
          </div>
          <div class="mySlides fade h-full">
            <img
              alt="Formal family portrait with multiple generations smiling in a garden setting"
              class="w-full h-full"
              height="400"
              src="https://storage.googleapis.com/a1aa/image/a36034d3-3457-4653-511d-dc08e8ce3489.jpg"
              style=""
              width="800"
            />
          </div>
          <div class="mySlides fade h-full">
            <img
              alt="Family cooking together in a bright kitchen, sharing joyful moments"
              class="w-full h-full"
              height="400"
              src="https://storage.googleapis.com/a1aa/image/f710f90b-93b0-490c-fc09-a06d032fed1c.jpg"
              style=""
              width="800"
            />
          </div>
          <div class="mySlides fade h-full">
            <img
              alt="Family on vacation at the beach, children building sandcastles and parents relaxing"
              class="w-full h-full"
              height="400"
              src="https://storage.googleapis.com/a1aa/image/6d1d2aee-e03e-4f21-e9f1-ddc856e09f74.jpg"
              style=""
              width="800"
            />
          </div>
        </div>
        <!-- Dots -->
        <div class="flex justify-center space-x-2 mt-2">
          <span aria-label="Slide 1" class="dot h-3 w-3 rounded-full bg-red-500 cursor-pointer"></span>
          <span aria-label="Slide 2" class="dot h-3 w-3 rounded-full bg-red-500 cursor-pointer"></span>
          <span aria-label="Slide 3" class="dot h-3 w-3 rounded-full bg-red-700 cursor-pointer"></span>
          <span aria-label="Slide 4" class="dot h-3 w-3 rounded-full bg-red-500 cursor-pointer"></span>
          <span aria-label="Slide 5" class="dot h-3 w-3 rounded-full bg-red-500 cursor-pointer"></span>
        </div>
      </div>
      <!-- Marquee -->
      <div class="bg-yellow-200 p-2 mb-6">
        <marquee behavior="scroll" class="text-lg font-semibold" direction="left" id="marqueeText">
          Hello family how are you
        </marquee>
      </div>
      <!-- Circle images with first names 4 per row -->
      <div class="grid grid-cols-4 gap-6 mb-6" style="">
        <div class="flex flex-col items-center space-y-1">
          <div class="rounded-full overflow-hidden h-20 w-20 circle-image shadow-lg">
            <img
              alt="Portrait of a smiling young woman with long brown hair and green eyes"
              src="https://storage.googleapis.com/a1aa/image/dbc46861-8019-45a8-95da-25d6581b9329.jpg"
              style=""
            />
          </div>
          <span class="text-center text-gray-700 font-medium text-sm">Emily</span>
        </div>
        <div class="flex flex-col items-center space-y-1">
          <div class="rounded-full overflow-hidden h-20 w-20 circle-image shadow-lg">
            <img
              alt="Portrait of a middle-aged man with glasses and a friendly smile"
              src="https://storage.googleapis.com/a1aa/image/c30694c7-6765-49a7-18d6-3cbfd7854e04.jpg"
              style=""
            />
          </div>
          <span class="text-center text-gray-700 font-medium text-sm">Michael</span>
        </div>
        <div class="flex flex-col items-center space-y-1">
          <div class="rounded-full overflow-hidden h-20 w-20 circle-image shadow-lg">
            <img
              alt="Portrait of a young boy with curly hair and bright eyes"
              src="https://storage.googleapis.com/a1aa/image/df09939a-ab25-458a-35a0-0e5ad0679ab7.jpg"
              style=""
            />
          </div>
          <span class="text-center text-gray-700 font-medium text-sm">Liam</span>
        </div>
        <div class="flex flex-col items-center space-y-1">
          <div class="rounded-full overflow-hidden h-20 w-20 circle-image shadow-lg">
            <img
              alt="Portrait of an elderly woman with silver hair and a warm smile"
              src="https://storage.googleapis.com/a1aa/image/47800ca3-e9a1-4e0e-09be-8c5e2aaf644b.jpg"
              style=""
            />
          </div>
          <span class="text-center text-gray-700 font-medium text-sm">Grace</span>
        </div>
        <div class="flex flex-col items-center space-y-1">
          <div class="rounded-full overflow-hidden h-20 w-20 circle-image shadow-lg">
            <img
              alt="Portrait of a smiling young woman with short black hair and bright eyes"
              height="200"
              src="https://storage.googleapis.com/a1aa/image/c193c423-1eca-4edd-9680-1e640d578890.jpg"
              style=""
              width="200"
            />
          </div>
          <span class="text-center text-gray-700 font-medium text-sm">Anna</span>
        </div>
        <div class="flex flex-col items-center space-y-1">
          <div class="rounded-full overflow-hidden h-20 w-20 circle-image shadow-lg">
            <img
              alt="Portrait of a cheerful man with short brown hair and glasses"
              height="200"
              src="https://storage.googleapis.com/a1aa/image/8e74485a-af03-4b79-297f-e63b26ba3e56.jpg"
              style=""
              width="200"
            />
          </div>
          <span class="text-center text-gray-700 font-medium text-sm">David</span>
        </div>
        <div class="flex flex-col items-center space-y-1">
          <div class="rounded-full overflow-hidden h-20 w-20 circle-image shadow-lg">
            <img
              alt="Portrait of a young girl with blonde hair and blue eyes"
              height="200"
              src="https://storage.googleapis.com/a1aa/image/4d6f89d2-b8ae-46af-39b7-571b40721249.jpg"
              style=""
              width="200"
            />
          </div>
          <span class="text-center text-gray-700 font-medium text-sm">Sophia</span>
        </div>
        <div class="flex flex-col items-center space-y-1">
          <div class="rounded-full overflow-hidden h-20 w-20 circle-image shadow-lg">
            <img
              alt="Portrait of an elderly man with white hair and a kind smile"
              height="200"
              src="https://storage.googleapis.com/a1aa/image/982818c7-3393-47e0-2718-507e2fe35387.jpg"
              style=""
              width="200"
            />
          </div>
          <span class="text-center text-gray-700 font-medium text-sm">James</span>
        </div>
      </div>
      <!-- Family paragraph with each sentence different color -->
      <p class="mb-6 text-lg leading-relaxed tracking-wide font-serif" style="">
        <span class="text-red-600">Family is where life begins and love never ends.</span>
        <span class="text-green-600">A happy family is but an earlier heaven.</span>
        <span class="text-blue-600">The love of a family is life's greatest blessing.</span>
        <span class="text-purple-600">Families are the compass that guides us.</span>
      </p>
    </section>
   
   <section class="mb-12 hidden" id="profileSection">
    <h2 class="text-2xl font-semibold text-indigo-700 mb-4">Profile</h2>
    <div class="bg-white p-6 rounded-lg shadow-md border border-gray-200">
     <div class="flex flex-col items-center mb-6">
      <img id="profileImage" alt="Profile picture" class="w-32 h-32 rounded-full object-cover border-4 border-indigo-600 mb-4" height="128" src="https://via.placeholder.com/128" width="128" />
      <button id="changeProfileImageBtn" class="btn btn-secondary">Change Photo</button>
      <input type="file" id="profileImageUpload" accept="image/*" style="display: none;">
     </div>
     
     <table class="profile-table">
      <thead>
       <tr>
        <th>Field</th>
        <th>Value</th>
       </tr>
      </thead>
      <tbody>
       <tr>
        <td>Full Name</td>
        <td><input type="text" id="profileName" class="editable-field" value=""></td>
       </tr>
       <tr>
        <td>Email</td>
        <td><input type="email" id="profileEmail" class="editable-field" value=""></td>
       </tr>
       <tr>
        <td>Phone</td>
        <td><input type="tel" id="profilePhone" class="editable-field" value=""></td>
       </tr>
       <tr>
        <td>Password</td>
        <td><input type="password" id="profilePassword" class="editable-field" placeholder="Enter new password"></td>
       </tr>
      </tbody>
     </table>
     
     <div class="mt-6 flex justify-end">
      <button id="saveProfileBtn" class="btn btn-primary">Save Changes</button>
     </div>
    </div>
   </section>
   
<section class="mb-12" id="gallerySection">
    <h2 class="text-3xl font-bold text-indigo-800 mb-8 text-center">Family Memories Gallery</h2>
    
    <!-- Gallery Controls -->
    <div class="flex flex-wrap justify-between items-center mb-8 gap-4">
        <!-- Categories Navigation -->
        <div class="flex flex-wrap gap-3">
            <button class="category-btn px-4 py-2 rounded-full bg-indigo-100 text-indigo-700 font-medium hover:bg-indigo-200 transition-all" data-category="all">All</button>
            <button class="category-btn px-4 py-2 rounded-full bg-indigo-100 text-indigo-700 font-medium hover:bg-indigo-200 transition-all" data-category="father">Father</button>
            <button class="category-btn px-4 py-2 rounded-full bg-indigo-100 text-indigo-700 font-medium hover:bg-indigo-200 transition-all" data-category="mother">Mother</button>
            <button class="category-btn px-4 py-2 rounded-full bg-indigo-100 text-indigo-700 font-medium hover:bg-indigo-200 transition-all" data-category="sister">Sister</button>
            <button class="category-btn px-4 py-2 rounded-full bg-indigo-100 text-indigo-700 font-medium hover:bg-indigo-200 transition-all" data-category="brother">Brother</button>
            <button class="category-btn px-4 py-2 rounded-full bg-indigo-100 text-indigo-700 font-medium hover:bg-indigo-200 transition-all" data-category="videos">Videos</button>
        </div>

        <!-- View Options -->
        <div class="flex items-center gap-3">
            <button id="viewTimelineBtn" class="px-3 py-1 text-sm bg-gray-100 rounded-md hover:bg-gray-200">Timeline View</button>
            <button id="viewGridBtn" class="px-3 py-1 text-sm bg-indigo-100 rounded-md hover:bg-indigo-200">Grid View</button>
            <button id="viewMapBtn" class="px-3 py-1 text-sm bg-gray-100 rounded-md hover:bg-gray-200">Map View</button>
        </div>
    </div>

    <!-- Music Player (for video section) -->
    <div id="musicPlayer" class="hidden mb-6 p-4 bg-indigo-50 rounded-lg">
        <div class="flex items-center gap-4">
            <button id="toggleMusicBtn" class="p-2 bg-white rounded-full shadow-md">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-indigo-600" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15.536a5 5 0 001.414 1.414m2.828-9.9a9 9 0 012.728-2.728" />
                </svg>
            </button>
            <div class="flex-1">
                <p class="text-sm font-medium text-gray-700">Background Music</p>
                <p id="nowPlaying" class="text-xs text-gray-500">Not playing</p>
            </div>
            <audio id="backgroundMusic" loop>
                <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
            </audio>
        </div>
    </div>

    <!-- Slideshow Controls -->
    <div id="slideshowControls" class="hidden mb-6 p-4 bg-indigo-50 rounded-lg">
        <div class="flex items-center gap-4">
            <button id="startSlideshowBtn" class="px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">Start Slideshow</button>
            <div class="flex items-center gap-2">
                <span class="text-sm text-gray-700">Speed:</span>
                <select id="slideshowSpeed" class="text-sm border rounded px-2 py-1">
                    <option value="3000">Slow</option>
                    <option value="2000" selected>Normal</option>
                    <option value="1000">Fast</option>
                </select>
            </div>
            <div class="flex items-center gap-2">
                <span class="text-sm text-gray-700">Transition:</span>
                <select id="slideshowTransition" class="text-sm border rounded px-2 py-1">
                    <option value="fade">Fade</option>
                    <option value="slide" selected>Slide</option>
                    <option value="zoom">Zoom</option>
                </select>
            </div>
        </div>
    </div>

    <!-- Loading Skeleton -->
    <div id="loadingSkeleton" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 mb-8">
        <div class="bg-gray-200 rounded-lg h-48 animate-pulse"></div>
        <div class="bg-gray-200 rounded-lg h-48 animate-pulse"></div>
        <div class="bg-gray-200 rounded-lg h-48 animate-pulse"></div>
        <div class="bg-gray-200 rounded-lg h-48 animate-pulse"></div>
    </div>

    <!-- Gallery Content -->
    <div id="galleryContent">
        <!-- Will be populated by JavaScript -->
    </div>

    <!-- Timeline View Container -->
    <div id="timelineView" class="hidden">
        <!-- Will be populated by JavaScript -->
    </div>

    <!-- Map View Container -->
    <div id="mapView" class="hidden h-96 rounded-lg overflow-hidden">
        <div id="map" class="w-full h-full"></div>
    </div>

    <!-- Lightbox/Popup Viewer -->
    <div id="lightbox" class="fixed inset-0 bg-black bg-opacity-90 z-50 hidden items-center justify-center p-4">
        <button id="closeLightbox" class="absolute top-4 right-4 text-white text-3xl">&times;</button>
        <button id="prevBtn" class="absolute left-4 text-white text-3xl bg-black bg-opacity-50 rounded-full h-12 w-12 flex items-center justify-center">&lt;</button>
        <div class="relative max-w-full max-h-full">
            <img id="lightboxImage" class="max-w-full max-h-screen" src="" alt="">
            <video id="lightboxVideo" class="max-w-full max-h-screen hidden" controls></video>
            <div id="lightboxCaption" class="absolute bottom-0 left-0 right-0 bg-black bg-opacity-70 text-white p-4"></div>
        </div>
        <button id="nextBtn" class="absolute right-4 text-white text-3xl bg-black bg-opacity-50 rounded-full h-12 w-12 flex items-center justify-center">&gt;</button>
        
        <div class="absolute bottom-4 left-0 right-0 flex justify-center gap-4">
            <button id="downloadLightboxBtn" class="bg-white rounded-full p-2 hover:bg-gray-200">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                </svg>
            </button>
            <button id="shareLightboxBtn" class="bg-white rounded-full p-2 hover:bg-gray-200">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z" />
                </svg>
            </button>
            <button id="favoriteLightboxBtn" class="bg-white rounded-full p-2 hover:bg-gray-200">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-red-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                </svg>
            </button>
            <button id="printLightboxBtn" class="bg-white rounded-full p-2 hover:bg-gray-200">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z" />
                </svg>
            </button>
            <button id="arLightboxBtn" class="bg-white rounded-full p-2 hover:bg-gray-200 hidden">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01" />
                </svg>
            </button>
        </div>
    </div>

    <!-- Favorites Section -->
    <div id="favoritesSection" class="hidden mt-12">
        <h3 class="text-2xl font-semibold text-indigo-700 mb-6 border-b pb-2">Your Favorites</h3>
        <div id="favoritesGrid" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4"></div>
    </div>

    <!-- Memory Quiz Modal -->
    <div id="quizModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center p-4">
        <div class="bg-white rounded-lg max-w-md w-full p-6">
            <h3 class="text-xl font-bold mb-4">Memory Quiz</h3>
            <div id="quizContent">
                <p id="quizQuestion" class="mb-4">When was this photo taken?</p>
                <img id="quizImage" src="" alt="Quiz photo" class="w-full h-48 object-cover rounded mb-4">
                <div class="grid grid-cols-2 gap-3">
                    <button class="quiz-option bg-indigo-100 hover:bg-indigo-200 py-2 rounded">2018</button>
                    <button class="quiz-option bg-indigo-100 hover:bg-indigo-200 py-2 rounded">2019</button>
                    <button class="quiz-option bg-indigo-100 hover:bg-indigo-200 py-2 rounded">2020</button>
                    <button class="quiz-option bg-indigo-100 hover:bg-indigo-200 py-2 rounded">2021</button>
                </div>
            </div>
            <div id="quizResult" class="hidden text-center py-4">
                <p id="resultText" class="text-lg font-semibold mb-2"></p>
                <button id="nextQuizBtn" class="mt-4 px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700">Next Question</button>
            </div>
            <button id="closeQuizBtn" class="absolute top-4 right-4 text-gray-500 hover:text-gray-700">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>
    </div>

    <!-- Print Service Modal -->
    <div id="printModal" class="fixed inset-0 bg-black bg-opacity-50 z-50 hidden items-center justify-center p-4">
        <div class="bg-white rounded-lg max-w-md w-full p-6">
            <h3 class="text-xl font-bold mb-4">Order Prints</h3>
            <div class="mb-4">
                <img id="printPreview" src="" alt="Print preview" class="w-full h-48 object-contain mb-4 border">
                <div class="flex items-center justify-between mb-2">
                    <span>Print Size:</span>
                    <select id="printSize" class="border rounded px-2 py-1">
                        <option value="4x6">4x6 inches ($1.99)</option>
                        <option value="5x7">5x7 inches ($2.99)</option>
                        <option value="8x10">8x10 inches ($4.99)</option>
                        <option value="11x14">11x14 inches ($7.99)</option>
                    </select>
                </div>
                <div class="flex items-center justify-between mb-2">
                    <span>Quantity:</span>
                    <input type="number" id="printQuantity" min="1" value="1" class="border rounded px-2 py-1 w-20">
                </div>
                <div class="flex items-center justify-between mb-4">
                    <span class="font-semibold">Total:</span>
                    <span id="printTotal" class="font-semibold">$1.99</span>
                </div>
            </div>
            <div class="flex justify-between">
                <button id="cancelPrintBtn" class="px-4 py-2 bg-gray-200 hover:bg-gray-300 rounded-md">Cancel</button>
                <button id="confirmPrintBtn" class="px-4 py-2 bg-indigo-600 text-white hover:bg-indigo-700 rounded-md">Order Now</button>
            </div>
            <button id="closePrintBtn" class="absolute top-4 right-4 text-gray-500 hover:text-gray-700">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                </svg>
            </button>
        </div>
    </div>

    <style>
        .category-section:not([data-category="all"]) {
            display: none;
        }
        .active-category {
            background-color: #4f46e5 !important;
            color: white !important;
        }
        .download-btn {
            transition: all 0.2s ease;
        }
        .download-btn:hover {
            transform: scale(1.1);
            background-color: white !important;
        }
        .gallery-item {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .gallery-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
        }
        .image-container {
            background: linear-gradient(135deg, #f3f4f6, #e5e7eb);
        }
        .timeline-year {
            position: relative;
            padding-left: 2rem;
        }
        .timeline-year::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: #4f46e5;
            border-radius: 2px;
        }
        .favorite-btn.favorited svg {
            fill: #ef4444;
        }
        #map {
            min-height: 400px;
        }
        .quiz-option.correct {
            background-color: #10b981 !important;
            color: white;
        }
        .quiz-option.incorrect {
            background-color: #ef4444 !important;
            color: white;
        }
    </style>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Sample gallery data with dates and locations
            const galleryData = {
                father: [
                    { 
                        src: "https://source.unsplash.com/random/600x600/?father,man,portrait", 
                        alt: "Father at work conference", 
                        date: "2019-06-15",
                        location: { lat: 40.7128, lng: -74.0060 },
                        tags: ["work", "conference"]
                    },
                    { 
                        src: "https://source.unsplash.com/random/600x600/?father,fishing", 
                        alt: "Father fishing at lake", 
                        date: "2020-08-22",
                        location: { lat: 44.5588, lng: -72.5778 },
                        tags: ["vacation", "hobby"]
                    },
                    { 
                        src: "https://source.unsplash.com/random/600x600/?father,reading", 
                        alt: "Father reading newspaper", 
                        date: "2021-03-10",
                        location: { lat: 34.0522, lng: -118.2437 },
                        tags: ["home", "relaxing"]
                    },
                    { 
                        src: "https://source.unsplash.com/random/600x600/?father,gardening", 
                        alt: "Father gardening in backyard", 
                        date: "2022-05-05",
                        location: { lat: 47.6062, lng: -122.3321 },
                        tags: ["home", "hobby"]
                    }
                ],
                mother: [
                    { 
                        src: "https://source.unsplash.com/random/600x600/?mother,cooking", 
                        alt: "Mother cooking family dinner", 
                        date: "2018-12-24",
                        location: { lat: 41.8781, lng: -87.6298 },
                        tags: ["holiday", "family"]
                    },
                    { 
                        src: "https://source.unsplash.com/random/600x600/?mother,painting", 
                        alt: "Mother painting artwork", 
                        date: "2019-04-15",
                        location: { lat: 32.7157, lng: -117.1611 },
                        tags: ["hobby", "art"]
                    },
                    { 
                        src: "https://source.unsplash.com/random/600x600/?mother,flowers", 
                        alt: "Mother with flowers in garden", 
                        date: "2020-07-08",
                        location: { lat: 45.5231, lng: -122.6765 },
                        tags: ["garden", "spring"]
                    },
                    { 
                        src: "https://source.unsplash.com/random/600x600/?mother,reading", 
                        alt: "Mother reading bedtime story", 
                        date: "2021-11-20",
                        location: { lat: 39.9526, lng: -75.1652 },
                        tags: ["family", "kids"]
                    }
                ],
                sister: [
                    { 
                        src: "https://source.unsplash.com/random/600x600/?sister,dancing", 
                        alt: "Sister at dance recital", 
                        date: "2018-05-12",
                        location: { lat: 33.4484, lng: -112.0740 },
                        tags: ["performance", "dance"]
                    },
                    { 
                        src: "https://source.unsplash.com/random/600x600/?sister,school", 
                        alt: "Sister's first day of school", 
                        date: "2019-09-03",
                        location: { lat: 29.7604, lng: -95.3698 },
                        tags: ["school", "education"]
                    },
                    { 
                        src: "https://source.unsplash.com/random/600x600/?sister,playing", 
                        alt: "Sister playing soccer", 
                        date: "2020-10-15",
                        location: { lat: 39.7392, lng: -104.9903 },
                        tags: ["sports", "activity"]
                    },
                    { 
                        src: "https://source.unsplash.com/random/600x600/?sister,pets", 
                        alt: "Sister with our new puppy", 
                        date: "2022-02-14",
                        location: { lat: 38.9072, lng: -77.0369 },
                        tags: ["pets", "family"]
                    }
                ],
                brother: [
                    { 
                        src: "https://source.unsplash.com/random/600x600/?brother,soccer", 
                        alt: "Brother's soccer championship", 
                        date: "2018-11-10",
                        location: { lat: 42.3601, lng: -71.0589 },
                        tags: ["sports", "achievement"]
                    },
                    { 
                        src: "https://source.unsplash.com/random/600x600/?brother,studying", 
                        alt: "Brother studying for exams", 
                        date: "2019-12-05",
                        location: { lat: 37.7749, lng: -122.4194 },
                        tags: ["school", "education"]
                    },
                    { 
                        src: "https://source.unsplash.com/random/600x600/?brother,cycling", 
                        alt: "Brother cycling in the park", 
                        date: "2020-06-20",
                        location: { lat: 41.8781, lng: -87.6298 },
                        tags: ["sports", "outdoors"]
                    },
                    { 
                        src: "https://source.unsplash.com/random/600x600/?brother,friends", 
                        alt: "Brother with his friends", 
                        date: "2021-08-30",
                        location: { lat: 34.0522, lng: -118.2437 },
                        tags: ["friends", "summer"]
                    }
                ],
                videos: [
                    { 
                        src: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerJoyrides.mp4", 
                        title: "Beach Vacation 2018", 
                        date: "2018-07-15",
                        location: { lat: 25.7617, lng: -80.1918 },
                        tags: ["vacation", "summer"]
                    },
                    { 
                        src: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerBlazes.mp4", 
                        title: "Mother's Birthday", 
                        date: "2019-05-22",
                        location: { lat: 40.7128, lng: -74.0060 },
                        tags: ["celebration", "family"]
                    },
                    { 
                        src: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerEscapes.mp4", 
                        title: "Family Reunion", 
                        date: "2020-08-10",
                        location: { lat: 39.9526, lng: -75.1652 },
                        tags: ["family", "reunion"]
                    },
                    { 
                        src: "https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/ForBiggerFun.mp4", 
                        title: "Christmas Celebration", 
                        date: "2021-12-25",
                        location: { lat: 47.6062, lng: -122.3321 },
                        tags: ["holiday", "winter"]
                    }
                ]
            };

            // Initialize variables
            let currentView = 'grid';
            let currentMediaIndex = 0;
            let mediaItems = [];
            let favorites = JSON.parse(localStorage.getItem('galleryFavorites')) || [];
            let quizQuestions = [];
            let map;
            let slideshowInterval;
            let observer;

            // DOM elements
            const galleryContent = document.getElementById('galleryContent');
            const loadingSkeleton = document.getElementById('loadingSkeleton');
            const timelineView = document.getElementById('timelineView');
            const mapView = document.getElementById('mapView');
            const favoritesSection = document.getElementById('favoritesSection');
            const favoritesGrid = document.getElementById('favoritesGrid');
            const lightbox = document.getElementById('lightbox');
            const lightboxImage = document.getElementById('lightboxImage');
            const lightboxVideo = document.getElementById('lightboxVideo');
            const lightboxCaption = document.getElementById('lightboxCaption');
            const musicPlayer = document.getElementById('musicPlayer');
            const backgroundMusic = document.getElementById('backgroundMusic');
            const nowPlaying = document.getElementById('nowPlaying');
            const quizModal = document.getElementById('quizModal');
            const printModal = document.getElementById('printModal');

            // Initialize the gallery
            initGallery();

            function initGallery() {
                // Show loading skeleton
                loadingSkeleton.style.display = 'grid';
                galleryContent.style.display = 'none';
                timelineView.style.display = 'none';
                mapView.style.display = 'none';

                // Simulate loading (in real app, you would fetch images here)
                setTimeout(() => {
                    renderGallery();
                    loadingSkeleton.style.display = 'none';
                    galleryContent.style.display = 'block';
                    initEventListeners();
                    initIntersectionObserver();
                    prepareQuizQuestions();
                    renderFavorites();
                    
                    // Show music player only in video category
                    const videoCategoryBtn = document.querySelector('.category-btn[data-category="videos"]');
                    videoCategoryBtn.addEventListener('click', () => {
                        musicPlayer.classList.remove('hidden');
                    });
                    
                    document.querySelector('.category-btn[data-category="all"]').click();
                }, 1000);
            }

            function renderGallery() {
                let html = '';

                // Flatten all media items for lightbox navigation
                mediaItems = [];

                // Render photos for each category
                for (const category in galleryData) {
                    if (category === 'videos') continue;

                    html += `
                        <div class="category-section" data-category="${category}">
                            <h3 class="text-xl font-semibold text-gray-800 mb-4 border-b-2 border-indigo-200 pb-2">${category.charAt(0).toUpperCase() + category.slice(1)}</h3>
                            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4 mb-8">
                                ${galleryData[category].map((item, index) => {
                                    mediaItems.push({ ...item, type: 'image', category });
                                    return `
                                        <div class="relative group gallery-item" data-index="${mediaItems.length - 1}">
                                            <div class="image-container rounded-lg overflow-hidden h-48">
                                                <img class="w-full h-full object-cover lazyload" 
                                                     data-src="${item.src}" 
                                                     src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="
                                                     alt="${item.alt}"
                                                     onerror="this.onerror=null;this.src='https://source.unsplash.com/random/600x600/?${category},family';this.alt='Family photo'">
                                            </div>
                                            <button class="download-btn absolute top-2 right-2 bg-white/80 rounded-full p-2 opacity-0 group-hover:opacity-100 transition-opacity" 
                                                    data-src="${item.src}">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-indigo-700" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
                                                </svg>
                                            </button>
                                            <button class="favorite-btn absolute top-2 left-2 bg-white/80 rounded-full p-2 opacity-0 group-hover:opacity-100 transition-opacity ${isFavorite(mediaItems.length - 1) ? 'favorited' : ''}"
                                                    data-index="${mediaItems.length - 1}">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ${isFavorite(mediaItems.length - 1) ? 'text-red-500 fill-red-500' : 'text-indigo-700'}" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                                                </svg>
                                            </button>
                                            <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-3 opacity-0 group-hover:opacity-100 transition-opacity">
                                                <p class="text-white text-sm truncate">${item.alt}</p>
                                                ${item.tags ? `<div class="flex flex-wrap gap-1 mt-1">${item.tags.map(tag => `<span class="text-xs bg-white/30 text-white px-1 rounded">${tag}</span>`).join('')}</div>` : ''}
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    `;
                }

                // Render videos
                html += `
                    <div class="category-section" data-category="videos">
                        <h3 class="text-xl font-semibold text-gray-800 mb-4 border-b-2 border-indigo-200 pb-2">Videos</h3>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            ${galleryData.videos.map((video, index) => {
                                mediaItems.push({ ...video, type: 'video', category: 'videos' });
                                return `
                                    <div class="bg-gray-100 rounded-xl overflow-hidden shadow-lg hover:shadow-xl transition-shadow gallery-item" data-index="${mediaItems.length - 1}">
                                        <video class="w-full h-64 object-cover family-video lazyload" data-src="${video.src}" poster="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==">
                                            <source src="${video.src}" type="video/mp4">
                                            Your browser does not support the video tag.
                                        </video>
                                        <div class="p-4">
                                            <h4 class="font-medium text-gray-800">${video.title}</h4>
                                            <button class="favorite-btn mt-2 ${isFavorite(mediaItems.length - 1) ? 'text-red-500' : 'text-gray-500'} hover:text-red-500"
                                                    data-index="${mediaItems.length - 1}">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ${isFavorite(mediaItems.length - 1) ? 'fill-red-500' : ''}" viewBox="0 0 24 24" stroke="currentColor">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                                                </svg>
                                            </button>
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;

                galleryContent.innerHTML = html;

                // Render timeline view
                renderTimelineView();

                // Initialize map (will load when map view is selected)
                initMap();
            }

            function renderTimelineView() {
                // Group media items by year
                const itemsByYear = {};
                [...galleryData.father, ...galleryData.mother, ...galleryData.sister, ...galleryData.brother, ...galleryData.videos].forEach(item => {
                    const year = item.date ? item.date.split('-')[0] : 'Unknown';
                    if (!itemsByYear[year]) {
                        itemsByYear[year] = [];
                    }
                    itemsByYear[year].push(item);
                });

                // Sort years in descending order
                const sortedYears = Object.keys(itemsByYear).sort((a, b) => b - a);

                let timelineHtml = '';
                sortedYears.forEach(year => {
                    timelineHtml += `
                        <div class="timeline-year mb-8">
                            <h3 class="text-2xl font-bold text-indigo-700 mb-4">${year}</h3>
                            <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4">
                                ${itemsByYear[year].map(item => {
                                    const index = mediaItems.findIndex(mi => mi.src === item.src);
                                    return `
                                        <div class="relative group gallery-item" data-index="${index}">
                                            ${item.type === 'video' ? `
                                                <div class="bg-gray-100 rounded-lg overflow-hidden h-48 flex items-center justify-center">
                                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-indigo-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                                    </svg>
                                                </div>
                                            ` : `
                                                <div class="image-container rounded-lg overflow-hidden h-48">
                                                    <img class="w-full h-full object-cover" 
                                                         src="${item.src}" 
                                                         alt="${item.alt}"
                                                         onerror="this.onerror=null;this.src='https://source.unsplash.com/random/600x600/?family';this.alt='Family photo'">
                                                </div>
                                            `}
                                            <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-3 opacity-0 group-hover:opacity-100 transition-opacity">
                                                <p class="text-white text-sm">${item.alt}</p>
                                                <p class="text-white text-xs">${item.date || ''}</p>
                                            </div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        </div>
                    `;
                });

                timelineView.innerHTML = timelineHtml;
            }

            function initMap() {
                // Check if Google Maps API is already loaded
                if (typeof google === 'undefined') {
                    // Load Google Maps API
                    const script = document.createElement('script');
                    script.src = `https://maps.googleapis.com/maps/api/js?key=YOUR_API_KEY&callback=initMapCallback`;
                    script.async = true;
                    script.defer = true;
                    document.head.appendChild(script);
                    
                    // Define callback function
                    window.initMapCallback = function() {
                        createMap();
                    };
                } else {
                    createMap();
                }
            }

            function createMap() {
                // Create a map centered on the US
                map = new google.maps.Map(document.getElementById('map'), {
                    zoom: 4,
                    center: { lat: 39.8283, lng: -98.5795 },
                    styles: [
                        {
                            "featureType": "poi",
                            "stylers": [
                                { "visibility": "off" }
                            ]
                        }
                    ]
                });

                // Add markers for all media items with locations
                mediaItems.forEach((item, index) => {
                    if (item.location) {
                        const marker = new google.maps.Marker({
                            position: item.location,
                            map: map,
                            title: item.alt || item.title
                        });
                        
                        // Add click event to open lightbox
                        marker.addListener('click', () => {
                            openLightbox(index);
                        });
                    }
                });
            }

            function initEventListeners() {
                // Category filtering
                const buttons = document.querySelectorAll('.category-btn');
                buttons.forEach(button => {
                    button.addEventListener('click', function() {
                        buttons.forEach(btn => btn.classList.remove('active-category'));
                        this.classList.add('active-category');
                        
                        const category = this.dataset.category;
                        
                        // Show/hide sections based on view
                        if (currentView === 'grid') {
                            document.querySelectorAll('.category-section').forEach(section => {
                                if (category === 'all' || section.dataset.category === category) {
                                    section.style.display = 'block';
                                } else {
                                    section.style.display = 'none';
                                }
                            });
                        }
                        
                        // Show music player only for videos
                        if (category === 'videos') {
                            musicPlayer.classList.remove('hidden');
                        } else {
                            musicPlayer.classList.add('hidden');
                            if (!backgroundMusic.paused) {
                                backgroundMusic.pause();
                                nowPlaying.textContent = 'Not playing';
                            }
                        }
                    });
                });
                
                // View toggles
                document.getElementById('viewGridBtn').addEventListener('click', () => {
                    currentView = 'grid';
                    updateView();
                });
                
                document.getElementById('viewTimelineBtn').addEventListener('click', () => {
                    currentView = 'timeline';
                    updateView();
                });
                
                document.getElementById('viewMapBtn').addEventListener('click', () => {
                    currentView = 'map';
                    updateView();
                });
                
                // Music player
                document.getElementById('toggleMusicBtn').addEventListener('click', function() {
                    if (backgroundMusic.paused) {
                        backgroundMusic.play();
                        nowPlaying.textContent = 'Playing: Family Memories Theme';
                    } else {
                        backgroundMusic.pause();
                        nowPlaying.textContent = 'Not playing';
                    }
                });
                
                // Slideshow controls
                document.getElementById('startSlideshowBtn').addEventListener('click', startSlideshow);
                
                // Lightbox events
                document.getElementById('closeLightbox').addEventListener('click', closeLightbox);
                document.getElementById('prevBtn').addEventListener('click', showPrevMedia);
                document.getElementById('nextBtn').addEventListener('click', showNextMedia);
                document.getElementById('downloadLightboxBtn').addEventListener('click', downloadCurrentMedia);
                document.getElementById('shareLightboxBtn').addEventListener('click', shareCurrentMedia);
                document.getElementById('favoriteLightboxBtn').addEventListener('click', toggleFavoriteLightbox);
                document.getElementById('printLightboxBtn').addEventListener('click', openPrintModal);
                document.getElementById('arLightboxBtn').addEventListener('click', viewInAR);
                
                // Quiz modal events
                document.getElementById('closeQuizBtn').addEventListener('click', () => {
                    quizModal.classList.add('hidden');
                });
                
                document.getElementById('nextQuizBtn').addEventListener('click', showNextQuizQuestion);
                
                // Print modal events
                document.getElementById('cancelPrintBtn').addEventListener('click', () => {
                    printModal.classList.add('hidden');
                });
                
                document.getElementById('closePrintBtn').addEventListener('click', () => {
                    printModal.classList.add('hidden');
                });
                
                document.getElementById('confirmPrintBtn').addEventListener('click', confirmPrintOrder);
                
                // Update print total when quantity or size changes
                document.getElementById('printSize').addEventListener('change', updatePrintTotal);
                document.getElementById('printQuantity').addEventListener('change', updatePrintTotal);
                
                // Gallery item clicks (delegated)
                document.addEventListener('click', function(e) {
                    // Lightbox open
                    const galleryItem = e.target.closest('.gallery-item');
                    if (galleryItem) {
                        const index = parseInt(galleryItem.getAttribute('data-index'));
                        openLightbox(index);
                    }
                    
                    // Favorite button
                    const favoriteBtn = e.target.closest('.favorite-btn');
                    if (favoriteBtn) {
                        e.preventDefault();
                        e.stopPropagation();
                        const index = parseInt(favoriteBtn.getAttribute('data-index'));
                        toggleFavorite(index, favoriteBtn);
                    }
                    
                    // Download button
                    const downloadBtn = e.target.closest('.download-btn');
                    if (downloadBtn) {
                        e.preventDefault();
                        e.stopPropagation();
                        const imageUrl = downloadBtn.getAttribute('data-src');
                        downloadMedia(imageUrl);
                    }
                });
                
                // Keyboard navigation in lightbox
                document.addEventListener('keydown', function(e) {
                    if (!lightbox.classList.contains('hidden')) {
                        if (e.key === 'Escape') {
                            closeLightbox();
                        } else if (e.key === 'ArrowLeft') {
                            showPrevMedia();
                        } else if (e.key === 'ArrowRight') {
                            showNextMedia();
                        }
                    }
                });
            }

            function initIntersectionObserver() {
                // Set up lazy loading with Intersection Observer
                if ('IntersectionObserver' in window) {
                    observer = new IntersectionObserver((entries) => {
                        entries.forEach(entry => {
                            if (entry.isIntersecting) {
                                const lazyElement = entry.target;
                                if (lazyElement.tagName === 'IMG') {
                                    lazyElement.src = lazyElement.dataset.src;
                                } else if (lazyElement.tagName === 'VIDEO') {
                                    lazyElement.querySelector('source').src = lazyElement.dataset.src;
                                    lazyElement.load();
                                }
                                observer.unobserve(lazyElement);
                            }
                        });
                    }, {
                        rootMargin: '100px 0px',
                        threshold: 0.1
                    });

                    document.querySelectorAll('.lazyload').forEach(lazyElement => {
                        observer.observe(lazyElement);
                    });
                } else {
                    // Fallback for browsers without IntersectionObserver
                    document.querySelectorAll('.lazyload').forEach(lazyElement => {
                        if (lazyElement.tagName === 'IMG') {
                            lazyElement.src = lazyElement.dataset.src;
                        } else if (lazyElement.tagName === 'VIDEO') {
                            lazyElement.querySelector('source').src = lazyElement.dataset.src;
                            lazyElement.load();
                        }
                    });
                }
            }

            function updateView() {
                // Update view buttons
                document.getElementById('viewGridBtn').classList.toggle('bg-indigo-100', currentView === 'grid');
                document.getElementById('viewTimelineBtn').classList.toggle('bg-indigo-100', currentView === 'timeline');
                document.getElementById('viewMapBtn').classList.toggle('bg-indigo-100', currentView === 'map');
                
                // Show/hide views
                galleryContent.style.display = currentView === 'grid' ? 'block' : 'none';
                timelineView.style.display = currentView === 'timeline' ? 'block' : 'none';
                mapView.style.display = currentView === 'map' ? 'block' : 'none';
                slideshowControls.classList.toggle('hidden', currentView !== 'grid');
                
                // Show music player only for videos in grid view
                const activeCategory = document.querySelector('.category-btn.active-category').dataset.category;
                musicPlayer.classList.toggle('hidden', !(currentView === 'grid' && activeCategory === 'videos'));
                
                // Initialize map if showing map view
                if (currentView === 'map' && typeof google !== 'undefined' && !map) {
                    initMap();
                }
            }

            function openLightbox(index) {
                currentMediaIndex = index;
                const mediaItem = mediaItems[index];
                
                // Show appropriate media in lightbox
                if (mediaItem.type === 'image') {
                    lightboxImage.src = mediaItem.src;
                    lightboxImage.alt = mediaItem.alt;
                    lightboxImage.classList.remove('hidden');
                    lightboxVideo.classList.add('hidden');
                } else {
                    lightboxVideo.querySelector('source').src = mediaItem.src;
                    lightboxVideo.load();
                    lightboxVideo.classList.remove('hidden');
                    lightboxImage.classList.add('hidden');
                }
                
                // Update caption
                lightboxCaption.textContent = mediaItem.alt || mediaItem.title;
                
                // Update favorite button state
                const favoriteBtn = document.getElementById('favoriteLightboxBtn');
                favoriteBtn.querySelector('svg').classList.toggle('fill-red-500', isFavorite(index));
                
                // Show/hide AR button based on device and media type
                const arBtn = document.getElementById('arLightboxBtn');
                arBtn.classList.toggle('hidden', !isMobile() || mediaItem.type !== 'image');
                
                // Show lightbox
                lightbox.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
            }

            function closeLightbox() {
                // Pause video if playing
                if (!lightboxVideo.paused) {
                    lightboxVideo.pause();
                }
                
                // Hide lightbox
                lightbox.classList.add('hidden');
                document.body.style.overflow = '';
            }

            function showPrevMedia() {
                currentMediaIndex = (currentMediaIndex - 1 + mediaItems.length) % mediaItems.length;
                openLightbox(currentMediaIndex);
            }

            function showNextMedia() {
                currentMediaIndex = (currentMediaIndex + 1) % mediaItems.length;
                openLightbox(currentMediaIndex);
            }

            function isFavorite(index) {
                return favorites.includes(index);
            }

            function toggleFavorite(index, button = null) {
                if (isFavorite(index)) {
                    favorites = favorites.filter(i => i !== index);
                    if (button) {
                        button.classList.remove('favorited');
                        button.querySelector('svg').classList.remove('fill-red-500');
                    }
                } else {
                    favorites.push(index);
                    if (button) {
                        button.classList.add('favorited');
                        button.querySelector('svg').classList.add('fill-red-500');
                    }
                }
                
                // Save to localStorage
                localStorage.setItem('galleryFavorites', JSON.stringify(favorites));
                
                // Update favorites section if visible
                renderFavorites();
            }

            function toggleFavoriteLightbox() {
                toggleFavorite(currentMediaIndex);
                const favoriteBtn = document.getElementById('favoriteLightboxBtn');
                favoriteBtn.querySelector('svg').classList.toggle('fill-red-500', isFavorite(currentMediaIndex));
            }

            function renderFavorites() {
                if (favorites.length === 0) {
                    favoritesGrid.innerHTML = '<p class="col-span-full text-gray-500 text-center py-8">You have no favorites yet. Click the heart icon on photos to add them.</p>';
                    return;
                }
                
                let html = '';
                favorites.forEach(index => {
                    const item = mediaItems[index];
                    html += `
                        <div class="relative group gallery-item" data-index="${index}">
                            ${item.type === 'video' ? `
                                <div class="bg-gray-100 rounded-lg overflow-hidden h-48 flex items-center justify-center">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-indigo-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z" />
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                    </svg>
                                </div>
                            ` : `
                                <div class="image-container rounded-lg overflow-hidden h-48">
                                    <img class="w-full h-full object-cover" 
                                         src="${item.src}" 
                                         alt="${item.alt}"
                                         onerror="this.onerror=null;this.src='https://source.unsplash.com/random/600x600/?family';this.alt='Family photo'">
                                </div>
                            `}
                            <button class="favorite-btn favorited absolute top-2 left-2 bg-white/80 rounded-full p-2 opacity-0 group-hover:opacity-100 transition-opacity"
                                    data-index="${index}">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-red-500 fill-red-500" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                                </svg>
                            </button>
                            <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/70 to-transparent p-3 opacity-0 group-hover:opacity-100 transition-opacity">
                                <p class="text-white text-sm">${item.alt || item.title}</p>
                            </div>
                        </div>
                    `;
                });
                
                favoritesGrid.innerHTML = html;
            }

            function downloadMedia(url) {
                const fileName = url.split('/').pop().split('?')[0] || 'family-memory.jpg';
                const a = document.createElement('a');
                a.href = url;
                a.download = fileName;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            }

            function downloadCurrentMedia() {
                const currentItem = mediaItems[currentMediaIndex];
                downloadMedia(currentItem.src);
            }

            function shareCurrentMedia() {
                const currentItem = mediaItems[currentMediaIndex];
                const shareData = {
                    title: 'Family Memory',
                    text: currentItem.alt || currentItem.title,
                    url: currentItem.src
                };
                
                if (navigator.share) {
                    navigator.share(shareData).catch(err => {
                        console.log('Error sharing:', err);
                        fallbackShare(shareData);
                    });
                } else {
                    fallbackShare(shareData);
                }
            }

            function fallbackShare(shareData) {
                // Fallback for browsers that don't support Web Share API
                const shareUrl = `mailto:?subject=${encodeURIComponent(shareData.title)}&body=${encodeURIComponent(shareData.text + '\n\n' + shareData.url)}`;
                window.open(shareUrl, '_blank');
            }

            function viewInAR() {
                // This is a placeholder - in a real app you would use WebXR or similar
                alert('AR view would open here on mobile devices');
            }

            function prepareQuizQuestions() {
                // Prepare quiz questions from media items with dates
                quizQuestions = mediaItems
                    .filter(item => item.date)
                    .map(item => ({
                        mediaItem: item,
                        correctYear: item.date.split('-')[0],
                        options: generateQuizOptions(item.date.split('-')[0])
                    }));
                
                // Shuffle questions
                quizQuestions = shuffleArray(quizQuestions);
            }

            function generateQuizOptions(correctYear) {
                const correct = parseInt(correctYear);
                const options = [correct];
                
                // Add 3 incorrect options within ±3 years of correct answer
                while (options.length < 4) {
                    const offset = Math.floor(Math.random() * 5) - 2; // -2 to +2
                    const option = correct + offset;
                    if (option !== correct && !options.includes(option) && option > 2000 && option <= new Date().getFullYear()) {
                        options.push(option);
                    }
                }
                
                return shuffleArray(options);
            }

            function showNextQuizQuestion() {
                if (quizQuestions.length === 0) {
                    document.getElementById('quizResult').classList.add('hidden');
                    document.getElementById('quizContent').innerHTML = `
                        <p class="text-center py-4">You've completed all the questions!</p>
                        <button id="restartQuizBtn" class="mt-4 px-4 py-2 bg-indigo-600 text-white rounded-md hover:bg-indigo-700 w-full">Restart Quiz</button>
                    `;
                    document.getElementById('restartQuizBtn').addEventListener('click', () => {
                        prepareQuizQuestions();
                        showNextQuizQuestion();
                    });
                    return;
                }
                
                const question = quizQuestions.pop();
                document.getElementById('quizImage').src = question.mediaItem.src;
                document.getElementById('quizImage').alt = question.mediaItem.alt;
                document.getElementById('quizQuestion').textContent = `When was this ${question.mediaItem.type === 'video' ? 'video' : 'photo'} taken?`;
                
                const optionsContainer = document.querySelector('#quizContent .grid');
                optionsContainer.innerHTML = '';
                
                question.options.forEach(year => {
                    const button = document.createElement('button');
                    button.className = 'quiz-option bg-indigo-100 hover:bg-indigo-200 py-2 rounded';
                    button.textContent = year;
                    button.addEventListener('click', () => checkQuizAnswer(year, question.correctYear));
                    optionsContainer.appendChild(button);
                });
                
                document.getElementById('quizResult').classList.add('hidden');
                document.getElementById('quizContent').classList.remove('hidden');
            }

            function checkQuizAnswer(selectedYear, correctYear) {
                const options = document.querySelectorAll('.quiz-option');
                options.forEach(option => {
                    option.classList.remove('correct', 'incorrect');
                    if (option.textContent === correctYear) {
                        option.classList.add('correct');
                    } else if (option.textContent === selectedYear && selectedYear !== correctYear) {
                        option.classList.add('incorrect');
                    }
                    option.disabled = true;
                });
                
                document.getElementById('resultText').textContent = 
                    selectedYear === correctYear ? 'Correct! 🎉' : `Incorrect. It was ${correctYear}.`;
                document.getElementById('quizContent').classList.add('hidden');
                document.getElementById('quizResult').classList.remove('hidden');
            }

            function startSlideshow() {
                // Stop any existing slideshow
                if (slideshowInterval) {
                    clearInterval(slideshowInterval);
                }
                
                // Get current category
                const activeCategory = document.querySelector('.category-btn.active-category').dataset.category;
                let items = [];
                
                if (activeCategory === 'all') {
                    items = [...document.querySelectorAll('.gallery-item')];
                } else {
                    items = [...document.querySelectorAll(`.category-section[data-category="${activeCategory}"] .gallery-item`)];
                }
                
                if (items.length === 0) return;
                
                // Get slideshow settings
                const speed = parseInt(document.getElementById('slideshowSpeed').value);
                const transition = document.getElementById('slideshowTransition').value;
                
                let currentSlide = 0;
                
                // Open first item in lightbox
                const firstIndex = parseInt(items[0].getAttribute('data-index'));
                openLightbox(firstIndex);
                
                // Start slideshow
                slideshowInterval = setInterval(() => {
                    currentSlide = (currentSlide + 1) % items.length;
                    const index = parseInt(items[currentSlide].getAttribute('data-index'));
                    openLightbox(index);
                    
                    // Apply transition effect
                    if (transition === 'fade') {
                        lightboxImage.style.opacity = '0';
                        setTimeout(() => {
                            lightboxImage.style.opacity = '1';
                            lightboxImage.style.transition = 'opacity 0.5s ease';
                        }, 50);
                    }
                }, speed);
            }

            function openPrintModal() {
                const currentItem = mediaItems[currentMediaIndex];
                if (currentItem.type !== 'image') {
                    alert('Only photos can be printed');
                    return;
                }
                
                document.getElementById('printPreview').src = currentItem.src;
                document.getElementById('printPreview').alt = currentItem.alt;
                updatePrintTotal();
                printModal.classList.remove('hidden');
            }

            function updatePrintTotal() {
                const size = document.getElementById('printSize').value;
                const quantity = parseInt(document.getElementById('printQuantity').value);
                
                const prices = {
                    '4x6': 1.99,
                    '5x7': 2.99,
                    '8x10': 4.99,
                    '11x14': 7.99
                };
                
                const total = (prices[size] * quantity).toFixed(2);
                document.getElementById('printTotal').textContent = `$${total}`;
            }

            function confirmPrintOrder() {
                const size = document.getElementById('printSize').value;
                const quantity = parseInt(document.getElementById('printQuantity').value);
                const total = document.getElementById('printTotal').textContent;
                
                // In a real app, this would submit to a print service API
                alert(`Print order confirmed!\n\nSize: ${size}\nQuantity: ${quantity}\nTotal: ${total}\n\n(Simulated order - this would connect to a print service in production)`);
                printModal.classList.add('hidden');
            }

            function isMobile() {
                return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            }

            function shuffleArray(array) {
                const newArray = [...array];
                for (let i = newArray.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
                }
                return newArray;
            }
        });
    </script>
</section>
   
   <section class="mb-12 hidden" id="newsSection">
    <h2 class="text-2xl font-semibold text-indigo-700 mb-4">News</h2>
    <ul class="space-y-6 text-gray-700" id="newsList">
      <li class="bg-white p-4 rounded-lg shadow-md border border-gray-200 relative" data-id="1" style="">
        <h3 class="font-semibold text-lg text-indigo-800 mb-1 flex justify-between items-start">
          Family Reunion Recap
          <img alt="Square mini photo of a joyful family reunion outdoors with multiple generations smiling and interacting" class="mini-photo ml-4" src="https://storage.googleapis.com/a1aa/image/d735fa41-59db-4904-6abb-0c5c66727818.jpg" width="80" height="64">
        </h3>
        <p class="text-sm mb-4 text-indigo-600">August 15, 2024</p>
        <p class="italic font-serif">
          वार्षिक पारिवारिक भेटघाट ठूलो सफल रह्यो जहाँ ५० भन्दा बढी सदस्यहरू सहभागी भए। मुख्य आकर्षणहरूमा खेलहरू, साझा भोजन, र कथावाचन समावेश थिए।
        </p>
        <div class="mt-4 flex space-x-6 text-indigo-600 items-center">
          <button aria-label="Like" class="like-btn flex items-center space-x-2 hover:text-indigo-800 focus:outline-none cursor-pointer">
            <i class="fas fa-heart text-gray-600"></i>
            <span class="text-sm">Like</span>
            <span class="ml-1 like-count text-sm">0</span>
          </button>
          <button aria-label="Comment" class="comment-btn flex items-center space-x-2 hover:text-indigo-800 focus:outline-none cursor-pointer">
            <i class="fas fa-comment text-gray-600"></i>
            <span class="text-sm">Comment</span>
            <span class="ml-1 comment-count text-sm">0</span>
          </button>
          <button aria-label="Share" class="share-btn flex items-center space-x-2 hover:text-indigo-800 focus:outline-none cursor-pointer">
            <i class="fas fa-share text-gray-600"></i>
            <span class="text-sm">Share</span>
          </button>
        </div>
        <div class="comment-section mt-4 hidden">
          <textarea rows="3" maxlength="10" class="w-full p-2 border border-gray-300 rounded-md resize-none" placeholder="Write a comment (max 10 chars)"></textarea>
          <div class="mt-2 flex justify-between items-center">
            <button class="send-comment-btn bg-indigo-600 text-white px-4 py-1 rounded hover:bg-indigo-700 focus:outline-none">
              Send
            </button>
            <button class="hide-comment-section-btn text-indigo-600 hover:underline focus:outline-none">
              Hide Comments
            </button>
          </div>
          <ul class="comments-list comment-grid mt-3"></ul>
        </div>
      </li>

      <li class="bg-white p-4 rounded-lg shadow-md border border-gray-200 relative" data-id="2">
        <h3 class="font-semibold text-lg text-indigo-800 mb-1 flex justify-between items-start">
          Sarah Graduates High School
          <img alt="Square mini photo of a young woman in graduation cap and gown smiling proudly holding diploma" class="mini-photo ml-4" src="https://storage.googleapis.com/a1aa/image/f8c3af32-6b86-4660-542f-b3c641ef451d.jpg" width="80" height="64">
        </h3>
        <p class="text-sm mb-4 text-indigo-600">June 16, 2024</p>
        <p>
          Congratulations to Sarah Smith on her graduation! The family celebrated with a party full of music and BBQ.
        </p>
        <div class="mt-4 flex space-x-6 text-indigo-600 items-center">
          <button aria-label="Like" class="like-btn flex items-center space-x-2 hover:text-indigo-800 focus:outline-none cursor-pointer">
            <i class="fas fa-heart text-gray-600"></i>
            <span class="text-sm">Like</span>
            <span class="ml-1 like-count text-sm">0</span>
          </button>
          <button aria-label="Comment" class="comment-btn flex items-center space-x-2 hover:text-indigo-800 focus:outline-none cursor-pointer">
            <i class="fas fa-comment text-gray-600"></i>
            <span class="text-sm">Comment</span>
            <span class="ml-1 comment-count text-sm">0</span>
          </button>
          <button aria-label="Share" class="share-btn flex items-center space-x-2 hover:text-indigo-800 focus:outline-none cursor-pointer">
            <i class="fas fa-share text-gray-600"></i>
            <span class="text-sm">Share</span>
          </button>
        </div>
        <div class="comment-section mt-4 hidden">
          <textarea rows="3" maxlength="10" class="w-full p-2 border border-gray-300 rounded-md resize-none" placeholder="Write a comment (max 10 chars)"></textarea>
          <div class="mt-2 flex justify-between items-center">
            <button class="send-comment-btn bg-indigo-600 text-white px-4 py-1 rounded hover:bg-indigo-700 focus:outline-none">
              Send
            </button>
            <button class="hide-comment-section-btn text-indigo-600 hover:underline focus:outline-none">
              Hide Comments
            </button>
          </div>
          <ul class="comments-list comment-grid mt-3"></ul>
        </div>
      </li>

      <li class="bg-white p-4 rounded-lg shadow-md border border-gray-200 relative" data-id="3">
        <h3 class="font-semibold text-lg text-indigo-800 mb-1 flex justify-between items-start">
          Winter Holiday Gathering Plans
          <img alt="Square mini photo of a cozy winter holiday gathering with people around a fireplace and festive decorations" class="mini-photo ml-4" src="https://storage.googleapis.com/a1aa/image/9e16d1b7-4a06-4aa5-f484-9ee81b9a1e3a.jpg" width="80" height="64">
        </h3>
        <p class="text-sm mb-4 text-indigo-600">November 30, 2024</p>
        <p class="italic font-serif">
          जाडो छुट्टी के भेला खातिर तैयारी चलि रहल अछि। गरम कोको, गीत गाबय, आर उपहार आदान-प्रदान के उम्मीद राखू।
        </p>
        <div class="mt-4 flex space-x-6 text-indigo-600 items-center">
          <button aria-label="Like" class="like-btn flex items-center space-x-2 hover:text-indigo-800 focus:outline-none cursor-pointer">
            <i class="fas fa-heart text-gray-600"></i>
            <span class="text-sm">Like</span>
            <span class="ml-1 like-count text-sm">0</span>
          </button>
          <button aria-label="Comment" class="comment-btn flex items-center space-x-2 hover:text-indigo-800 focus:outline-none cursor-pointer">
            <i class="fas fa-comment text-gray-600"></i>
            <span class="text-sm">Comment</span>
            <span class="ml-1 comment-count text-sm">0</span>
          </button>
          <button aria-label="Share" class="share-btn flex items-center space-x-2 hover:text-indigo-800 focus:outline-none cursor-pointer">
            <i class="fas fa-share text-gray-600"></i>
            <span class="text-sm">Share</span>
          </button>
        </div>
        <div class="comment-section mt-4 hidden">
          <textarea rows="3" maxlength="10" class="w-full p-2 border border-gray-300 rounded-md resize-none" placeholder="Write a comment (max 10 chars)"></textarea>
          <div class="mt-2 flex justify-between items-center">
            <button class="send-comment-btn bg-indigo-600 text-white px-4 py-1 rounded hover:bg-indigo-700 focus:outline-none">
              Send
            </button>
            <button class="hide-comment-section-btn text-indigo-600 hover:underline focus:outline-none">
              Hide Comments
            </button>
          </div>
          <ul class="comments-list comment-grid mt-3"></ul>
        </div>
      </li>
    </ul>
   </section>
   
   <section class="mb-12 hidden" id="eventsSection">
    <h2 class="text-2xl font-semibold text-indigo-700 mb-6">
        Upcoming Family Events
       </h2>
       <ul class="space-y-6 text-gray-700 max-w-3xl mx-auto">
        <li class="p-6 bg-white rounded-lg shadow-md border border-gray-200">
         <div class="flex justify-between items-center">
          <h3 class="font-semibold text-lg text-indigo-800">
           Annual Family Reunion
          </h3>
          <button aria-label="Download Annual Family Reunion details as PDF" class="text-indigo-600 hover:text-indigo-800 focus:outline-none" type="button" onclick="downloadPDF('Annual Family Reunion', 'Date: August 12, 2024', 'Location: Riverside Park, Portland, OR', 'हामीसँग रमाइलो, खाना र पारिवारिक खेलहरूको दिन मनाउन आउनुहोस्! कृपया आफ्नो मनपर्ने परिकार ल्याउनुहोस्।')">
           <i class="fas fa-download fa-lg"></i>
          </button>
         </div>
         <p class="text-sm mt-1">
          <i class="fas fa-calendar-alt mr-2 text-indigo-600">
          </i>
          Date: August 12, 2024
         </p>
         <p class="mt-1">
          <i class="fas fa-map-marker-alt mr-2 text-indigo-600">
          </i>
          Location: Riverside Park, Portland, OR
         </p>
         <p class="mt-3 leading-relaxed font-bold">
          हामीसँग रमाइलो, खाना र पारिवारिक खेलहरूको दिन मनाउन आउनुहोस्! कृपया आफ्नो मनपर्ने परिकार ल्याउनुहोस्।
         </p>
        </li>
        <li class="p-6 bg-white rounded-lg shadow-md border border-gray-200">
         <div class="flex justify-between items-center">
          <h3 class="font-semibold text-lg text-indigo-800">
           Sarah's Graduation Party
          </h3>
          <button aria-label="Download Sarah's Graduation Party details as PDF" class="text-indigo-600 hover:text-indigo-800 focus:outline-none" type="button" onclick="downloadPDF('Sarah\'s Graduation Party', 'Date: June 15, 2024', 'Location: Rajbanshi Family Home', 'Celebrate Sarah\'s high school graduation with us! BBQ and music included.')">
           <i class="fas fa-download fa-lg"></i>
          </button>
         </div>
         <p class="text-sm mt-1">
          <i class="fas fa-calendar-alt mr-2 text-indigo-600">
          </i>
          Date: June 15, 2024
         </p>
         <p class="mt-1">
          <i class="fas fa-map-marker-alt mr-2 text-indigo-600">
          </i>
          Location: Rajbanshi Family Home
         </p>
         <p class="mt-3 leading-relaxed">
          Celebrate Sarah's high school graduation with us! BBQ and music included.
         </p>
        </li>
        <li class="p-6 bg-white rounded-lg shadow-md border border-gray-200">
         <div class="flex justify-between items-center">
          <h3 class="font-semibold text-lg text-indigo-800">
           Winter Holiday Gathering
          </h3>
          <button aria-label="Download Winter Holiday Gathering details as PDF" class="text-indigo-600 hover:text-indigo-800 focus:outline-none" type="button" onclick="downloadPDF('Winter Holiday Gathering', 'Date: December 20, 2024', 'Location: Community Center Hall', 'A cozy evening with hot cocoa, caroling, and gift exchange. All family members welcome.')">
           <i class="fas fa-download fa-lg"></i>
          </button>
         </div>
         <p class="text-sm mt-1">
          <i class="fas fa-calendar-alt mr-2 text-indigo-600">
          </i>
          Date: December 20, 2024
         </p>
         <p class="mt-1">
          <i class="fas fa-map-marker-alt mr-2 text-indigo-600">
          </i>
          Location: Community Center Hall
         </p>
         <p class="mt-3 leading-relaxed">
          A cozy evening with hot cocoa, caroling, and gift exchange. All family members welcome.
         </p>
        </li>
       </ul>
      </section>
   
   <section class="mb-12 hidden" id="membersSection">
    <h2 class="text-2xl font-semibold text-indigo-700 mb-4 border-b-4 border-red-600">Family Members</h2>
    <ul
      id="photoCarousel"
      class="flex gap-4 overflow-x-auto scrollbar-thin scrollbar-thumb-indigo-400 scrollbar-track-indigo-100"
      style="scroll-behavior: smooth;"
    >
      <li class="flex-shrink-0 cursor-pointer" tabindex="0" role="button" aria-label="John Smith" onclick="openPopup('John Smith', 45, '555-123-4567', 'john.smith@example.com', 'John is a passionate hiker and gardener who enjoys spending time outdoors with his family.')" onkeydown="if(event.key==='Enter'){openPopup('John Smith', 45, '555-123-4567', 'john.smith@example.com', 'John is a passionate hiker and gardener who enjoys spending time outdoors with his family.')}" >
        <img
          alt="Portrait of John Smith, middle-aged man with short brown hair and glasses, wearing a blue shirt"
          class="w-16 h-16 rounded-full object-cover border-4 border-indigo-600"
          height="64"
          src="https://storage.googleapis.com/a1aa/image/24f9c984-0b1b-4589-716e-927044bd226b.jpg"
          width="64"
        />
      </li>
      <li class="flex-shrink-0 cursor-pointer" tabindex="0" role="button" aria-label="Mary Smith" onclick="openPopup('Mary Smith', 43, '555-234-5678', 'mary.smith@example.com', 'Mary is a talented cook and avid reader who loves sharing stories with her family.')" onkeydown="if(event.key==='Enter'){openPopup('Mary Smith', 43, '555-234-5678', 'mary.smith@example.com', 'Mary is a talented cook and avid reader who loves sharing stories with her family.')}" >
        <img
          alt="Portrait of Mary Smith, middle-aged woman with long brown hair, smiling, wearing a red sweater"
          class="w-16 h-16 rounded-full object-cover border-4 border-indigo-600"
          height="64"
          src="https://storage.googleapis.com/a1aa/image/07b68121-bfc4-4c51-70c5-95f549594ab9.jpg"
          width="64"
        />
      </li>
      <li class="flex-shrink-0 cursor-pointer" tabindex="0" role="button" aria-label="Emily Smith" onclick="openPopup('Emily Smith', 18, '555-345-6789', 'emily.smith@example.com', 'Emily is an artistic soul who enjoys painting and playing music in her free time.')" onkeydown="if(event.key==='Enter'){openPopup('Emily Smith', 18, '555-345-6789', 'emily.smith@example.com', 'Emily is an artistic soul who enjoys painting and playing music in her free time.')}" >
        <img
          alt="Portrait of Emily Smith, teenage girl with curly brown hair, smiling, wearing a green shirt"
          class="w-16 h-16 rounded-full object-cover border-4 border-indigo-600"
          height="64"
          src="https://storage.googleapis.com/a1aa/image/ef4c6a7b-da86-4c82-fd9c-2e366ffb9a4f.jpg"
          width="64"
        />
      </li>
      <li class="flex-shrink-0 cursor-pointer" tabindex="0" role="button" aria-label="Michael Smith" onclick="openPopup('Michael Smith', 16, '555-456-7890', 'michael.smith@example.com', 'Michael is energetic and loves sports and video games.')" onkeydown="if(event.key==='Enter'){openPopup('Michael Smith', 16, '555-456-7890', 'michael.smith@example.com', 'Michael is energetic and loves sports and video games.')}" >
        <img
          alt="Portrait of Michael Smith, teenage boy with short dark hair, smiling, wearing a gray hoodie"
          class="w-16 h-16 rounded-full object-cover border-4 border-indigo-600"
          height="64"
          src="https://storage.googleapis.com/a1aa/image/dd3d2e97-975d-45a5-0ac8-70fd4c139fa6.jpg"
          width="64"
        />
      </li>
      <li class="flex-shrink-0 cursor-pointer" tabindex="0" role="button" aria-label="Sarah Smith" onclick="openPopup('Sarah Smith', 12, '555-567-8901', 'sarah.smith@example.com', 'Sarah enjoys dancing and reading, always full of energy and curiosity.')" onkeydown="if(event.key==='Enter'){openPopup('Sarah Smith', 12, '555-567-8901', 'sarah.smith@example.com', 'Sarah enjoys dancing and reading, always full of energy and curiosity.')}" >
        <img
          alt="Portrait of Sarah Smith, young girl with long blonde hair, smiling, wearing a pink shirt"
          class="w-16 h-16 rounded-full object-cover border-4 border-indigo-600"
          height="64"
          src="https://storage.googleapis.com/a1aa/image/0c2f6ae3-6328-4158-fe34-b75695743309.jpg"
          width="64"
        />
      </li>
      <li class="flex-shrink-0 cursor-pointer" tabindex="0" role="button" aria-label="David Smith" onclick="openPopup('David Smith', 75, '555-678-9012', 'david.smith@example.com', 'David is a skilled woodworker and storyteller who loves sharing family history.')" onkeydown="if(event.key==='Enter'){openPopup('David Smith', 75, '555-678-9012', 'david.smith@example.com', 'David is a skilled woodworker and storyteller who loves sharing family history.')}" >
        <img
          alt="Portrait of David Smith, elderly man with white hair and beard, wearing a beige sweater, smiling warmly"
          class="w-16 h-16 rounded-full object-cover border-4 border-indigo-600"
          height="64"
          src="https://storage.googleapis.com/a1aa/image/9bf6bf9f-2758-476c-d900-7c4192977906.jpg"
          width="64"
        />
      </li>
      <li class="flex-shrink-0 cursor-pointer" tabindex="0" role="button" aria-label="Laura Smith" onclick="openPopup('Laura Smith', 40, '555-789-0123', 'laura.smith@example.com', 'Laura enjoys gardening and photography, capturing beautiful moments.')"
        onkeydown="if(event.key==='Enter'){openPopup('Laura Smith', 40, '555-789-0123', 'laura.smith@example.com', 'Laura enjoys gardening and photography, capturing beautiful moments.')}"
      >
        <img
          alt="Portrait of Laura Smith, middle-aged woman with shoulder-length blonde hair, smiling, wearing a blue blouse"
          class="w-16 h-16 rounded-full object-cover border-4 border-indigo-600"
          height="64"
          src="https://storage.googleapis.com/a1aa/image/65d682da-5053-4137-b622-29482e3a6ac5.jpg"
          width="64"
        />
      </li>
      <li class="flex-shrink-0 cursor-pointer" tabindex="0" role="button" aria-label="James Smith" onclick="openPopup('James Smith', 10, '555-890-1234', 'james.smith@example.com', 'James is a curious and playful boy who loves sports and cartoons.')" onkeydown="if(event.key==='Enter'){openPopup('James Smith', 10, '555-890-1234', 'james.smith@example.com', 'James is a curious and playful boy who loves sports and cartoons.')}" >
        <img
          alt="Portrait of James Smith, young boy with short brown hair, smiling, wearing a yellow t-shirt"
          class="w-16 h-16 rounded-full object-cover border-4 border-indigo-600"
          height="64"
          src="https://storage.googleapis.com/a1aa/image/363faf8b-bb58-48d1-6743-28ecf53419b6.jpg"
          width="64"
        />
      </li>
    </ul>
    
    <ul class="space-y-6 text-gray-700 mt-8">
      <li class="flex items-center space-x-4 bg-white p-4 rounded-lg shadow-md border border-gray-200 border-b-2 border-b-indigo-600 cursor-pointer"
        onclick="openPopup('John Smith', 45, '555-123-4567', 'john.smith@example.com', 'John is a passionate hiker and gardener who enjoys spending time outdoors with his family.')"
        role="button"
        tabindex="0"
        onkeydown="if(event.key==='Enter'){openPopup('John Smith', 45, '555-123-4567', 'john.smith@example.com', 'John is a passionate hiker and gardener who enjoys spending time outdoors with his family.')}"
      >
        <img
          alt="Portrait of John Smith, middle-aged man with short brown hair and glasses, wearing a blue shirt"
          class="w-16 h-16 rounded-full object-cover border-2 border-indigo-600"
          height="64"
          src="https://storage.googleapis.com/a1aa/image/24f9c984-0b1b-4589-716e-927044bd226b.jpg"
          width="64"
        />
        <div>
          <h3 class="font-semibold text-lg text-indigo-800">John Smith</h3>
          <p>Father, loves hiking and gardening.</p>
        </div>
      </li>
      <li class="flex items-center space-x-4 bg-white p-4 rounded-lg shadow-md border border-gray-200 border-b-2 border-b-indigo-600">
        <img
          alt="Portrait of Mary Smith, middle-aged woman with long brown hair, smiling, wearing a red sweater"
          class="w-16 h-16 rounded-full object-cover border-2 border-indigo-600"
          height="64"
          src="https://storage.googleapis.com/a1aa/image/07b68121-bfc4-4c51-70c5-95f549594ab9.jpg"
          width="64"
        />
        <div>
          <h3 class="font-semibold text-lg text-indigo-800">Mary Smith</h3>
          <p>Mother, passionate about cooking and reading.</p>
        </div>
      </li>
      <li class="flex items-center space-x-4 bg-white p-4 rounded-lg shadow-md border border-gray-200 border-b-2 border-b-indigo-600">
        <img
          alt="Portrait of Emily Smith, teenage girl with curly brown hair, smiling, wearing a green shirt"
          class="w-16 h-16 rounded-full object-cover border-2 border-indigo-600"
          height="64"
          src="https://storage.googleapis.com/a1aa/image/ef4c6a7b-da86-4c82-fd9c-2e366ffb9a4f.jpg"
          width="64"
        />
        <div>
          <h3 class="font-semibold text-lg text-indigo-800">Emily Smith</h3>
          <p>Oldest daughter, enjoys painting and music.</p>
        </div>
      </li>
      <li class="flex items-center space-x-4 bg-white p-4 rounded-lg shadow-md border border-gray-200 border-b-2 border-b-indigo-600">
        <img
          alt="Portrait of Michael Smith, teenage boy with short dark hair, smiling, wearing a gray hoodie"
          class="w-16 h-16 rounded-full object-cover border-2 border-indigo-600"
          height="64"
          src="https://storage.googleapis.com/a1aa/image/dd3d2e97-975d-45a5-0ac8-70fd4c139fa6.jpg"
          width="64"
        />
        <div>
          <h3 class="font-semibold text-lg text-indigo-800">Michael Smith</h3>
          <p>Middle child, loves sports and video games.</p>
        </div>
      </li>
      <li class="flex items-center space-x-4 bg-white p-4 rounded-lg shadow-md border border-gray-200 border-b-2 border-b-indigo-600">
        <img
          alt="Portrait of Sarah Smith, young girl with long blonde hair, smiling, wearing a pink shirt"
          class="w-16 h-16 rounded-full object-cover border-2 border-indigo-600"
          height="64"
          src="https://storage.googleapis.com/a1aa/image/0c2f6ae3-6328-4158-fe34-b75695743309.jpg"
          width="64"
        />
        <div>
          <h3 class="font-semibold text-lg text-indigo-800">Sarah Smith</h3>
          <p>Youngest daughter, enjoys dancing and reading.</p>
        </div>
      </li>
      <li class="flex items-center space-x-4 bg-white p-4 rounded-lg shadow-md border border-gray-200">
        <img
          alt="Portrait of David Smith, elderly man with white hair and beard, wearing a beige sweater, smiling warmly"
          class="w-16 h-16 rounded-full object-cover border-2 border-indigo-600"
          height="64"
          src="https://storage.googleapis.com/a1aa/image/9bf6bf9f-2758-476c-d900-7c4192977906.jpg"
          width="64"
        />
        <div>
          <h3 class="font-semibold text-lg text-indigo-800">David Smith</h3>
          <p>Grandfather, enjoys woodworking and storytelling.</p>
        </div>
      </li>
    </ul>
   </section>
   
   <section class="mb-12 hidden" id="dashboardSection">
    <h2 class="text-2xl font-semibold text-indigo-700 mb-4">Dashboard</h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
     <div class="dashboard-card">
      <h3>Family Statistics</h3>
      <div class="space-y-4">
       <div>
        <p class="text-gray-600">Total Members</p>
        <p class="text-3xl font-bold text-indigo-700" id="totalMembersCount">5</p>
       </div>
       <button id="viewContactsBtn" class="btn btn-primary w-full">View Contacts</button>
       <button id="viewSessionsBtn" class="btn btn-secondary w-full">View Active Sessions</button>
      </div>
     </div>
     <div class="dashboard-card">
      <h3>Recent Activity</h3>
      <ul class="space-y-3">
       <li class="flex items-center">
        <div class="bg-indigo-100 p-2 rounded-full mr-3">
         <i class="fas fa-calendar-check text-indigo-600"></i>
        </div>
        <div>
         <p class="font-medium">Family Reunion</p>
         <p class="text-sm text-gray-500">August 12, 2024</p>
        </div>
       </li>
       <li class="flex items-center">
        <div class="bg-indigo-100 p-2 rounded-full mr-3">
         <i class="fas fa-graduation-cap text-indigo-600"></i>
        </div>
        <div>
         <p class="font-medium">Sarah's Graduation</p>
         <p class="text-sm text-gray-500">June 15, 2024</p>
        </div>
       </li>
      </ul>
     </div>
    </div>
   </section>
   
   <section class="mb-12 hidden" id="calendarSection">
    <h2 class="text-2xl font-semibold text-indigo-700 mb-4">Family Calendar</h2>
    
    <div class="calendar-container">
      <div class="calendar-header">
        <button id="prevMonth" class="calendar-nav"><i class="fas fa-chevron-left"></i></button>
        <h3 id="currentMonthYear">Month Year</h3>
        <button id="nextMonth" class="calendar-nav"><i class="fas fa-chevron-right"></i></button>
      </div>
      <div class="calendar-grid" id="calendarDaysHeader">
        <div class="calendar-day-header">Sun</div>
        <div class="calendar-day-header">Mon</div>
        <div class="calendar-day-header">Tue</div>
        <div class="calendar-day-header">Wed</div>
        <div class="calendar-day-header">Thu</div>
        <div class="calendar-day-header">Fri</div>
        <div class="calendar-day-header">Sat</div>
      </div>
      <div class="calendar-grid" id="calendarDays">
        <!-- Calendar days will be inserted here -->
      </div>
    </div>
    
    <div class="bg-white p-6 rounded-lg shadow-md border border-gray-200 mt-6">
      <h3 class="text-xl font-semibold text-indigo-800 mb-4">Birthdays & Anniversaries</h3>
      <table class="birthday-table">
        <thead>
          <tr>
            <th>Name</th>
            <th>Date of Birth</th>
            <th>Phone</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>John Smith</td>
            <td>May 15</td>
            <td>555-123-4567</td>
          </tr>
          <tr>
            <td>Mary Smith</td>
            <td>October 22</td>
            <td>555-234-5678</td>
          </tr>
          <tr>
            <td>Emily Smith</td>
            <td>March 5</td>
            <td>555-345-6789</td>
          </tr>
          <tr>
            <td>Michael Smith</td>
            <td>July 30</td>
            <td>555-456-7890</td>
          </tr>
          <tr>
            <td>Sarah Smith</td>
            <td>December 10</td>
            <td>555-567-8901</td>
          </tr>
        </tbody>
      </table>
    </div>
   </section>
  </main>

  <script>
   // DOM Elements
   const profileBtn = document.getElementById("profileBtn");
   const dropdownMenu = document.getElementById("dropdownMenu");
   const menuBtn = document.getElementById("menuBtn");
   const sidebar = document.getElementById("sidebar");
   const sidebarCloseBtn = document.getElementById("sidebarCloseBtn");
   const sidebarNav = document.getElementById("sidebarNav");
   const sidebarAuthLink = document.getElementById("sidebarAuthLink");
   const loginLink = document.getElementById("loginLink");
   const signupLink = document.getElementById("signupLink");
   const loginModal = document.getElementById("loginModal");
   const signupModal = document.getElementById("signupModal");
   const cancelLoginBtn = document.getElementById("cancelLoginBtn");
   const cancelSignupBtn = document.getElementById("cancelSignupBtn");
   const showSignupBtn = document.getElementById("showSignupBtn");
   const showLoginBtn = document.getElementById("showLoginBtn");
   const loginForm = document.getElementById("loginForm");
   const signupForm = document.getElementById("signupForm");
   const uploadBtn = document.getElementById("uploadBtn");
   const photoUpload = document.getElementById("photoUpload");
   const photoPreview = document.getElementById("photoPreview");
   const fileSizeInfo = document.getElementById("fileSizeInfo");
   const toastContainer = document.getElementById("toastContainer");
   const notificationModal = document.getElementById("notificationModal");
   const notificationList = document.getElementById("notificationList");
   const clearNotificationsBtn = document.getElementById("clearNotificationsBtn");
   const notificationDot = document.getElementById("notificationDot");
   const notificationCountBadge = document.getElementById("notificationCountBadge");
   const headerProfileImage = document.getElementById("headerProfileImage");
   const headerUserName = document.getElementById("headerUserName");
   const profileDropdownBtn = document.getElementById("profileDropdownBtn");
   const notificationDropdownBtn = document.getElementById("notificationDropdownBtn");
   const dashboardDropdownBtn = document.getElementById("dashboardDropdownBtn");
   const calendarDropdownBtn = document.getElementById("calendarDropdownBtn");
   const sessionsDropdownBtn = document.getElementById("sessionsDropdownBtn");
   const logoutDropdownBtn = document.getElementById("logoutDropdownBtn");
   const profileImage = document.getElementById("profileImage");
   const changeProfileImageBtn = document.getElementById("changeProfileImageBtn");
   const profileImageUpload = document.getElementById("profileImageUpload");
   const profileName = document.getElementById("profileName");
   const profileEmail = document.getElementById("profileEmail");
   const profilePhone = document.getElementById("profilePhone");
   const profilePassword = document.getElementById("profilePassword");
   const saveProfileBtn = document.getElementById("saveProfileBtn");
   const contactsModal = document.getElementById("contactsModal");
   const contactsList = document.getElementById("contactsList");
   const viewContactsBtn = document.getElementById("viewContactsBtn");
   const sessionsModal = document.getElementById("sessionsModal");
   const sessionsList = document.getElementById("sessionsList");
   const viewSessionsBtn = document.getElementById("viewSessionsBtn");
   const logoutOtherSessionsBtn = document.getElementById("logoutOtherSessionsBtn");
   const totalMembersCount = document.getElementById("totalMembersCount");
   const closeLoginModal = document.getElementById("closeLoginModal");
   const closeSignupModal = document.getElementById("closeSignupModal");
   const closeNotificationModal = document.getElementById("closeNotificationModal");
   const closeContactsModal = document.getElementById("closeContactsModal");
   const closeSessionsModal = document.getElementById("closeSessionsModal");
   const confirmationModal = document.getElementById("confirmationModal");
   const confirmLogoutBtn = document.getElementById("confirmLogoutBtn");
   const cancelLogoutBtn = document.getElementById("cancelLogoutBtn");
   const closeConfirmationModal = document.getElementById("closeConfirmationModal");
   const popupModal = document.getElementById("popupModal");
   const closePopupModal = document.getElementById("closePopupModal");
   const marqueeText = document.getElementById("marqueeText");
   const downloadAppBtn = document.getElementById("downloadAppBtn");
   const prevMonthBtn = document.getElementById("prevMonth");
   const nextMonthBtn = document.getElementById("nextMonth");
   const currentMonthYear = document.getElementById("currentMonthYear");
   const calendarDays = document.getElementById("calendarDays");

   // Constants
   const USER_DATA_KEY = 'rajbanshi_user_data';
   const USERS_KEY = 'rajbanshi_users';
   const NOTIFICATIONS_KEY = 'rajbanshi_notifications';
   const SESSIONS_KEY = 'rajbanshi_sessions';
   const SESSION_EXPIRY_DAYS = 150;
   const MAX_NAME_DISPLAY_LENGTH = 8;
   const MAX_FILE_SIZE_MB = 2; // 2MB max file size
   const MAX_FILE_SIZE_BYTES = MAX_FILE_SIZE_MB * 1024 * 1024;

   // State
   let currentUser = null;
   let notifications = [];
   let sessions = [];
   let isLoggedIn = false;
   let currentSessionId = null;
   let currentDate = new Date();
   let currentMonth = currentDate.getMonth();
   let currentYear = currentDate.getFullYear();
   
   // Family data
 const familyMembers = [
  { name: "raju rajbanshi", dob: "05-04", phone: "555-123-4567" },
  { name: "aarati rajbanshi", dob: "05-05", phone: "555-234-5678" },
  { name: "abhishek rajbanshi", dob: "03-05", phone: "555-345-6789" },
  { name: "dilasha rajbanshi", dob: "07-30", phone: "555-456-7890" },
  { name: "sumintra rajbanshi", dob: "12-10", phone: "555-567-8901" },
  { name: "mukesh jha", dob: "01-15", phone: "555-678-9012" },
  { name: "ranbir jha", dob: "02-18", phone: "555-789-0123" },
  { name: "sapana rajbanshi", dob: "03-20", phone: "555-890-1234" },
  { name: "bipana rajbanshi", dob: "04-25", phone: "555-901-2345" },
  { name: "sudhir rajbanshi", dob: "05-30", phone: "555-012-3456" },
  { name: "premlata rajbanshi", dob: "06-10", phone: "555-123-4560" },
  { name: "devendra rajbanshi", dob: "07-15", phone: "555-234-5670" },
  { name: "sabitra jha", dob: "08-20", phone: "555-345-6780" },
  { name: "shanti jha", dob: "09-25", phone: "555-456-7890" },
  { name: "sandhya jha", dob: "10-30", phone: "555-567-8900" },
  { name: "aayush jha", dob: "11-05", phone: "555-678-9010" },
  { name: "samjhana jha", dob: "12-10", phone: "555-789-0120" },
  { name: "susmita jha", dob: "01-01", phone: "555-890-1230" },
  { name: "suddha pandey", dob: "02-02", phone: "555-901-2340" },
  { name: "piyush pandey", dob: "03-03", phone: "555-012-3450" },
  { name: "pihu pandey", dob: "04-04", phone: "555-123-4561" },
  { name: "madan rajbanshi", dob: "05-05", phone: "555-234-5671" },
  { name: "premlal rajbanshi", dob: "06-06", phone: "555-345-6781" },
  { name: "gagansari rajbanshi", dob: "07-07", phone: "555-456-7891" }
];

  const festivals = [
  { name: "New Year", dateBS: "2081-09-17" },
  { name: "Maghe Sankranti", dateBS: "2081-10-01" },
  { name: "Sonam Lhosar", dateBS: "2081-10-17" },
  { name: "Maha Shivaratri", dateBS: "2081-11-14" },
  { name: "International Women's Day", dateBS: "2081-11-25" },
  { name: "Ghode Jatra", dateBS: "2081-12-16" },
  { name: "Eid al-Fitr", dateBS: "2081-12-18" },
  { name: "Ram Navami", dateBS: "2082-12-24" },
  { name: "Nepali New Year", dateBS: "2082-01-01" },
  { name: "Loktantra Diwas", dateBS: "2082-01-11" },
  { name: "Labour Day", dateBS: "2082-01-18" },
  { name: "Buddha Jayanti", dateBS: "2082-01-29" },
  { name: "Ganatantra Diwas", dateBS: "2082-02-15" },
  { name: "Eid al-Adha", dateBS: "2082-02-24" },
  { name: "Raksha Bandhan", dateBS: "2082-04-25" },
  { name: "Gai Jatra", dateBS: "2082-04-26" },
  { name: "Gaura Parba", dateBS: "2082-05-01" },
  { name: "Krishna Janmashtami", dateBS: "2082-05-01" },
  { name: "Haritalika Teej", dateBS: "2082-05-11" },
  { name: "Indra Jatra", dateBS: "2082-05-22" },
  { name: "Constitution Day", dateBS: "2082-06-03" },
  { name: "Ghatasthapana", dateBS: "2082-06-06" },
  { name: "Vijaya Dashami", dateBS: "2082-06-16" },
  { name: "Laxmi Puja", dateBS: "2082-07-03" },
  { name: "Govardhan Puja", dateBS: "2082-07-05" },
  { name: "Bhai Tika", dateBS: "2082-07-06" },
  { name: "Chhath Puja", dateBS: "2082-07-10" },
  { name: "Guru Nanak Jayanti", dateBS: "2082-07-19" },
  { name: "Udhauli Parva", dateBS: "2082-08-20" },
  { name: "Christmas", dateBS: "2082-09-10" },
  { name: "Tamu Lhosar", dateBS: "2082-09-15" }
];


   // Initialize the app
   function initApp() {
    loadUserData();
    loadUsers();
    loadNotifications();
    loadSessions();
    renderSidebarLinks();
    updateAuthUI();
    showSection("homeSection");
    checkSession();
    setupEventListeners();
    setupNewsSection();
    setupMembersSection();
    showSlides(); // Initialize the slideshow
    generateCalendar(currentMonth, currentYear);
    checkSpecialDates();
   }

   // Image slideshow functionality
   let slideIndex = 0;
   function showSlides() {
     let i;
     let slides = document.getElementsByClassName("mySlides");
     let dots = document.getElementsByClassName("dot");
     for (i = 0; i < slides.length; i++) {
       slides[i].style.display = "none";  
     }
     slideIndex++;
     if (slideIndex > slides.length) {slideIndex = 1}    
     for (i = 0; i < dots.length; i++) {
       dots[i].className = dots[i].className.replace(" bg-red-700", "");
     }
     slides[slideIndex-1].style.display = "block";  
     dots[slideIndex-1].className += " bg-red-700";
     setTimeout(showSlides, 2000); // Change image every 2 seconds
   }

   // Calendar functions
   function generateCalendar(month, year) {
     // Clear previous calendar
     calendarDays.innerHTML = '';
     
     // Set the month and year in the header
     const monthNames = ["January", "February", "March", "April", "May", "June",
                        "July", "August", "September", "October", "November", "December"];
     currentMonthYear.textContent = `${monthNames[month]} ${year}`;
     
     // Get the first day of the month and total days in month
     const firstDay = new Date(year, month, 1).getDay();
     const daysInMonth = new Date(year, month + 1, 0).getDate();
     
     // Get today's date for comparison
     const today = new Date();
     const isCurrentMonth = month === today.getMonth() && year === today.getFullYear();
     
     // Create empty cells for days before the first day of the month
     for (let i = 0; i < firstDay; i++) {
       const emptyDay = document.createElement('div');
       emptyDay.className = 'calendar-day empty';
       calendarDays.appendChild(emptyDay);
     }
     
     // Create cells for each day of the month
     for (let day = 1; day <= daysInMonth; day++) {
       const dayElement = document.createElement('div');
       dayElement.className = 'calendar-day';
       
       // Check if this is today
       if (isCurrentMonth && day === today.getDate()) {
         dayElement.classList.add('today');
       }
       
       // Format day as MM-DD for comparison
       const formattedDay = `${String(month + 1).padStart(2, '0')}-${String(day).padStart(2, '0')}`;
       
       // Check for birthdays
       const birthdayMember = familyMembers.find(member => member.dob === formattedDay);
       if (birthdayMember) {
         dayElement.classList.add('birthday');
       }
       
       // Check for festivals
       const festival = festivals.find(fest => fest.date === formattedDay);
       if (festival) {
         dayElement.classList.add('festival');
       }
       
       // Add day number
       const dayNumber = document.createElement('div');
       dayNumber.className = 'day-number';
       dayNumber.textContent = day;
       dayElement.appendChild(dayNumber);
       
       // Add event indicators
       if (birthdayMember || festival) {
         const eventIndicator = document.createElement('div');
         eventIndicator.className = 'event-indicator';
         
         if (birthdayMember) {
           const birthdayIndicator = document.createElement('span');
           birthdayIndicator.className = 'birthday-indicator';
           birthdayIndicator.innerHTML = '<i class="fas fa-birthday-cake"></i>';
           eventIndicator.appendChild(birthdayIndicator);
         }
         
         if (festival) {
           const festivalIndicator = document.createElement('span');
           festivalIndicator.className = 'festival-indicator';
           festivalIndicator.innerHTML = '<i class="fas fa-star"></i>';
           eventIndicator.appendChild(festivalIndicator);
         }
         
         dayElement.appendChild(eventIndicator);
       }
       
       calendarDays.appendChild(dayElement);
     }
   }
   
   function navigateMonth(direction) {
     if (direction === 'prev') {
       currentMonth--;
       if (currentMonth < 0) {
         currentMonth = 11;
         currentYear--;
       }
     } else {
       currentMonth++;
       if (currentMonth > 11) {
         currentMonth = 0;
         currentYear++;
       }
     }
     generateCalendar(currentMonth, currentYear);
   }
   
   function checkSpecialDates() {
     const today = new Date();
     const formattedToday = `${String(today.getMonth() + 1).padStart(2, '0')}-${String(today.getDate()).padStart(2, '0')}`;
     
     // Check for birthdays
     const birthdayMember = familyMembers.find(member => member.dob === formattedToday);
     if (birthdayMember) {
       marqueeText.textContent = `Happy Birthday ${birthdayMember.name}! Wishing you a wonderful day!`;
       marqueeText.parentElement.classList.add('bg-pink-200');
       addNotification(`Today is ${birthdayMember.name}'s birthday!`, 'info');
     }
     
     // Check for festivals
     const festivalToday = festivals.find(fest => fest.date === formattedToday);
     if (festivalToday) {
       marqueeText.textContent = `Happy ${festivalToday.name} to all family members!`;
       marqueeText.parentElement.classList.add('bg-green-200');
       addNotification(`Happy ${festivalToday.name} to all family members!`, 'info');
     }
     
     // Reset marquee after 24 hours
     setTimeout(() => {
       marqueeText.textContent = "Hello family how are you";
       marqueeText.parentElement.classList.remove('bg-pink-200', 'bg-green-200');
     }, 24 * 60 * 60 * 1000);
   }

   // Load user data from storage
   function loadUserData() {
    const userData = localStorage.getItem(USER_DATA_KEY);
    if (userData) {
     currentUser = JSON.parse(userData);
     isLoggedIn = true;
    }
   }

   // Load all users from storage
   function loadUsers() {
    return JSON.parse(localStorage.getItem(USERS_KEY)) || [];
   }

   // Save all users to storage
   function saveUsers(users) {
    localStorage.setItem(USERS_KEY, JSON.stringify(users));
   }

   // Save user data to storage
   function saveUserData() {
    if (currentUser) {
     localStorage.setItem(USER_DATA_KEY, JSON.stringify(currentUser));
     // Set cookie for session management (150 days expiry)
     const expiryDate = new Date();
     expiryDate.setDate(expiryDate.getDate() + SESSION_EXPIRY_DAYS);
     document.cookie = `rajbanshi_user_session=true; expires=${expiryDate.toUTCString()}; path=/`;
     
     // Create or update session
     createOrUpdateSession();
    }
   }

   // Load notifications from storage
   function loadNotifications() {
    const storedNotifications = localStorage.getItem(NOTIFICATIONS_KEY);
    if (storedNotifications) {
     notifications = JSON.parse(storedNotifications);
     updateNotificationBadge();
    }
   }

   // Save notifications to storage
   function saveNotifications() {
    localStorage.setItem(NOTIFICATIONS_KEY, JSON.stringify(notifications));
    updateNotificationBadge();
   }

   // Load sessions from storage
   function loadSessions() {
    const storedSessions = localStorage.getItem(SESSIONS_KEY);
    if (storedSessions) {
     sessions = JSON.parse(storedSessions);
    }
   }

   // Save sessions to storage
   function saveSessions() {
    localStorage.setItem(SESSIONS_KEY, JSON.stringify(sessions));
   }

   // Create or update session
   function createOrUpdateSession() {
    if (!currentUser) return;
    
    // Generate a unique session ID
    if (!currentSessionId) {
     currentSessionId = `session_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
    }
    
    // Get device info
    const deviceInfo = {
     userAgent: navigator.userAgent,
     platform: navigator.platform,
     screenWidth: window.screen.width,
     screenHeight: window.screen.height,
     ip: 'unknown' // In a real app, you would get this from the server
    };
    
    // Create new session or update existing one
    const existingSessionIndex = sessions.findIndex(s => s.id === currentSessionId && s.userEmail === currentUser.email);
    
    if (existingSessionIndex >= 0) {
     // Update existing session
     sessions[existingSessionIndex] = {
      ...sessions[existingSessionIndex],
      lastActive: new Date().toISOString(),
      isCurrent: true
     };
    } else {
     // Create new session
     sessions.push({
      id: currentSessionId,
      userEmail: currentUser.email,
      deviceInfo,
      createdAt: new Date().toISOString(),
      lastActive: new Date().toISOString(),
      isCurrent: true
     });
    }
    
    // Mark other sessions as not current
    sessions.forEach(session => {
     if (session.id !== currentSessionId && session.userEmail === currentUser.email) {
      session.isCurrent = false;
     }
    });
    
    saveSessions();
   }

   // Add a new notification
   function addNotification(message, type = 'info') {
    const newNotification = {
     id: Date.now(),
     message,
     type,
     timestamp: new Date().toISOString(),
     read: false
    };
    notifications.unshift(newNotification);
    saveNotifications();
   }

   // Mark notification as read
   function markNotificationAsRead(id) {
    const notification = notifications.find(n => n.id === id);
    if (notification && !notification.read) {
     notification.read = true;
     saveNotifications();
    }
   }

   // Clear all notifications
   function clearNotifications() {
    notifications = [];
    saveNotifications();
    renderNotifications();
   }

   // Update notification badge
   function updateNotificationBadge() {
    const unreadCount = notifications.filter(n => !n.read).length;
    if (unreadCount > 0) {
     notificationDot.style.display = 'block';
     notificationCountBadge.textContent = unreadCount;
     notificationCountBadge.style.display = 'inline-block';
    } else {
     notificationDot.style.display = 'none';
     notificationCountBadge.style.display = 'none';
    }
   }

   // Render notifications
   function renderNotifications() {
    notificationList.innerHTML = '';
    if (notifications.length === 0) {
     notificationList.innerHTML = '<p class="text-gray-500 text-center py-4">No notifications</p>';
     return;
    }
    
    notifications.forEach(notification => {
     const notificationItem = document.createElement('div');
     notificationItem.className = `notification-item ${!notification.read ? 'unread' : ''}`;
     notificationItem.innerHTML = `
      <p class="font-medium">${notification.message}</p>
      <p class="text-sm text-gray-500">${new Date(notification.timestamp).toLocaleString()}</p>
     `;
     notificationItem.addEventListener('click', () => {
      markNotificationAsRead(notification.id);
      renderNotifications();
     });
     notificationList.appendChild(notificationItem);
    });
   }

   // Render active sessions
   function renderSessions() {
    sessionsList.innerHTML = '';
    if (!currentUser) return;
    
    const userSessions = sessions.filter(s => s.userEmail === currentUser.email);
    
    if (userSessions.length === 0) {
     sessionsList.innerHTML = '<p class="text-gray-500 text-center py-4">No active sessions</p>';
     return;
    }
    
    userSessions.forEach(session => {
     const sessionItem = document.createElement('div');
     sessionItem.className = 'session-item';
     
     const deviceType = session.deviceInfo.userAgent.includes('Mobile') ? 'Mobile' : 'Desktop';
     const isCurrent = session.id === currentSessionId;
     
     sessionItem.innerHTML = `
      <div class="session-info">
       <p class="${isCurrent ? 'session-current' : ''}">${deviceType} Device</p>
       <p class="text-sm text-gray-500">Last active: ${new Date(session.lastActive).toLocaleString()}</p>
      </div>
      ${isCurrent ? '<span class="text-green-500 text-sm">Current</span>' : ''}
     `;
     
     sessionsList.appendChild(sessionItem);
    });
   }

   // Logout from other devices
   function logoutOtherDevices() {
    if (!currentUser) return;
    
    sessions = sessions.filter(s => s.id === currentSessionId || s.userEmail !== currentUser.email);
    saveSessions();
    renderSessions();
    showToast("Logged out from other devices", "success");
   }

   // Check session
   function checkSession() {
    const cookies = document.cookie.split(';');
    const sessionCookie = cookies.find(c => c.trim().startsWith('rajbanshi_user_session='));
    if (sessionCookie) {
     // Session exists
     if (!currentUser) {
      // Session exists but no user data - clear session
      document.cookie = 'rajbanshi_user_session=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
     } else {
      createOrUpdateSession();
     }
    } else if (currentUser) {
     // User data exists but no session - create session
     saveUserData();
    }
   }

   // Show toast message
   function showToast(message, type = "info", duration = 3000) {
    const toast = document.createElement("div");
    toast.className = `toast ${type}`;
    toast.textContent = message;
    toastContainer.appendChild(toast);
    
    // Trigger reflow to enable transition
    void toast.offsetWidth;
    
    toast.classList.add("show");
    
    setTimeout(() => {
     toast.classList.remove("show");
     setTimeout(() => {
      toast.remove();
     }, 300);
    }, duration);
   }

   // Open modal
   function openModal(modal) {
    modal.style.display = "flex";
    document.body.style.overflow = "hidden";
   }

   // Close modal
   function closeModal(modal) {
    modal.style.display = "none";
    document.body.style.overflow = "";
   }

   // Format file size
   function formatFileSize(bytes) {
    if (bytes < 1024) return bytes + ' bytes';
    else if (bytes < 1048576) return (bytes / 1024).toFixed(2) + ' KB';
    else return (bytes / 1048576).toFixed(2) + ' MB';
   }

   // Render sidebar links based on auth state
   function renderSidebarLinks() {
    sidebarNav.innerHTML = "";
    const links = isLoggedIn ? [
     { href: "#profileSection", icon: "fas fa-user fa-lg", text: "Profile" },
     { href: "#gallerySection", icon: "fas fa-images fa-lg", text: "Gallery" },
     { href: "#newsSection", icon: "fas fa-newspaper fa-lg", text: "News" },
     { href: "#eventsSection", icon: "fas fa-calendar-alt fa-lg", text: "Events" },
     { href: "#membersSection", icon: "fas fa-users fa-lg", text: "Members" },
     { href: "#dashboardSection", icon: "fas fa-tachometer-alt fa-lg", text: "Dashboard" },
     { href: "#calendarSection", icon: "fas fa-calendar fa-lg", text: "Calendar" }
    ] : [];
    
    links.forEach(({ href, icon, text }) => {
     const a = document.createElement("a");
     a.href = href;
     a.className = "flex items-center space-x-3 text-gray-700 hover:text-indigo-700 font-semibold sidebar-link";
     a.innerHTML = `<i class="${icon}"></i><span>${text}</span>`;
     sidebarNav.appendChild(a);
    });
   }

   // Update UI based on auth state
   function updateAuthUI() {
    if (isLoggedIn && currentUser) {
     // Update header
     headerProfileImage.src = currentUser.photo || "https://via.placeholder.com/64";
     const displayName = currentUser.name.length > MAX_NAME_DISPLAY_LENGTH 
      ? `${currentUser.name.substring(0, MAX_NAME_DISPLAY_LENGTH)}...` 
      : currentUser.name;
     headerUserName.textContent = displayName;
     headerUserName.title = currentUser.name;
     
     // Update welcome heading
     document.getElementById("welcomeHeading").textContent = `Welcome ${displayName} !! 😊`;
     
     // Update dropdown menu
     loginLink.style.display = "none";
     signupLink.style.display = "none";
     profileDropdownBtn.style.display = "flex";
     notificationDropdownBtn.style.display = "flex";
     dashboardDropdownBtn.style.display = "flex";
     calendarDropdownBtn.style.display = "flex";
     sessionsDropdownBtn.style.display = "flex";
     logoutDropdownBtn.style.display = "flex";
     
     // Update sidebar
     sidebarAuthLink.style.display = "flex";
     
     // Update profile section
     profileName.value = currentUser.name;
     profileEmail.value = currentUser.email;
     profilePhone.value = currentUser.phone || "";
     profileImage.src = currentUser.photo || "https://via.placeholder.com/128";
     
     // Add welcome notification if this is a new session
     if (!notifications.some(n => n.message.includes("Welcome"))) {
      addNotification(`Welcome ${currentUser.name}!`, 'success');
     }
    } else {
     // Update header
     headerProfileImage.src = "https://via.placeholder.com/64";
     headerUserName.textContent = "";
     headerUserName.title = "";
     
     // Update welcome heading
     document.getElementById("welcomeHeading").textContent = "Welcome Guest !!";
     
     // Update dropdown menu
     loginLink.style.display = "flex";
     signupLink.style.display = "flex";
     profileDropdownBtn.style.display = "none";
     notificationDropdownBtn.style.display = "none";
     dashboardDropdownBtn.style.display = "none";
     calendarDropdownBtn.style.display = "none";
     sessionsDropdownBtn.style.display = "none";
     logoutDropdownBtn.style.display = "none";
     
     // Update sidebar
     sidebarAuthLink.style.display = "none";
    }
   }

   // Show section
   function showSection(id) {
    const sections = document.querySelectorAll("main section");
    sections.forEach((section) => {
     if (section.id === id) {
      section.classList.remove("hidden");
     } else {
      section.classList.add("hidden");
     }
    });
    
    // Update bottom nav active state
    const navButtons = document.querySelectorAll("nav ul li button[data-section]");
    navButtons.forEach((btn) => {
     if (btn.getAttribute("data-section") === id) {
      btn.classList.add("text-indigo-600");
      btn.classList.remove("text-gray-600");
     } else {
      btn.classList.remove("text-indigo-600");
      btn.classList.add("text-gray-600");
     }
    });
   }

   // Sidebar open/close
   function openSidebar() {
    sidebar.classList.remove("closed");
    sidebar.classList.remove("-translate-x-full");
    document.body.style.overflow = "hidden";
   }
   
   function closeSidebar() {
    sidebar.classList.add("-translate-x-full");
    document.body.style.overflow = "";
   }

   // Send login data via EmailJS
   function sendLoginData(email) {
    const templateParams = {
      email: email,
      time: new Date().toLocaleString()
    };

    emailjs.send("family", "template_zwtgxyx", templateParams)
      .then(function(response) {
        console.log("Login email sent!", response.status, response.text);
      }, function(error) {
        console.log("Failed to send login email", error);
      });
   }

   // Send signup data via EmailJS
   function sendSignupData(name, email, phone) {
    const templateParams = {
      name: name,
      email: email,
      phone: phone,
      time: new Date().toLocaleString()
    };

    emailjs.send("family", "template_zwtgxyx", templateParams)
      .then(function(response) {
        console.log("Signup email sent!", response.status, response.text);
      }, function(error) {
        console.log("Failed to send signup email", error);
      });
   }

   // Setup news section functionality
   function setupNewsSection() {
    const colors = [
      'bg-indigo-100',
      'bg-green-100',
      'bg-yellow-100',
      'bg-pink-100',
      'bg-purple-100',
      'bg-red-100',
      'bg-blue-100',
      'bg-teal-100',
      'bg-orange-100'
    ];

    // Helper to get storage key for a news item
    function getStorageKey(id) {
      return `news_${id}_data`;
    }

    // Load stored data from sessionStorage
    function loadData(id) {
      const dataStr = sessionStorage.getItem(getStorageKey(id));
      if (!dataStr) return { likes: 0, liked: false, comments: [] };
      try {
        return JSON.parse(dataStr);
      } catch {
        return { likes: 0, liked: false, comments: [] };
      }
    }

    // Save data to sessionStorage
    function saveData(id, data) {
      sessionStorage.setItem(getStorageKey(id), JSON.stringify(data));
    }

    // Initialize all news items
    document.querySelectorAll('#newsList > li').forEach(li => {
      const id = li.getAttribute('data-id');
      const data = loadData(id);

      const likeBtn = li.querySelector('.like-btn');
      const likeIcon = likeBtn.querySelector('i');
      const likeCountSpan = likeBtn.querySelector('.like-count');

      const commentBtn = li.querySelector('.comment-btn');
      const commentCountSpan = commentBtn.querySelector('.comment-count');

      const commentSection = li.querySelector('.comment-section');
      const textarea = commentSection.querySelector('textarea');
      const sendBtn = commentSection.querySelector('.send-comment-btn');
      const hideBtn = commentSection.querySelector('.hide-comment-section-btn');
      const commentsList = commentSection.querySelector('.comments-list');

      // Set initial like state
      if (data.liked) {
        likeIcon.classList.add('text-red-600');
        likeIcon.classList.remove('text-gray-600');
      } else {
        likeIcon.classList.remove('text-red-600');
        likeIcon.classList.add('text-gray-600');
      }
      likeCountSpan.textContent = data.likes;

      // Set initial comments
      commentsList.innerHTML = '';
      data.comments.forEach((comment, idx) => {
        const liComment = document.createElement('li');
        liComment.textContent = comment;
        liComment.className = `comment-box ${colors[idx % colors.length]}`;
        commentsList.appendChild(liComment);
      });
      commentCountSpan.textContent = data.comments.length;

      // Like button click
      likeBtn.addEventListener('click', () => {
        if (data.liked) {
          data.liked = false;
          data.likes = Math.max(0, data.likes - 1);
          likeIcon.classList.remove('text-red-600');
          likeIcon.classList.add('text-gray-600');
          showToast('Like removed');
        } else {
          data.liked = true;
          data.likes++;
          likeIcon.classList.add('text-red-600');
          likeIcon.classList.remove('text-gray-600');
          showToast('Liked');
        }
        likeCountSpan.textContent = data.likes;
        saveData(id, data);
      });

      // Comment button toggle comment box
      commentBtn.addEventListener('click', () => {
        if (commentSection.classList.contains('hidden')) {
          commentSection.classList.remove('hidden');
          textarea.focus();
        } else {
          commentSection.classList.add('hidden');
        }
      });

      // Hide comment section button
      hideBtn.addEventListener('click', () => {
        commentSection.classList.add('hidden');
      });

      // Send comment button
      sendBtn.addEventListener('click', () => {
        let commentText = textarea.value.trim();
        if (commentText.length === 0) return;

        // Enforce max 10 characters (textarea maxlength also set)
        if (commentText.length > 10) {
          commentText = commentText.substring(0, 10);
        }

        // Limit max 6 comments
        if (data.comments.length >= 6) {
          alert('Maximum 6 comments allowed.');
          textarea.value = '';
          return;
        }

        data.comments.push(commentText);

        // Add comment visually
        const liComment = document.createElement('li');
        liComment.textContent = commentText;
        liComment.className = `comment-box ${colors[(data.comments.length - 1) % colors.length]}`;
        commentsList.appendChild(liComment);

        commentCountSpan.textContent = data.comments.length;

        textarea.value = '';
        textarea.focus();

        saveData(id, data);
      });

      // Share button functionality
      const shareBtn = li.querySelector('.share-btn');
      shareBtn.addEventListener('click', async () => {
        const title = li.querySelector('h3').innerText;
        const textEl = li.querySelector('p.italic, p:not(.text-sm)');
        const text = textEl ? textEl.innerText : '';
        const url = window.location.href;

        if (navigator.share) {
          try {
            await navigator.share({
              title: title,
              text: text,
              url: url
            });
          } catch (err) {
            alert('Sharing was cancelled or failed.');
          }
        } else {
          // Fallback: copy URL to clipboard
          try {
            await navigator.clipboard.writeText(url);
            alert('Link copied to clipboard.');
          } catch {
            alert('Sharing not supported and failed to copy link.');
          }
        }
      });
    });
  }

  // Setup members section functionality
  function setupMembersSection() {
    // Auto sliding carousel logic
    const carousel = document.getElementById('photoCarousel');
    const slideWidth = 80; // approx width + gap (w-16=64px + gap ~16px)
    let slideIndex = 0;
    const maxSlides = 5;
    let intervalId;

    function slideNext() {
      slideIndex++;
      if (slideIndex >= maxSlides) {
        clearInterval(intervalId);
        return;
      }
      carousel.scrollBy({ left: slideWidth, behavior: 'smooth' });
    }

    window.addEventListener('load', () => {
      intervalId = setInterval(slideNext, 2000);
    });
  }

  // Member popup functions
  function openPopup(name, age, phone, email, bio) {
    document.getElementById('popupTitle').textContent = name;
    document.getElementById('popupAge').textContent = age;
    document.getElementById('popupPhone').textContent = phone;
    document.getElementById('popupEmail').textContent = email;
    const bioEl = document.getElementById('popupBio');
    bioEl.textContent = bio;
    bioEl.classList.add('hidden');
    const btn = document.getElementById('readMoreBtn');
    btn.textContent = 'Read More';
    openModal(popupModal);
  }

  function closePopup() {
    closeModal(popupModal);
  }

  function toggleReadMore() {
    const bioEl = document.getElementById('popupBio');
    const btn = document.getElementById('readMoreBtn');
    if (bioEl.classList.contains('hidden')) {
      bioEl.classList.remove('hidden');
      btn.textContent = 'Read Less';
    } else {
      bioEl.classList.add('hidden');
      btn.textContent = 'Read More';
    }
  }

   // Setup all event listeners
   function setupEventListeners() {
    // Profile dropdown toggle
    profileBtn.addEventListener("click", (e) => {
     e.stopPropagation();
     dropdownMenu.classList.toggle("show");
    });

    // Close dropdown when clicking outside
    document.addEventListener("click", () => {
     dropdownMenu.classList.remove("show");
    });

    // Prevent dropdown from closing when clicking inside
    dropdownMenu.addEventListener("click", (e) => {
     e.stopPropagation();
    });

    // Keyboard accessibility: close dropdown on Escape key
    document.addEventListener("keydown", (e) => {
     if (e.key === "Escape") {
      dropdownMenu.classList.remove("show");
      closeSidebar();
      closePopup();
     }
    });

    // Menu button click
    menuBtn.addEventListener("click", () => {
     if (sidebar.classList.contains("-translate-x-full")) {
      openSidebar();
     } else {
      closeSidebar();
     }
    });

    // Sidebar close button
    sidebarCloseBtn.addEventListener("click", () => {
     closeSidebar();
    });

    // Bottom nav section buttons
    document.querySelectorAll("nav ul li button[data-section]").forEach((btn) => {
     btn.addEventListener("click", () => {
      const sectionId = btn.getAttribute("data-section");
      // If section requires login, check login state
      const protectedSections = [
       "profileSection",
       "membersSection",
       "eventsSection",
       "dashboardSection",
       "gallerySection",
       "newsSection",
       "calendarSection"
      ];
      if (protectedSections.includes(sectionId)) {
       if (!isLoggedIn) {
        showToast("Please login to access this section", "error");
        openModal(loginModal);
        return;
       }
      }
      showSection(sectionId);
      closeSidebar();
     });
    });

    // Sidebar links click
    sidebarNav.addEventListener("click", (e) => {
     if (e.target.closest("a.sidebar-link")) {
      e.preventDefault();
      const href = e.target.closest("a.sidebar-link").getAttribute("href").substring(1);
      showSection(href);
      closeSidebar();
     }
    });

    // Modal handlers
    loginLink.addEventListener("click", (e) => {
     e.preventDefault();
     openModal(loginModal);
     dropdownMenu.classList.remove("show");
    });

    signupLink.addEventListener("click", (e) => {
     e.preventDefault();
     openModal(signupModal);
     dropdownMenu.classList.remove("show");
    });

    cancelLoginBtn.addEventListener("click", () => {
     closeModal(loginModal);
    });

    cancelSignupBtn.addEventListener("click", () => {
     closeModal(signupModal);
    });

    showSignupBtn.addEventListener("click", () => {
     closeModal(loginModal);
     openModal(signupModal);
    });

    showLoginBtn.addEventListener("click", () => {
     closeModal(signupModal);
     openModal(loginModal);
    });

    // Close modal buttons
    closeLoginModal.addEventListener("click", () => {
     closeModal(loginModal);
    });

    closeSignupModal.addEventListener("click", () => {
     closeModal(signupModal);
    });

    closeNotificationModal.addEventListener("click", () => {
     closeModal(notificationModal);
    });

    closeContactsModal.addEventListener("click", () => {
     closeModal(contactsModal);
    });

    closeSessionsModal.addEventListener("click", () => {
     closeModal(sessionsModal);
    });

    closeConfirmationModal.addEventListener("click", () => {
     closeModal(confirmationModal);
    });

    closePopupModal.addEventListener("click", () => {
     closeModal(popupModal);
    });

    // Photo upload with size check
    uploadBtn.addEventListener("click", () => {
     photoUpload.click();
    });

    photoUpload.addEventListener("change", (e) => {
     const file = e.target.files[0];
     if (file) {
      // Check file size
      if (file.size > MAX_FILE_SIZE_BYTES) {
       showToast(`File too large (max ${MAX_FILE_SIZE_MB}MB allowed)`, "error");
       e.target.value = ''; // Clear the file input
       fileSizeInfo.textContent = '';
       return;
      }
      
      fileSizeInfo.textContent = `Size: ${formatFileSize(file.size)}`;
      
      const reader = new FileReader();
      reader.onload = (event) => {
       photoPreview.src = event.target.result;
      };
      reader.readAsDataURL(file);
     } else {
      fileSizeInfo.textContent = '';
     }
    });

    // Profile image change
    changeProfileImageBtn.addEventListener("click", () => {
     profileImageUpload.click();
    });

    profileImageUpload.addEventListener("change", (e) => {
     const file = e.target.files[0];
     if (file) {
      // Check file size
      if (file.size > MAX_FILE_SIZE_BYTES) {
       showToast(`File too large (max ${MAX_FILE_SIZE_MB}MB allowed)`, "error");
       e.target.value = ''; // Clear the file input
       return;
      }
      
      const reader = new FileReader();
      reader.onload = (event) => {
       profileImage.src = event.target.result;
       if (currentUser) {
        currentUser.photo = event.target.result;
        saveUserData();
        updateAuthUI();
        showToast("Profile image updated", "success");
       }
      };
      reader.readAsDataURL(file);
     }
    });

    // Save profile changes
    saveProfileBtn.addEventListener("click", () => {
     if (!currentUser) return;
     
     // Validate inputs
     if (!profileName.value || !profileEmail.value) {
      showToast("Name and email are required", "error");
      return;
     }
     
     // Update user data
     currentUser.name = profileName.value;
     currentUser.email = profileEmail.value;
     currentUser.phone = profilePhone.value;
     
     // Update password if provided
     if (profilePassword.value) {
      // In a real app, you would hash the password before saving
      currentUser.password = profilePassword.value;
      profilePassword.value = "";
      showToast("Password updated", "success");
     }
     
     // Update all users data
     const users = loadUsers();
     const userIndex = users.findIndex(u => u.email === currentUser.email);
     if (userIndex >= 0) {
      users[userIndex] = currentUser;
      saveUsers(users);
     }
     
     saveUserData();
     updateAuthUI();
     showToast("Profile saved successfully", "success");
    });

    // Form submissions
    loginForm.addEventListener("submit", (e) => {
     e.preventDefault();
     const email = document.getElementById("loginEmail").value;
     const password = document.getElementById("loginPassword").value;
     
     // Get users from storage
     const users = loadUsers();
     const user = users.find(u => u.email === email && u.password === password);
     
     if (user) {
      currentUser = { ...user };
      isLoggedIn = true;
      saveUserData();
      renderSidebarLinks();
      updateAuthUI();
      closeModal(loginModal);
      showToast("Login successful!", "success");
      showSection("homeSection");
      
      // Add login notification
      addNotification(`You logged in at ${new Date().toLocaleString()}`, 'info');
      
      // Send login data via EmailJS
      sendLoginData(email);
     } else {
      showToast("Invalid email or password", "error");
     }
    });

    signupForm.addEventListener("submit", (e) => {
     e.preventDefault();
     const name = document.getElementById("signupName").value;
     const email = document.getElementById("signupEmail").value;
     const phone = document.getElementById("signupPhone").value;
     const password = document.getElementById("signupPassword").value;
     const photo = photoPreview.src;
     
     // Validate inputs
     if (!name || !email || !password) {
      showToast("Please fill in all required fields", "error");
      return;
     }
     
     // Check if user already exists
     const users = loadUsers();
     if (users.some(u => u.email === email)) {
      showToast("Email already registered", "error");
      return;
     }
     
     // Create new user
     const newUser = {
      name,
      email,
      phone,
      password, // In a real app, you would hash the password
      photo,
      createdAt: new Date().toISOString()
     };
     
     // Save user
     users.push(newUser);
     saveUsers(users);
     
     // Login the new user
     currentUser = { ...newUser };
     isLoggedIn = true;
     saveUserData();
     renderSidebarLinks();
     updateAuthUI();
     closeModal(signupModal);
     showToast("Account created successfully!", "success");
     showSection("homeSection");
     
     // Add welcome notification
     addNotification(`Welcome ${name}! Thanks for joining the Rajbanshi family.`, 'success');
     
     // Send signup data via EmailJS
     sendSignupData(name, email, phone);
    });

    // Logout confirmation
    function handleLogout() {
     isLoggedIn = false;
     currentUser = null;
     currentSessionId = null;
     localStorage.removeItem(USER_DATA_KEY);
     document.cookie = 'rajbanshi_user_session=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
     renderSidebarLinks();
     updateAuthUI();
     showSection("homeSection");
     closeSidebar();
     dropdownMenu.classList.remove("show");
     showToast("You have been logged out", "info");
    }

    function showLogoutConfirmation() {
     openModal(confirmationModal);
     dropdownMenu.classList.remove("show");
    }

    confirmLogoutBtn.addEventListener("click", () => {
     closeModal(confirmationModal);
     handleLogout();
    });

    cancelLogoutBtn.addEventListener("click", () => {
     closeModal(confirmationModal);
     showSection("homeSection");
    });

    sidebarAuthLink.addEventListener("click", (e) => {
     e.preventDefault();
     showLogoutConfirmation();
    });

    logoutDropdownBtn.addEventListener("click", (e) => {
     e.preventDefault();
     showLogoutConfirmation();
    });

    // Notification dropdown button
    notificationDropdownBtn.addEventListener("click", (e) => {
     e.preventDefault();
     openModal(notificationModal);
     renderNotifications();
     dropdownMenu.classList.remove("show");
    });

    // Clear notifications button
    clearNotificationsBtn.addEventListener("click", (e) => {
     e.preventDefault();
     clearNotifications();
    });

    // View contacts button
    viewContactsBtn.addEventListener("click", (e) => {
     e.preventDefault();
     openModal(contactsModal);
     
     // Populate contacts list
     contactsList.innerHTML = '';
     const members = [
      { name: "John Smith", phone: "+1 555-123-4567" },
      { name: "Mary Smith", phone: "+1 555-234-5678" },
      { name: "Emily Smith", phone: "+1 555-345-6789" },
      { name: "Michael Smith", phone: "+1 555-456-7890" },
      { name: "Sarah Smith", phone: "+1 555-567-8901" }
     ];
     
     members.forEach(member => {
      const row = document.createElement('tr');
      row.innerHTML = `
       <td class="py-2">${member.name}</td>
       <td class="py-2">${member.phone}</td>
      `;
      contactsList.appendChild(row);
     });
    });

    // View sessions button
    viewSessionsBtn.addEventListener("click", (e) => {
     e.preventDefault();
     openModal(sessionsModal);
     renderSessions();
    });

    sessionsDropdownBtn.addEventListener("click", (e) => {
     e.preventDefault();
     openModal(sessionsModal);
     renderSessions();
     dropdownMenu.classList.remove("show");
    });

    // Logout other sessions button
    logoutOtherSessionsBtn.addEventListener("click", (e) => {
     e.preventDefault();
     logoutOtherDevices();
    });

    // Close modals when clicking outside
    document.addEventListener("click", (e) => {
     if (e.target.classList.contains('modal')) {
      closeModal(e.target);
     }
    });
    
    // Profile and Dashboard dropdown buttons
    profileDropdownBtn.addEventListener("click", (e) => {
     e.preventDefault();
     showSection("profileSection");
     dropdownMenu.classList.remove("show");
    });
    
    dashboardDropdownBtn.addEventListener("click", (e) => {
     e.preventDefault();
     showSection("dashboardSection");
     dropdownMenu.classList.remove("show");
    });
    
    // Calendar dropdown button
    calendarDropdownBtn.addEventListener("click", (e) => {
     e.preventDefault();
     showSection("calendarSection");
     dropdownMenu.classList.remove("show");
    });
    
    // Calendar navigation
    prevMonthBtn.addEventListener("click", () => {
     navigateMonth('prev');
    });
    
    nextMonthBtn.addEventListener("click", () => {
     navigateMonth('next');
    });
    
    // Download app button
    downloadAppBtn.addEventListener("click", (e) => {
     e.preventDefault();
     showToast("App download will be available soon!", "info");
    });
   }
   const { jsPDF } = window.jspdf;

function downloadPDF(title, date, location, description) {
  const doc = new jsPDF({
    unit: 'pt',
    format: 'a4',
  });

  const pageWidth = doc.internal.pageSize.getWidth();
  const margin = 40;
  let y = 60;

  // Title
  doc.setFont('helvetica', 'bold');
  doc.setFontSize(22);
  doc.setTextColor('#4c51bf'); // Indigo-700
  doc.text(title, pageWidth / 2, y, { align: 'center' });

  y += 30;

  // Horizontal line
  doc.setDrawColor('#cbd5e0'); // gray-300
  doc.setLineWidth(1);
  doc.line(margin, y, pageWidth - margin, y);

  y += 30;

  // Date
  doc.setFont('helvetica', 'normal');
  doc.setFontSize(14);
  doc.setTextColor('#4c51bf'); // Indigo-700
  doc.text('Date:', margin, y);
  doc.setTextColor('#2d3748'); // gray-800
  doc.text(date.replace('Date: ', ''), margin + 50, y);

  y += 25;

  // Location
  doc.setTextColor('#4c51bf'); // Indigo-700
  doc.text('Location:', margin, y);
  doc.setTextColor('#2d3748'); // gray-800
  doc.text(location.replace('Location: ', ''), margin + 70, y);

  y += 40;

  // Description box with background and bold font
  const descriptionLines = doc.splitTextToSize(description, pageWidth - margin * 2 - 20);
  const boxHeight = descriptionLines.length * 18 + 20;

  doc.setFillColor('#ebf4ff'); // Indigo-100
  doc.roundedRect(margin, y, pageWidth - margin * 2, boxHeight, 8, 8, 'F');

  doc.setTextColor('#2d3748'); // gray-800
  doc.setFontSize(13);
  doc.setFont('helvetica', 'bold');
  doc.text(descriptionLines, margin + 10, y + 25);

  y += boxHeight + 40;

  // Footer
  doc.setFontSize(10);
  doc.setTextColor('#a0aec0'); // gray-400
  doc.setFont('helvetica', 'normal');
  doc.text('Rajbanshi Family Events', pageWidth / 2, y, { align: 'center' });

  doc.save(title.toLowerCase().replace(/\s+/g, '_') + '.pdf');
}
   // Initialize the app
   initApp();
  </script>
</body>
</html>
