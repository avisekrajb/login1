
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>MyApp with Login & Sign Up Modal, Profile, Notifications</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet"/>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    body {
      font-family: 'Inter', sans-serif;
      -webkit-tap-highlight-color: transparent;
    }
    .transition-slow {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }
    .transition-fast {
      transition: all 0.15s cubic-bezier(0.4, 0, 0.2, 1);
    }
    ::-webkit-scrollbar {
      width: 6px;
      height: 6px;
    }
    ::-webkit-scrollbar-track {
      background: #f1f1f1;
    }
    ::-webkit-scrollbar-thumb {
      background: #888;
      border-radius: 3px;
    }
    ::-webkit-scrollbar-thumb:hover {
      background: #555;
    }
    .nav-btn.active::after {
      content: '';
      position: absolute;
      top: -4px;
      left: 50%;
      transform: translateX(-50%);
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background-color: #4f46e5;
    }
    .sidebar-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      z-index: 40;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
    }
    .sidebar-overlay.active {
      opacity: 1;
      pointer-events: auto;
    }
    @keyframes modalEnter {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }
    .modal-animation {
      animation: modalEnter 0.2s ease-out forwards;
    }
    @keyframes marquee {
      0%   { transform: translateX(100%); }
      100% { transform: translateX(-100%); }
    }
    .marquee {
      white-space: nowrap;
      display: block;
      animation: marquee 15s linear infinite;
    }
    /* Toast container */
    #toastContainer {
      position: fixed;
      bottom: 5rem;
      left: auto;
      right: 1.5rem;
      z-index: 9999;
      display: flex;
      flex-direction: column;
      gap: 0.5rem;
      max-width: 90vw;
      width: 360px;
    }
    .profile-card {
      background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
      border-radius: 12px;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }
    .profile-stats {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(5px);
      border-radius: 8px;
    }
    .progress-ring {
      transform: rotate(-90deg);
    }
    .progress-ring-circle {
      stroke-dasharray: 283;
      stroke-dashoffset: 283;
      transition: stroke-dashoffset 0.7s ease-in-out;
    }
    .notification-modal {
      width: 320px;
      max-height: 400px;
      margin: 0 auto;
    }
    .edit-input {
      background-color: #f9fafb;
      border: 1px solid #e5e7eb;
      border-radius: 6px;
      padding: 4px 8px;
      width: 100%;
    }
    /* Additional styles for account section */
    #sidebar-account .account-fullname {
      color: #dc2626; /* red-600 */
      font-weight: 700;
      font-size: 1.25rem;
      margin-bottom: 1rem;
    }
    .export-btn {
      background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      color: white;
    }
    .export-btn:hover {
      background: linear-gradient(135deg, #059669 0%, #047857 100%);
    }
    .delete-btn {
      background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
      color: white;
    }
    .delete-btn:hover {
      background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
    }
  </style>
</head>
<body class="bg-gray-50 min-h-screen flex flex-col">
  <!-- Sidebar overlay for mobile -->
  <div class="sidebar-overlay" id="sidebarOverlay"></div>
  
  <!-- Header -->
  <header class="flex items-center justify-between px-4 py-3 bg-white shadow-sm fixed top-0 left-0 right-0 z-40 transition-fast">
    <div class="flex items-center space-x-3">
      <!-- Sidebar menu icon -->
      <button aria-label="Toggle sidebar menu" class="text-gray-700 text-xl focus:outline-none rounded-md p-2 hover:bg-gray-100 transition-fast" id="sidebarToggle">
        <i class="fas fa-bars"></i>
      </button>
      <h1 class="text-xl font-semibold text-gray-900">
        MyApp
      </h1>
    </div>
    <div class="relative flex items-center space-x-4">
      <!-- Notification icon -->
      <div class="relative hidden" id="notificationContainer">
        <button aria-expanded="false" aria-haspopup="true" id="notificationBtn" class="text-gray-700 text-xl focus:outline-none rounded-md p-2 hover:bg-gray-100 transition-fast relative" title="Notifications">
          <i class="fas fa-bell"></i>
          <span id="notificationCount" class="absolute -top-1 -right-1 bg-red-600 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center font-semibold">0</span>
        </button>
        <div aria-labelledby="notificationBtn" aria-orientation="vertical" class="absolute right-0 mt-2 notification-modal bg-white rounded-lg shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none z-50 overflow-auto transition-slow origin-top-right transform opacity-0 scale-95 hidden" id="notificationDropdown" role="menu">
          <div class="p-4 border-b border-gray-200 flex justify-between items-center">
            <h3 class="text-lg font-semibold text-gray-900">Notifications</h3>
            <button id="clearNotificationsBtn" class="text-sm text-indigo-600 hover:text-indigo-800 focus:outline-none transition-fast">Clear All</button>
          </div>
          <ul id="notificationList" class="divide-y divide-gray-200 max-h-64 overflow-auto">
          </ul>
          <div id="noNotifications" class="p-3 text-center text-gray-500 text-sm hidden">
            No notifications
          </div>
        </div>
      </div>
      <!-- Profile icon with dropdown -->
      <div class="relative">
        <button aria-expanded="false" aria-haspopup="true" class="flex items-center space-x-2 focus:outline-none rounded-full p-1 hover:bg-gray-100 transition-fast" id="profileBtn" title="Profile menu">
          <img alt="Profile icon showing a generic user silhouette in blue background" class="w-10 h-10 rounded-full object-cover border-2 border-indigo-100" height="40" src="https://placehold.co/80x80/png?text=User+Icon" width="40" id="headerProfilePhoto"/>
          <i class="fas fa-caret-down text-gray-500 text-sm"></i>
        </button>
        <div aria-labelledby="profileBtn" aria-orientation="vertical" class="absolute right-0 mt-2 w-48 bg-white rounded-lg shadow-lg ring-1 ring-black ring-opacity-5 focus:outline-none z-50 overflow-hidden transition-slow origin-top-right transform opacity-0 scale-95 hidden" id="profileDropdown" role="menu">
          <button id="profileDropdownProfile" class="w-full text-left block px-4 py-2.5 text-gray-700 hover:bg-indigo-50 hover:text-indigo-700 transition-fast flex items-center" role="menuitem">
            <i class="fas fa-user mr-2 text-sm"></i> Profile
          </button>
          <button id="profileDropdownDashboard" class="w-full text-left block px-4 py-2.5 text-gray-700 hover:bg-indigo-50 hover:text-indigo-700 transition-fast flex items-center" role="menuitem">
            <i class="fas fa-tachometer-alt mr-2 text-sm"></i> Dashboard
          </button>
          <button id="profileDropdownExport" class="w-full text-left block px-4 py-2.5 text-gray-700 hover:bg-green-50 hover:text-green-700 transition-fast flex items-center" role="menuitem">
            <i class="fas fa-file-export mr-2 text-sm"></i> Export Data
          </button>
          <button id="profileDropdownViewProfile" class="w-full text-left block px-4 py-2.5 text-gray-700 hover:bg-indigo-50 hover:text-indigo-700 transition-fast flex items-center" role="menuitem">
            <i class="fas fa-id-card mr-2 text-sm"></i> View Profile
          </button>
          <button id="profileDropdownDelete" class="w-full text-left block px-4 py-2.5 text-gray-700 hover:bg-red-50 hover:text-red-700 transition-fast flex items-center" role="menuitem">
            <i class="fas fa-trash mr-2 text-sm"></i> Delete Account
          </button>
          <button id="profileDropdownLogout" class="w-full text-left block px-4 py-2.5 text-gray-700 hover:bg-red-600 hover:text-white transition-fast flex items-center" role="menuitem">
            <i class="fas fa-sign-out-alt mr-2 text-sm"></i> Logout
          </button>
        </div>
      </div>
    </div>
  </header>

  <!-- Sidebar -->
  <aside class="fixed top-14 left-0 h-[calc(100vh-3.5rem)] w-64 bg-white shadow-lg transform -translate-x-full transition-slow ease-in-out z-50 flex flex-col justify-between" id="sidebar">
    <nav class="mt-4">
      <ul class="space-y-1 px-2">
        <li id="sidebarLoginLi">
          <button id="sidebarLoginBtn" class="sidebar-btn flex w-full items-center space-x-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-indigo-600 hover:text-white focus:outline-none transition-fast" type="button">
            <i class="fas fa-sign-in-alt w-5 text-center"></i>
            <span class="font-medium">Login</span>
          </button>
        </li>
        <li>
          <button aria-controls="sidebar-profile" class="sidebar-btn flex w-full items-center space-x-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-indigo-600 hover:text-white focus:outline-none transition-fast" data-target="sidebar-profile" type="button">
            <i class="fas fa-user-circle w-5 text-center"></i>
            <span class="font-medium">Profile</span>
          </button>
        </li>
        <li>
          <button aria-controls="sidebar-account" class="sidebar-btn flex w-full items-center space-x-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-indigo-600 hover:text-white focus:outline-none transition-fast" data-target="sidebar-account" type="button">
            <i class="fas fa-user-cog w-5 text-center"></i>
            <span class="font-medium">Account</span>
          </button>
        </li>
        <li>
          <button aria-controls="sidebar-members" class="sidebar-btn flex w-full items-center space-x-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-indigo-600 hover:text-white focus:outline-none transition-fast" data-target="sidebar-members" type="button">
            <i class="fas fa-users w-5 text-center"></i>
            <span class="font-medium">Members</span>
          </button>
        </li>
        <li>
          <button aria-controls="sidebar-about" class="sidebar-btn flex w-full items-center space-x-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-indigo-600 hover:text-white focus:outline-none transition-fast" data-target="sidebar-about" type="button">
            <i class="fas fa-info-circle w-5 text-center"></i>
            <span class="font-medium">About</span>
          </button>
        </li>
        <li>
          <button id="joinWhatsappBtn" class="sidebar-btn flex w-full items-center space-x-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-green-600 hover:text-white focus:outline-none transition-fast" type="button">
            <i class="fab fa-whatsapp w-5 text-center"></i>
            <span class="font-medium">Join WhatsApp</span>
          </button>
        </li>
        <li class="mt-6 pt-2 border-t border-gray-100 hidden" id="sidebarLogoutLi">
          <button id="logoutBtn" class="sidebar-btn flex w-full items-center space-x-3 px-4 py-3 rounded-lg text-gray-700 hover:bg-red-600 hover:text-white focus:outline-none transition-fast" type="button">
            <i class="fas fa-sign-out-alt w-5 text-center"></i>
            <span class="font-medium">Logout</span>
          </button>
        </li>
      </ul>
    </nav>
    <div class="px-6 py-4 border-t border-gray-200">
      <h3 class="text-gray-600 font-semibold mb-3">Follow Us</h3>
      <div class="flex space-x-6 justify-center">
        <a href="#" aria-label="Follow us on Facebook" class="text-gray-600 hover:text-indigo-600 transition-fast text-2xl">
          <i class="fab fa-facebook-square"></i>
        </a>
        <a href="#" aria-label="Follow us on Twitter" class="text-gray-600 hover:text-indigo-600 transition-fast text-2xl">
          <i class="fab fa-twitter-square"></i>
        </a>
        <a href="#" aria-label="Follow us on Instagram" class="text-gray-600 hover:text-indigo-600 transition-fast text-2xl">
          <i class="fab fa-instagram-square"></i>
        </a>
        <a href="#" aria-label="Follow us on LinkedIn" class="text-gray-600 hover:text-indigo-600 transition-fast text-2xl">
          <i class="fab fa-linkedin"></i>
        </a>
      </div>
    </div>
  </aside>
  
  <!-- Main content wrapper -->
  <div class="flex-1 flex flex-col pt-14 pb-14 overflow-auto">
    <!-- Content section -->
    <main class="flex-1 p-4 md:p-6 max-w-7xl mx-auto w-full overflow-auto" style="">
      <!-- Home Section -->
      <section id="home" class="mb-8">
        <script src="https://cdn.tailwindcss.com"></script>
        <link
          rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
        />
        <style>
          @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap');
          
          body {
            font-family: 'Poppins', sans-serif;
            background-color: #f8fafc;
            color: #1f2937;
          }
          
          .fade {
            animation-name: fade;
            animation-duration: 1.5s;
          }
          @keyframes fade {
            from {
              opacity: 0.4;
            }
            to {
              opacity: 1;
            }
          }
          
          .circle-image {
            transition: all 0.3s ease;
            border: 3px solid transparent;
          }
          
          .circle-image:hover {
            transform: scale(1.05);
            border-color: #f59e0b;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
          }
          
          .circle-image img {
            object-fit: cover !important;
            object-position: center center !important;
            width: 100% !important;
            height: 100% !important;
            display: block;
          }
          
          .marquee-container {
            background: linear-gradient(135deg, #fef3c7 0%, #fde68a 100%);
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
          }
          
          .modal-content {
            animation: modalFadeIn 0.3s ease-out;
            background: linear-gradient(to bottom right, #ffffff, #f9fafb);
            border-radius: 16px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            max-width: 95vw;
          }
          
          @keyframes modalFadeIn {
            from {
              opacity: 0;
              transform: translateY(20px);
            }
            to {
              opacity: 1;
              transform: translateY(0);
            }
          }
          
          .family-quote {
            font-family: 'Playfair Display', serif;
            letter-spacing: 0.5px;
          }
          
          .modal-close {
            transition: all 0.2s ease;
          }
          
          .modal-close:hover {
            transform: rotate(90deg);
            color: #ef4444;
          }
          
          .read-more-btn {
            transition: all 0.2s ease;
          }
          
          .read-more-btn:hover {
            color: #7c3aed;
            transform: translateY(-2px);
          }
          
          .slideshow-container {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            border-radius: 16px;
          }
          
          .member-name {
            transition: all 0.2s ease;
          }
          
          .member-container:hover .member-name {
            color: #7c3aed;
            transform: translateY(2px);
          }

          /* Slide container with 3 columns and 3 rows */
          .slide {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(2, auto);
            gap: 1.5rem;
            padding: 1.5rem 0;
            box-sizing: border-box;
            justify-items: center;
            max-width: 640px;
            margin-left: auto;
            margin-right: auto;
          }

          /* Each member inside slide */
          .slide .member-container {
            flex: none;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
          }

          /* Welcome header */
          .welcome-header {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            padding: 1rem;
            border-radius: 0 0 12px 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
          }

          /* Responsive adjustments */
          @media (min-width: 640px) {
            .slide {
              gap: 2rem;
              padding: 2rem 0;
            }
            .member-container {
              max-width: 120px;
            }
          }

          @media (max-width: 480px) {
            .slide {
              gap: 1rem;
              padding: 1rem 0;
            }
            .circle-image {
              width: 80px !important;
              height: 80px !important;
            }
            .member-name {
              font-size: 0.875rem;
            }
          }

          @media (max-width: 360px) {
            .slide {
              gap: 0.75rem;
            }
            .circle-image {
              width: 70px !important;
              height: 70px !important;
            }
          }
          
          .animate-modal {
            animation: modalFadeIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
          }
          
          @keyframes modalFadeIn {
            0% {
              opacity: 0;
              transform: translateY(30px) scale(0.95);
            }
            100% {
              opacity: 1;
              transform: translateY(0) scale(1);
            }
          }

          /* Enhanced image container */
          .image-container {
            position: relative;
            height: 0;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            overflow: hidden;
            border-radius: 16px;
          }

          .image-container img {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
          }

          /* Dot indicators */
          .dot-indicators {
            position: absolute;
            bottom: 1rem;
            left: 0;
            right: 0;
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            z-index: 20;
          }

          /* Section container */
          .section-container {
            padding: 1.5rem;
            max-width: 1200px;
            margin: 0 auto;
          }

          /* Member grid title */
          .member-grid-title {
            text-align: center;
            margin-bottom: 1.5rem;
            font-size: 1.25rem;
            font-weight: 600;
            color: #374151;
            position: relative;
          }

          .member-grid-title:after {
            content: "";
            display: block;
            width: 60px;
            height: 3px;
            background: linear-gradient(to right, #7c3aed, #4f46e5);
            margin: 0.5rem auto 0;
            border-radius: 3px;
          }
        </style>

        <!-- Added welcome message -->
        <div class="container mx-auto px-4 mt-4">
          <h2 class="text-sm font-semibold text-gray-900 mb-3 leading-tight" style="line-height: 1.1;">
            Welcome to <a href="#" id="usernameDisplay" class="text-indigo-600 cursor-pointer"></a>
          </h2>
        </div>
    
        <main class="section-container">
          <!-- Image slider -->
          <div class="relative mb-8 overflow-hidden rounded-2xl max-w-5xl mx-auto" id="homeSliderContainer">
            <div class="image-container" id="homeSliderImages">
              <div class="mySlides fade absolute inset-0 opacity-100 z-10">
                <img
                  alt="A warm family gathering in a cozy living room with smiles and laughter"
                  src="https://storage.googleapis.com/a1aa/image/ff725114-5fb8-46fa-f988-97e7585e5709.jpg"
                />
              </div>
              <div class="mySlides fade absolute inset-0 opacity-0 z-0">
                <img
                  alt="Family enjoying a sunny picnic outdoors with children playing and adults chatting"
                  src="https://storage.googleapis.com/a1aa/image/d44ef087-3f5c-4477-ddb6-d3a785299083.jpg"
                />
              </div>
              <div class="mySlides fade absolute inset-0 opacity-0 z-0">
                <img
                  alt="Formal family portrait with multiple generations smiling in a garden setting"
                  src="https://storage.googleapis.com/a1aa/image/a36034d3-3457-4653-511d-dc08e8ce3489.jpg"
                />
              </div>
              <div class="mySlides fade absolute inset-0 opacity-0 z-0">
                <img
                  alt="Family cooking together in a bright kitchen, sharing joyful moments"
                  src="https://storage.googleapis.com/a1aa/image/f710f90b-93b0-490c-fc09-a06d032fed1c.jpg"
                />
              </div>
              <div class="mySlides fade absolute inset-0 opacity-0 z-0">
                <img
                  alt="Family on vacation at the beach, children building sandcastles and parents relaxing"
                  src="https://storage.googleapis.com/a1aa/image/6d1d2aee-e03e-4f21-e9f1-ddc856e09f74.jpg"
                />
              </div>
            </div>
            <!-- Dots -->
            <div class="dot-indicators" id="homeSliderDots">
              <button
                aria-label="Slide 1"
                class="dot h-3 w-3 rounded-full bg-gradient-to-r from-amber-500 to-pink-500 cursor-pointer transition-all duration-300"
                aria-selected="true"
                role="tab"
                tabindex="0"
              ></button>
              <button
                aria-label="Slide 2"
                class="dot h-3 w-3 rounded-full bg-gradient-to-r from-amber-500 to-pink-500 cursor-pointer opacity-50 transition-all duration-300"
                role="tab"
                tabindex="-1"
              ></button>
              <button
                aria-label="Slide 3"
                class="dot h-3 w-3 rounded-full bg-gradient-to-r from-amber-500 to-pink-500 cursor-pointer opacity-50 transition-all duration-300"
                role="tab"
                tabindex="-1"
              ></button>
              <button
                aria-label="Slide 4"
                class="dot h-3 w-3 rounded-full bg-gradient-to-r from-amber-500 to-pink-500 cursor-pointer opacity-50 transition-all duration-300"
                role="tab"
                tabindex="-1"
              ></button>
              <button
                aria-label="Slide 5"
                class="dot h-3 w-3 rounded-full bg-gradient-to-r from-amber-500 to-pink-500 cursor-pointer opacity-50 transition-all duration-300"
                role="tab"
                tabindex="-1"
              ></button>
            </div>
          </div>
          
          <!-- Marquee -->
          <div class="marquee-container p-3 mb-8 max-w-5xl mx-auto rounded-xl" id="homeMarqueeContainer">
            <marquee
              behavior="scroll"
              class="text-lg md:text-xl font-bold text-amber-900"
              direction="left"
              id="marqueeText"
              scrollamount="6"
            >
              üéâ Welcome to Our Family App! Stay connected with your loved ones. ‚ù§Ô∏è
            </marquee>
          </div>

          <!-- Family Members Grid -->
          <h2 class="member-grid-title">Meet Our Family</h2>
          <div class="slide" role="group" aria-label="Family members grid">
            <div class="member-container flex flex-col items-center space-y-2 cursor-pointer focus:outline-none focus:ring-2 focus:ring-indigo-500 rounded-xl transition-all duration-300 hover:-translate-y-1" tabindex="0" aria-label="Emily's portrait" data-member="Emily">
              <div class="rounded-full overflow-hidden h-20 w-20 sm:h-24 sm:w-24 circle-image shadow-lg border-2 border-white" aria-label="">
                <img src="https://storage.googleapis.com/a1aa/image/dbc46861-8019-45a8-95da-25d6581b9329.jpg" alt="Portrait of a smiling young woman with long brown hair and green eyes" class="hover:scale-105 transition-transform duration-300">
              </div>
              <span class="member-name text-center text-gray-800 font-medium text-sm sm:text-base">Emily</span>
            </div>
            <div class="member-container flex flex-col items-center space-y-2 cursor-pointer focus:outline-none focus:ring-2 focus:ring-indigo-500 rounded-xl transition-all duration-300 hover:-translate-y-1" tabindex="0" aria-label="Michael's portrait" data-member="Michael">
              <div class="rounded-full overflow-hidden h-20 w-20 sm:h-24 sm:w-24 circle-image shadow-lg border-2 border-white" aria-label="">
                <img src="https://storage.googleapis.com/a1aa/image/c30694c7-6765-49a7-18d6-3cbfd7854e04.jpg" alt="Portrait of a middle-aged man with glasses and a friendly smile" class="hover:scale-105 transition-transform duration-300">
              </div>
              <span class="member-name text-center text-gray-800 font-medium text-sm sm:text-base">Michael</span>
            </div>
            <div class="member-container flex flex-col items-center space-y-2 cursor-pointer focus:outline-none focus:ring-2 focus:ring-indigo-500 rounded-xl transition-all duration-300 hover:-translate-y-1" tabindex="0" aria-label="Liam's portrait" data-member="Liam">
              <div class="rounded-full overflow-hidden h-20 w-20 sm:h-24 sm:w-24 circle-image shadow-lg border-2 border-white" aria-label="">
                <img src="https://storage.googleapis.com/a1aa/image/df09939a-ab25-458a-35a0-0e5ad0679ab7.jpg" alt="Portrait of a young boy with curly hair and bright eyes" class="hover:scale-105 transition-transform duration-300">
              </div>
              <span class="member-name text-center text-gray-800 font-medium text-sm sm:text-base">Liam</span>
            </div>
            <div class="member-container flex flex-col items-center space-y-2 cursor-pointer focus:outline-none focus:ring-2 focus:ring-indigo-500 rounded-xl transition-all duration-300 hover:-translate-y-1" tabindex="0" aria-label="Grace's portrait" data-member="Grace">
              <div class="rounded-full overflow-hidden h-20 w-20 sm:h-24 sm:w-24 circle-image shadow-lg border-2 border-white" aria-label="">
                <img src="https://storage.googleapis.com/a1aa/image/47800ca3-e9a1-4e0e-09be-8c5e2aaf644b.jpg" alt="Portrait of an elderly woman with silver hair and a warm smile" class="hover:scale-105 transition-transform duration-300">
              </div>
              <span class="member-name text-center text-gray-800 font-medium text-sm sm:text-base">Grace</span>
            </div>
            <div class="member-container flex flex-col items-center space-y-2 cursor-pointer focus:outline-none focus:ring-2 focus:ring-indigo-500 rounded-xl transition-all duration-300 hover:-translate-y-1" tabindex="0" aria-label="Anna's portrait" data-member="Anna">
              <div class="rounded-full overflow-hidden h-20 w-20 sm:h-24 sm:w-24 circle-image shadow-lg border-2 border-white" aria-label="">
                <img src="https://storage.googleapis.com/a1aa/image/c193c423-1eca-4edd-9680-1e640d578890.jpg" alt="Portrait of a smiling young woman with short black hair and bright eyes" class="hover:scale-105 transition-transform duration-300">
              </div>
              <span class="member-name text-center text-gray-800 font-medium text-sm sm:text-base">Anna</span>
            </div>
            <div class="member-container flex flex-col items-center space-y-2 cursor-pointer focus:outline-none focus:ring-2 focus:ring-indigo-500 rounded-xl transition-all duration-300 hover:-translate-y-1" tabindex="0" aria-label="Sophia's portrait" data-member="Sophia">
              <div class="rounded-full overflow-hidden h-20 w-20 sm:h-24 sm:w-24 circle-image shadow-lg border-2 border-white" aria-label="">
                <img src="https://storage.googleapis.com/a1aa/image/4d6f89d2-b8ae-46af-39b7-571b40721249.jpg" alt="Portrait of a young girl with blonde hair and blue eyes" class="hover:scale-105 transition-transform duration-300">
              </div>
              <span class="member-name text-center text-gray-800 font-medium text-sm sm:text-base">Sophia</span>
            </div>
          </div>
        </main>

        <!-- Modal -->
        <div id="modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center p-4 hidden z-50 backdrop-blur-sm">
          <div class="modal-content w-full max-w-md relative overflow-hidden">
            <div class="absolute inset-0 bg-gradient-to-br from-white to-gray-100 opacity-90"></div>
            <div class="relative z-10">
              <button id="modalClose" aria-label="Close modal" class="modal-close absolute top-4 right-4 text-gray-600 hover:text-gray-900 text-3xl font-bold leading-none focus:outline-none z-20">&times;</button>
              <div class="p-6 sm:p-8 text-center">
                <div class="mx-auto rounded-full overflow-hidden h-32 w-32 circle-image shadow-xl mb-6 border-4 border-white/70 relative z-10">
                  <img id="modalImage" alt="" class="object-cover w-full h-full" />
                </div>
                <h3 id="modalName" class="text-2xl sm:text-3xl font-bold mb-1 text-gray-800"></h3>
                <p id="modalAge" class="text-gray-600 mb-5 text-base sm:text-lg"></p>
                <button id="modalReadMoreBtn" class="read-more-btn text-indigo-600 font-semibold text-base sm:text-lg mb-6 focus:outline-none flex items-center justify-center mx-auto">
                  <span>Read More</span>
                  <svg class="w-5 h-5 ml-1 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                  </svg>
                </button>
                <p id="modalBio" class="text-gray-700 text-left max-w-prose mx-auto hidden px-4 pb-4 text-sm sm:text-md leading-relaxed"></p>
              </div>
            </div>
            <div class="absolute bottom-0 left-0 right-0 h-1 bg-gradient-to-r from-indigo-500 via-purple-500 to-pink-500"></div>
          </div>
        </div>

        <script>
          // Data for family members
          const familyMembers = {
            Emily: {
              name: "Emily",
              age: 28,
              img: "https://storage.googleapis.com/a1aa/image/dbc46861-8019-45a8-95da-25d6581b9329.jpg",
              alt: "Portrait of a smiling young woman with long brown hair and green eyes",
              bio: "Emily is a passionate artist who loves painting landscapes. She enjoys hiking and exploring nature on weekends. Her artwork has been featured in several local galleries, and she often organizes family art sessions on Sunday afternoons."
            },
            Michael: {
              name: "Michael",
              age: 45,
              img: "https://storage.googleapis.com/a1aa/image/c30694c7-6765-49a7-18d6-3cbfd7854e04.jpg",
              alt: "Portrait of a middle-aged man with glasses and a friendly smile",
              bio: "Michael is a software engineer with a love for technology and innovation. He spends his free time coaching youth soccer and building smart home gadgets. Known as the family's tech support, he's always eager to help with any digital challenges."
            },
            Liam: {
              name: "Liam",
              age: 10,
              img: "https://storage.googleapis.com/a1aa/image/df09939a-ab25-458a-35a0-0e5ad0679ab7.jpg",
              alt: "Portrait of a young boy with curly hair and bright eyes",
              bio: "Liam is an energetic boy who loves playing soccer and video games. He is curious and enjoys learning about space and dinosaurs. The youngest in the family, he keeps everyone entertained with his endless questions and imaginative stories."
            },
            Grace: {
              name: "Grace",
              age: 70,
              img: "https://storage.googleapis.com/a1aa/image/47800ca3-e9a1-4e0e-09be-8c5e2aaf644b.jpg",
              alt: "Portrait of an elderly woman with silver hair and a warm smile",
              bio: "Grace is the family matriarch who loves gardening and baking. She cherishes family gatherings and storytelling, often sharing tales from her childhood. Her famous apple pie has won several county fair awards and is a staple at all family celebrations."
            },
            Anna: {
              name: "Anna",
              age: 25,
              img: "https://storage.googleapis.com/a1aa/image/c193c423-1eca-4edd-9680-1e640d578890.jpg",
              alt: "Portrait of a smiling young woman with short black hair and bright eyes",
              bio: "Anna is a graphic designer passionate about creativity and design. She enjoys traveling and photography, documenting family events with her professional camera. She designed the family's annual holiday cards for the past five years."
            },
            Sophia: {
              name: "Sophia",
              age: 8,
              img: "https://storage.googleapis.com/a1aa/image/4d6f89d2-b8ae-46af-39b7-571b40721249.jpg",
              alt: "Portrait of a young girl with blonde hair and blue eyes",
              bio: "Sophia is a bright and cheerful girl who loves dancing and drawing. She enjoys spending time with her friends and cousins. The family's little performer, she puts on dance shows every holiday and has recently started learning the piano."
            }
          };

          // Modal elements
          const modal = document.getElementById("modal");
          const modalImage = document.getElementById("modalImage");
          const modalName = document.getElementById("modalName");
          const modalAge = document.getElementById("modalAge");
          const modalBio = document.getElementById("modalBio");
          const modalReadMoreBtn = document.getElementById("modalReadMoreBtn");
          const modalClose = document.getElementById("modalClose");

          let bioVisible = false;

          function openModal(member) {
            modalImage.src = member.img;
            modalImage.alt = member.alt;
            modalName.textContent = member.name;
            modalAge.textContent = `${member.age} years young`;
            modalBio.textContent = member.bio;
            modalBio.classList.add("hidden");
            bioVisible = false;
            modalReadMoreBtn.innerHTML = '<span>Read More</span><svg class="w-5 h-5 ml-1 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>';
            modal.classList.remove("hidden");
            document.body.style.overflow = "hidden";
            
            // Add animation class
            modal.querySelector('.modal-content').classList.add('animate-modal');
            
            // Focus on close button for accessibility
            setTimeout(() => {
              modalClose.focus();
            }, 100);
          }

          modalReadMoreBtn.addEventListener("click", () => {
            bioVisible = !bioVisible;
            if (bioVisible) {
              modalBio.classList.remove("hidden");
              modalReadMoreBtn.innerHTML = '<span>Read Less</span><svg class="w-5 h-5 ml-1 transition-transform duration-300 rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>';
            } else {
              modalBio.classList.add("hidden");
              modalReadMoreBtn.innerHTML = '<span>Read More</span><svg class="w-5 h-5 ml-1 transition-transform duration-300" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>';
            }
          });

          modalClose.addEventListener("click", closeModal);
          modal.addEventListener("click", (e) => {
            if (e.target === modal) {
              closeModal();
            }
          });

          document.addEventListener("keydown", (e) => {
            if (e.key === "Escape" && !modal.classList.contains("hidden")) {
              closeModal();
            }
          });

          function closeModal() {
            modal.querySelector('.modal-content').classList.remove('animate-modal');
            modal.classList.add("hidden");
            document.body.style.overflow = "";
          }

          // Add click and keyboard event listeners to all member containers
          document.addEventListener('DOMContentLoaded', () => {
            const memberContainers = document.querySelectorAll('.member-container[data-member]');
            memberContainers.forEach(container => {
              const memberKey = container.getAttribute('data-member');
              const memberData = familyMembers[memberKey];
              if (!memberData) return;

              container.addEventListener('click', () => openModal(memberData));
              container.addEventListener('keydown', (e) => {
                if (e.key === "Enter" || e.key === " ") {
                  e.preventDefault();
                  openModal(memberData);
                }
              });
            });
          });

          // Slideshow functionality
          let slideIndex = 0;
          const slides = document.querySelectorAll('.mySlides');
          const dots = document.querySelectorAll('.dot');
          const homeSliderContainer = document.getElementById('homeSliderContainer');
          const homeSliderImages = document.getElementById('homeSliderImages');
          const homeSliderDots = document.getElementById('homeSliderDots');
          const homeMarqueeContainer = document.getElementById('homeMarqueeContainer');

          function showSlide(index) {
            if (index >= slides.length) slideIndex = 0;
            if (index < 0) slideIndex = slides.length - 1;

            slides.forEach((slide, i) => {
              if (i === slideIndex) {
                slide.style.opacity = "1";
                slide.style.zIndex = "10";
                slide.classList.add('fade');
                dots[i].classList.remove('opacity-50');
                dots[i].setAttribute('aria-selected', 'true');
                dots[i].tabIndex = 0;
              } else {
                slide.style.opacity = "0";
                slide.style.zIndex = "0";
                slide.classList.remove('fade');
                dots[i].classList.add('opacity-50');
                dots[i].setAttribute('aria-selected', 'false');
                dots[i].tabIndex = -1;
              }
            });
          }

          function nextSlide() {
            slideIndex++;
            showSlide(slideIndex);
          }

          function goToSlide(n) {
            slideIndex = n;
            showSlide(slideIndex);
          }

          // Initialize slideshow
          showSlide(slideIndex);

          // Auto slide every 5 seconds
          let slideInterval = setInterval(nextSlide, 5000);

          // Dot navigation
          dots.forEach((dot, i) => {
            dot.addEventListener('click', () => {
              clearInterval(slideInterval);
              goToSlide(i);
              slideInterval = setInterval(nextSlide, 5000);
            });
            dot.addEventListener('keydown', (e) => {
              if (e.key === 'Enter' || e.key === ' ') {
                e.preventDefault();
                clearInterval(slideInterval);
                goToSlide(i);
                slideInterval = setInterval(nextSlide, 5000);
              }
            });
          });

          // Update username if available
          const usernameDisplay = document.getElementById('usernameDisplay');
          const storedUsername = localStorage.getItem('familyAppUsername');
          if (storedUsername) {
            usernameDisplay.textContent = storedUsername;
          } else {
            usernameDisplay.textContent = "Guest";
          }

          // Hide home slider and marquee when any popup is visible
          function toggleHomeSliderVisibility(visible) {
            if (visible) {
              homeSliderContainer.style.display = '';
              homeMarqueeContainer.style.display = '';
            } else {
              homeSliderContainer.style.display = 'none';
              homeMarqueeContainer.style.display = 'none';
            }
          }

          // Observe popup visibility to hide/show home slider and marquee
          const popups = [
            document.getElementById('loginModal'),
            document.getElementById('signUpModal'),
            document.getElementById('joinWhatsappModal'),
            document.getElementById('logoutModal'),
            document.getElementById('deleteAccountModal'),
            document.getElementById('modal')
          ];

          function checkPopups() {
            const anyVisible = popups.some(p => !p.classList.contains('hidden'));
            toggleHomeSliderVisibility(!anyVisible);
          }

          // Monitor popup show/hide by overriding showPopup and hidePopup
          const originalShowPopup = window.showPopup;
          const originalHidePopup = window.hidePopup;

          window.showPopup = function(modal) {
            originalShowPopup(modal);
            checkPopups();
          };

          window.hidePopup = function(modal) {
            originalHidePopup(modal);
            setTimeout(checkPopups, 250);
          };

          // Also check on page load
          window.addEventListener('load', () => {
            checkPopups();
          });
        </script>
      </section>
      <section id="events" class="mb-8 hidden">
        <h2 class="text-2xl md:text-3xl font-semibold text-gray-900 mb-3">Events</h2>
        <p class="text-gray-700 max-w-3xl mb-4">
          Explore upcoming events and mark your calendar.
        </p>
      </section>
      <section id="news" class="mb-8 hidden">
        <h2 class="text-2xl md:text-3xl font-semibold text-gray-900 mb-3">News</h2>
        <p class="text-gray-700 max-w-3xl mb-4">
          Stay updated with the latest news and announcements.
        </p>
      </section>
      <section id="dashboard" class="mb-8 hidden">
        <h2 class="text-2xl md:text-3xl font-semibold text-gray-900 mb-3">Dashboard</h2>
        <p class="text-gray-700 max-w-3xl mb-4">
          View your dashboard with personalized stats and insights.
        </p>
      </section>
      <section id="gallery" class="mb-8 hidden">
        <h2 class="text-2xl md:text-3xl font-semibold text-gray-900 mb-3">Gallery</h2>
        <p class="text-gray-700 max-w-3xl mb-4">
          Browse through the gallery of images and media.
        </p>
      </section>
      
      <!-- Sidebar Sections -->
      <section id="sidebar-profile" class="mb-8 hidden">
        <div class="profile-card p-6 text-white mb-6">
          <div class="flex items-center space-x-4 mb-4">
            <img alt="User profile photo" id="profilePhotoThumbnail" class="w-16 h-16 rounded-full object-cover border-4 border-white/30" src="https://placehold.co/80x80/png?text=User+Icon"/>
            <div>
              <h2 class="text-xl font-bold" id="profileFullName">Guest User</h2>
              <p class="text-white/80 text-sm" id="profileEmail">guest@example.com</p>
            </div>
          </div>
          <div class="grid grid-cols-3 gap-2 text-center">
            <div class="profile-stats p-2">
              <p class="text-xs text-white/70">Age</p>
              <p class="font-bold" id="profileAge">--</p>
            </div>
            <div class="profile-stats p-2">
              <p class="text-xs text-white/70">Gender</p>
              <p class="font-bold" id="profileGender">--</p>
            </div>
            <div class="profile-stats p-2">
              <p class="text-xs text-white/70">Member</p>
              <p class="font-bold" id="profileMemberSince">--</p>
            </div>
          </div>
        </div>
        
        <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
          <h3 class="text-lg font-semibold text-gray-900 mb-4">Profile Completion</h3>
          <div class="flex items-center space-x-4">
            <div class="relative w-16 h-16">
              <svg class="progress-ring w-16 h-16" viewBox="0 0 100 100">
                <circle class="text-gray-200" stroke-width="8" stroke="currentColor" fill="transparent" r="45" cx="50" cy="50"/>
                <circle class="progress-ring-circle text-indigo-600" stroke-width="8" stroke-linecap="round" stroke="currentColor" fill="transparent" r="45" cx="50" cy="50"/>
              </svg>
              <span class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-sm font-bold text-gray-700" id="completionPercent">0%</span>
            </div>
            <div class="flex-1">
              <div class="flex justify-between text-sm mb-1">
                <span class="text-gray-600">Profile Strength</span>
                <span class="font-medium text-gray-900" id="profileStrength">Low</span>
              </div>
              <div class="grid grid-cols-5 gap-1 text-xs text-gray-500">
                <div class="h-1 rounded-full bg-indigo-600"></div>
                <div class="h-1 rounded-full bg-gray-200"></div>
                <div class="h-1 rounded-full bg-gray-200"></div>
                <div class="h-1 rounded-full bg-gray-200"></div>
                <div class="h-1 rounded-full bg-gray-200"></div>
              </div>
            </div>
          </div>
        </div>
        
        <div class="bg-white rounded-lg shadow-sm overflow-hidden">
          <h3 class="text-lg font-semibold text-gray-900 px-6 py-4 border-b border-gray-200">Personal Information</h3>
          <div class="divide-y divide-gray-200">
            <div class="px-6 py-4 flex justify-between">
              <div>
                <p class="text-sm text-gray-500">Full Name</p>
                <p class="font-medium text-gray-900" id="profileInfoName">--</p>
                <input type="text" id="editNameInput" class="edit-input hidden mt-2" placeholder="Enter full name">
              </div>
              <button class="text-indigo-600 hover:text-indigo-800 text-sm font-medium" id="editNameBtn">Edit</button>
              <button class="text-indigo-600 hover:text-indigo-800 text-sm font-medium hidden" id="saveNameBtn">Save</button>
              <button class="text-gray-500 hover:text-gray-700 text-sm font-medium hidden" id="cancelNameBtn">Cancel</button>
            </div>
            <div class="px-6 py-4 flex justify-between">
              <div>
                <p class="text-sm text-gray-500">Email</p>
                <p class="font-medium text-gray-900" id="profileInfoEmail">--</p>
              </div>
              <button class="text-gray-400 text-sm font-medium cursor-not-allowed" disabled>Edit</button>
            </div>
            <div class="px-6 py-4 flex justify-between">
              <div>
                <p class="text-sm text-gray-500">Phone</p>
                <p class="font-medium text-gray-900" id="profileInfoPhone">--</p>
                <input type="tel" id="editPhoneInput" class="edit-input hidden mt-2" placeholder="Enter phone number" pattern="^\d{10}$">
              </div>
              <button class="text-indigo-600 hover:text-indigo-800 text-sm font-medium" id="editPhoneBtn">Edit</button>
              <button class="text-indigo-600 hover:text-indigo-800 text-sm font-medium hidden" id="savePhoneBtn">Save</button>
              <button class="text-gray-500 hover:text-gray-700 text-sm font-medium hidden" id="cancelPhoneBtn">Cancel</button>
            </div>
            <div class="px-6 py-4 flex justify-between">
              <div>
                <p class="text-sm text-gray-500">Gender</p>
                <p class="font-medium text-gray-900" id="profileInfoGender">--</p>
                <div class="flex items-center space-x-4 mt-2 hidden" id="editGenderInput">
                  <label class="inline-flex items-center">
                    <input type="checkbox" name="editGender" value="Male" class="form-checkbox h-5 w-5 text-indigo-600">
                    <span class="ml-2 text-gray-700">Male</span>
                  </label>
                  <label class="inline-flex items-center">
                    <input type="checkbox" name="editGender" value="Female" class="form-checkbox h-5 w-5 text-indigo-600">
                    <span class="ml-2 text-gray-700">Female</span>
                  </label>
                </div>
              </div>
              <button class="text-indigo-600 hover:text-indigo-800 text-sm font-medium" id="editGenderBtn">Edit</button>
              <button class="text-indigo-600 hover:text-indigo-800 text-sm font-medium hidden" id="saveGenderBtn">Save</button>
              <button class="text-gray-500 hover:text-gray-700 text-sm font-medium hidden" id="cancelGenderBtn">Cancel</button>
            </div>
            <div class="px-6 py-4 flex justify-between items-center">
              <div>
                <p class="text-sm text-gray-500">Profile Photo</p>
                <img id="profilePhotoEditPreview" alt="Profile photo preview" class="mt-2 w-24 h-24 rounded-full object-cover border-2 border-indigo-600"/>
              </div>
              <div class="flex flex-col space-y-2">
                <input type="file" id="profilePhotoUpload" accept="image/*" class="hidden" />
                <button id="editPhotoBtn" class="text-indigo-600 hover:text-indigo-800 text-sm font-medium">Change</button>
                <button id="savePhotoBtn" class="text-indigo-600 hover:text-indigo-800 text-sm font-medium hidden">Save</button>
                <button id="cancelPhotoBtn" class="text-gray-500 hover:text-gray-700 text-sm font-medium hidden">Cancel</button>
              </div>
            </div>
          </div>
        </div>
      </section>
      <section id="sidebar-account" class="mb-8 hidden">
        <div class="bg-white rounded-lg shadow-sm p-6">
          <h2 class="account-fullname">Account Settings</h2>
          <div class="space-y-4">
            <div class="p-4 border border-gray-200 rounded-lg">
              <h3 class="text-lg font-semibold mb-2">Export Data</h3>
              <p class="text-gray-600 mb-4">Download all your account data in PDF format</p>
              <button id="exportDataBtn" class="export-btn px-4 py-2 rounded-lg font-medium focus:outline-none focus:ring-2 focus:ring-green-500 transition-fast flex items-center justify-center">
                <i class="fas fa-file-export mr-2"></i> Export Data
              </button>
            </div>
            <div class="p-4 border border-gray-200 rounded-lg">
              <h3 class="text-lg font-semibold mb-2">View Profile</h3>
              <p class="text-gray-600 mb-4">View your profile details in a table format</p>
              <button id="viewProfileBtn" class="px-4 py-2 rounded-lg font-medium bg-indigo-600 text-white hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-fast flex items-center justify-center">
                <i class="fas fa-id-card mr-2"></i> View Profile
              </button>
            </div>
            <div class="p-4 border border-gray-200 rounded-lg">
              <h3 class="text-lg font-semibold mb-2">Delete Account</h3>
              <p class="text-gray-600 mb-4">Permanently delete your account and all associated data</p>
              <button id="deleteAccountBtn" class="delete-btn px-4 py-2 rounded-lg font-medium focus:outline-none focus:ring-2 focus:ring-red-500 transition-fast flex items-center justify-center">
                <i class="fas fa-trash mr-2"></i> Delete Account
              </button>
            </div>
          </div>
          <div id="profileTableContainer" class="mt-6 hidden overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200 border border-gray-300 rounded-lg">
              <thead class="bg-indigo-600 text-white">
                <tr>
                  <th class="px-6 py-3 text-left text-sm font-semibold">Field</th>
                  <th class="px-6 py-3 text-left text-sm font-semibold">Value</th>
                </tr>
              </thead>
              <tbody id="profileTableBody" class="bg-white divide-y divide-gray-200">
              </tbody>
            </table>
          </div>
        </div>
      </section>
      <section id="sidebar-members" class="mb-8 hidden">
        <div class="bg-white rounded-lg shadow-sm p-6">
          <h2 class="text-2xl font-semibold text-gray-900 mb-4">Family Members</h2>
          <p class="text-gray-700 mb-6">View and manage your family members</p>
          <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4">
            <div class="border border-gray-200 rounded-lg p-4">
              <div class="flex items-center space-x-3 mb-3">
                <img src="https://storage.googleapis.com/a1aa/image/dbc46861-8019-45a8-95da-25d6581b9329.jpg" alt="Emily" class="w-12 h-12 rounded-full object-cover">
                <div>
                  <h3 class="font-medium">Emily</h3>
                  <p class="text-sm text-gray-500">Daughter</p>
                </div>
              </div>
              <button class="text-indigo-600 hover:text-indigo-800 text-sm font-medium">View Profile</button>
            </div>
            <div class="border border-gray-200 rounded-lg p-4">
              <div class="flex items-center space-x-3 mb-3">
                <img src="https://storage.googleapis.com/a1aa/image/c30694c7-6765-49a7-18d6-3cbfd7854e04.jpg" alt="Michael" class="w-12 h-12 rounded-full object-cover">
                <div>
                  <h3 class="font-medium">Michael</h3>
                  <p class="text-sm text-gray-500">Father</p>
                </div>
              </div>
              <button class="text-indigo-600 hover:text-indigo-800 text-sm font-medium">View Profile</button>
            </div>
            <div class="border border-gray-200 rounded-lg p-4">
              <div class="flex items-center space-x-3 mb-3">
                <img src="https://storage.googleapis.com/a1aa/image/df09939a-ab25-458a-35a0-0e5ad0679ab7.jpg" alt="Liam" class="w-12 h-12 rounded-full object-cover">
                <div>
                  <h3 class="font-medium">Liam</h3>
                  <p class="text-sm text-gray-500">Son</p>
                </div>
              </div>
              <button class="text-indigo-600 hover:text-indigo-800 text-sm font-medium">View Profile</button>
            </div>
          </div>
        </div>
      </section>
      <section id="sidebar-about" class="mb-8 hidden">
        <h2 class="text-2xl md:text-3xl font-semibold text-gray-900 mb-3">About</h2>
      </section>
    </main>
  </div>
  
  <!-- Downside Navbar -->
  <nav class="fixed bottom-0 left-0 right-0 bg-white shadow-inner border-t border-gray-200 flex justify-around items-center h-14 z-30">
    <button aria-controls="home" class="nav-btn active relative flex flex-col items-center justify-center text-indigo-600 focus:outline-none p-2 transition-fast" data-target="home" type="button">
      <i class="fas fa-home text-lg"></i>
      <span class="text-xs mt-1 font-medium">Home</span>
    </button>
    <button aria-controls="events" class="nav-btn relative flex flex-col items-center justify-center text-gray-600 hover:text-indigo-600 focus:outline-none p-2 transition-fast" data-target="events" type="button">
      <i class="fas fa-calendar-alt text-lg"></i>
      <span class="text-xs mt-1">Events</span>
    </button>
    <button aria-controls="news" class="nav-btn relative flex flex-col items-center justify-center text-gray-600 hover:text-indigo-600 focus:outline-none p-2 transition-fast" data-target="news" type="button">
      <i class="fas fa-newspaper text-lg"></i>
      <span class="text-xs mt-1">News</span>
    </button>
    <button aria-controls="dashboard" class="nav-btn relative flex flex-col items-center justify-center text-gray-600 hover:text-indigo-600 focus:outline-none p-2 transition-fast" data-target="dashboard" type="button">
      <i class="fas fa-tachometer-alt text-lg"></i>
      <span class="text-xs mt-1">Dashboard</span>
    </button>
    <button aria-controls="gallery" class="nav-btn relative flex flex-col items-center justify-center text-gray-600 hover:text-indigo-600 focus:outline-none p-2 transition-fast" data-target="gallery" type="button">
      <i class="fas fa-images text-lg"></i>
      <span class="text-xs mt-1">Gallery</span>
    </button>
  </nav>

  <!-- Join WhatsApp Modal -->
  <div aria-hidden="true" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-60 hidden transition-slow opacity-0" id="joinWhatsappModal" role="dialog" aria-modal="true" aria-labelledby="joinWhatsappTitle">
    <div class="bg-white rounded-xl shadow-xl max-w-md w-full mx-4 p-6 modal-animation">
      <div class="flex items-center mb-4">
        <div class="bg-green-100 p-3 rounded-full mr-3">
          <i class="fab fa-whatsapp text-green-600 text-xl"></i>
        </div>
        <h3 class="text-xl font-semibold text-gray-900" id="joinWhatsappTitle">Join WhatsApp Group</h3>
      </div>
      <p class="mb-6 text-gray-700 pl-2">
        Do you want to join the WhatsApp group to stay connected and receive updates?
      </p>
      <div class="flex justify-end space-x-3">
        <button class="px-4 py-2 rounded-lg bg-gray-200 text-gray-700 hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-300 transition-fast" id="joinWhatsappCancel">
          Cancel
        </button>
        <a class="px-4 py-2 rounded-lg bg-green-600 text-white hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-green-500 transition-fast flex items-center" href="https://chat.whatsapp.com/" id="joinWhatsappConfirm" target="_blank" rel="noopener noreferrer">
          <i class="fab fa-whatsapp mr-2"></i> Join Now
        </a>
      </div>
    </div>
  </div>

  <!-- Logout Modal -->
  <div aria-hidden="true" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-60 hidden transition-slow opacity-0" id="logoutModal" role="dialog" aria-modal="true" aria-labelledby="logoutTitle">
    <div class="bg-white rounded-xl shadow-xl max-w-md w-full mx-4 p-6 modal-animation">
      <div class="flex items-center mb-4">
        <div class="bg-red-100 p-3 rounded-full mr-3">
          <i class="fas fa-sign-out-alt text-red-600 text-xl"></i>
        </div>
        <h3 class="text-xl font-semibold text-gray-900" id="logoutTitle">Logout Confirmation</h3>
      </div>
      <p class="mb-6 text-gray-700 pl-2 flex items-center space-x-4">
        <img id="logoutProfilePhoto" alt="Profile photo in logout confirmation" class="w-12 h-12 rounded-full object-cover border-2 border-red-600"/>
        <span>Do you want to logout from the app?</span>
      </p>
      <div class="flex justify-end space-x-3">
        <button class="px-4 py-2 rounded-lg bg-gray-200 text-gray-700 hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-300 transition-fast" id="logoutCancel">
          Cancel
        </button>
        <button class="px-4 py-2 rounded-lg bg-red-600 text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 transition-fast flex items-center" id="logoutConfirm">
          <i class="fas fa-sign-out-alt mr-2"></i> Logout
        </button>
      </div>
    </div>
  </div>

  <!-- Delete Account Modal -->
  <div aria-hidden="true" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-70 hidden transition-slow opacity-0" id="deleteAccountModal" role="dialog" aria-modal="true" aria-labelledby="deleteAccountTitle">
    <div class="bg-white rounded-xl shadow-xl max-w-md w-full mx-4 p-6 modal-animation">
      <div class="flex items-center mb-4">
        <div class="bg-red-100 p-3 rounded-full mr-3">
          <i class="fas fa-exclamation-triangle text-red-600 text-xl"></i>
        </div>
        <h3 class="text-xl font-semibold text-gray-900" id="deleteAccountTitle">Delete Account</h3>
      </div>
      <p class="mb-6 text-gray-700 pl-2 flex items-center space-x-4">
        <img id="deleteProfilePhoto" alt="Profile photo in delete account confirmation" class="w-12 h-12 rounded-full object-cover border-2 border-red-600"/>
        <span>Are you sure you want to delete your account? This action cannot be undone and all your data will be permanently removed.</span>
      </p>
      <div class="flex justify-end space-x-3">
        <button class="px-4 py-2 rounded-lg bg-gray-200 text-gray-700 hover:bg-gray-300 focus:outline-none focus:ring-2 focus:ring-gray-300 transition-fast" id="deleteAccountCancel">
          Cancel
        </button>
        <button class="px-4 py-2 rounded-lg bg-red-600 text-white hover:bg-red-700 focus:outline-none focus:ring-2 focus:ring-red-500 transition-fast flex items-center" id="deleteAccountConfirm">
          <i class="fas fa-trash mr-2"></i> Delete
        </button>
      </div>
    </div>
  </div>

  <!-- Login Modal -->
  <div aria-hidden="true" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-70 hidden transition-slow opacity-0" id="loginModal" role="dialog" aria-modal="true" aria-labelledby="loginTitle">
    <div class="bg-white rounded-xl shadow-xl max-w-md w-full mx-4 p-6 modal-animation">
      <h3 class="text-2xl font-semibold text-gray-900 mb-6" id="loginTitle">Login</h3>
      <form id="loginForm" class="space-y-4">
        <div>
          <label for="loginEmail" class="block text-sm font-medium text-gray-700">Email</label>
          <input type="email" id="loginEmail" name="loginEmail" required autocomplete="email" class="mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 focus:border-indigo-600 focus:ring-indigo-600 sm:text-sm" placeholder="you@example.com"/>
        </div>
        <div>
          <label for="loginPassword" class="block text-sm font-medium text-gray-700">Password</label>
          <input type="password" id="loginPassword" name="loginPassword" required autocomplete="current-password" class="mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 focus:border-indigo-600 focus:ring-indigo-600 sm:text-sm" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"/>
        </div>
        <div class="flex justify-between items-center text-sm">
          <button type="button" id="forgotPasswordBtn" class="text-indigo-600 hover:text-indigo-800 focus:outline-none">Forgot Password?</button>
          <button type="submit" class="inline-flex justify-center rounded-md border border-transparent bg-indigo-600 px-4 py-2 text-white font-semibold hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">Login</button>
        </div>
        <p class="text-center text-sm text-gray-600">
          Don't have an account? <button type="button" id="openSignUpFromLogin" class="text-indigo-600 hover:text-indigo-800 focus:outline-none font-semibold">Sign Up</button>
        </p>
      </form>
    </div>
  </div>

  <!-- Sign Up Modal -->
  <div aria-hidden="true" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-70 hidden transition-slow opacity-0" id="signUpModal" role="dialog" aria-modal="true" aria-labelledby="signUpTitle">
    <div class="bg-white rounded-xl shadow-xl max-w-lg w-full mx-4 p-6 modal-animation overflow-y-auto max-h-[90vh]">
      <h3 class="text-2xl font-semibold text-gray-900 mb-6" id="signUpTitle">Sign Up</h3>
      <form id="signUpForm" class="space-y-4" novalidate>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
          <div>
            <label for="fullName" class="block text-sm font-medium text-gray-700">Full Name</label>
            <input type="text" id="fullName" name="fullName" required minlength="3" maxlength="50" class="mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 focus:border-indigo-600 focus:ring-indigo-600 sm:text-sm" placeholder="John Doe"/>
          </div>
          <div>
            <label for="email" class="block text-sm font-medium text-gray-700">Email</label>
            <input type="email" id="email" name="email" required class="mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 focus:border-indigo-600 focus:ring-indigo-600 sm:text-sm" placeholder="you@example.com"/>
          </div>
          <div>
            <label for="phone" class="block text-sm font-medium text-gray-700">Phone (10 digits)</label>
            <input type="tel" id="phone" name="phone" pattern="^\d{10}$" required class="mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 focus:border-indigo-600 focus:ring-indigo-600 sm:text-sm" placeholder="1234567890" inputmode="numeric"/>
          </div>
          <div>
            <label for="age" class="block text-sm font-medium text-gray-700">Age (18-60)</label>
            <input type="number" id="age" name="age" min="18" max="60" required class="mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 focus:border-indigo-600 focus:ring-indigo-600 sm:text-sm" placeholder="25"/>
          </div>
          <div class="sm:col-span-2">
            <span class="block text-sm font-medium text-gray-700 mb-1">Gender</span>
            <div class="flex items-center space-x-6">
              <label class="inline-flex items-center">
                <input type="checkbox" name="gender" value="Male" class="form-checkbox h-5 w-5 text-indigo-600" id="genderMale"/>
                <span class="ml-2 text-gray-700">Male</span>
              </label>
              <label class="inline-flex items-center">
                <input type="checkbox" name="gender" value="Female" class="form-checkbox h-5 w-5 text-indigo-600" id="genderFemale"/>
                <span class="ml-2 text-gray-700">Female</span>
              </label>
            </div>
          </div>
          <div class="sm:col-span-2">
            <label for="photoUpload" class="block text-sm font-medium text-gray-700">Upload Photo</label>
            <input type="file" id="photoUpload" name="photoUpload" accept="image/*" class="mt-1 block w-full text-gray-700 sm:text-sm"/>
            <img id="photoPreview" alt="Preview of uploaded user photo" class="mt-2 w-24 h-24 rounded-full object-cover border-2 border-indigo-600 hidden"/>
          </div>
          <div class="sm:col-span-2">
            <label for="signUpPassword" class="block text-sm font-medium text-gray-700">Password</label>
            <input type="password" id="signUpPassword" name="signUpPassword" required minlength="6" class="mt-1 block w-full rounded-md border border-gray-300 px-3 py-2 focus:border-indigo-600 focus:ring-indigo-600 sm:text-sm" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢"/>
          </div>
        </div>
        <div class="flex justify-between items-center text-sm">
          <button type="button" id="openLoginFromSignUp" class="text-indigo-600 hover:text-indigo-800 focus:outline-none">Already have an account? Login</button>
          <button type="submit" class="inline-flex justify-center rounded-md border border-transparent bg-indigo-600 px-4 py-2 text-white font-semibold hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">Sign Up</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Toast Container -->
  <div id="toastContainer" aria-live="polite" aria-atomic="true"></div>

  <script>
    // Elements
    const sidebarToggle = document.getElementById('sidebarToggle');
    const sidebar = document.getElementById('sidebar');
    const sidebarOverlay = document.getElementById('sidebarOverlay');
    const profileBtn = document.getElementById('profileBtn');
    const profileDropdown = document.getElementById('profileDropdown');
    const navButtons = document.querySelectorAll('.nav-btn');
    const sidebarButtons = document.querySelectorAll('.sidebar-btn');
    const downsideSections = ['home', 'events', 'news', 'dashboard', 'gallery'];
    const sidebarSections = ['sidebar-profile', 'sidebar-account', 'sidebar-members', 'sidebar-about'];

    const joinWhatsappBtn = document.getElementById('joinWhatsappBtn');
    const logoutBtnSidebar = document.getElementById('logoutBtn');
    const joinWhatsappModal = document.getElementById('joinWhatsappModal');
    const logoutModal = document.getElementById('logoutModal');
    const joinWhatsappCancel = document.getElementById('joinWhatsappCancel');
    const logoutCancel = document.getElementById('logoutCancel');
    const logoutConfirm = document.getElementById('logoutConfirm');

    const notificationContainer = document.getElementById('notificationContainer');
    const notificationBtn = document.getElementById('notificationBtn');
    const notificationDropdown = document.getElementById('notificationDropdown');
    const clearNotificationsBtn = document.getElementById('clearNotificationsBtn');
    const notificationCount = document.getElementById('notificationCount');
    const notificationList = document.getElementById('notificationList');
    const noNotifications = document.getElementById('noNotifications');

    const loginModal = document.getElementById('loginModal');
    const signUpModal = document.getElementById('signUpModal');
    const loginForm = document.getElementById('loginForm');
    const signUpForm = document.getElementById('signUpForm');
    const forgotPasswordBtn = document.getElementById('forgotPasswordBtn');
    const openSignUpFromLogin = document.getElementById('openSignUpFromLogin');
    const openLoginFromSignUp = document.getElementById('openLoginFromSignUp');
    const photoUpload = document.getElementById('photoUpload');
    const photoPreview = document.getElementById('photoPreview');

    const headerProfilePhoto = document.getElementById('headerProfilePhoto');
    const profilePhotoThumbnail = document.getElementById('profilePhotoThumbnail');
    const usernameLink = document.getElementById('usernameLink');
    const sidebarLogoutLi = document.getElementById('sidebarLogoutLi');
    const sidebarLoginLi = document.getElementById('sidebarLoginLi');
    const sidebarLoginBtn = document.getElementById('sidebarLoginBtn');

    const profileDropdownProfile = document.getElementById('profileDropdownProfile');
    const profileDropdownDashboard = document.getElementById('profileDropdownDashboard');
    const profileDropdownExport = document.getElementById('profileDropdownExport');
    const profileDropdownViewProfile = document.getElementById('profileDropdownViewProfile');
    const profileDropdownDelete = document.getElementById('profileDropdownDelete');
    const profileDropdownLogout = document.getElementById('profileDropdownLogout');

    // Profile section elements
    const profileFullName = document.getElementById('profileFullName');
    const profileEmail = document.getElementById('profileEmail');
    const profileAge = document.getElementById('profileAge');
    const profileGender = document.getElementById('profileGender');
    const profileMemberSince = document.getElementById('profileMemberSince');
    const completionPercent = document.getElementById('completionPercent');
    const profileStrength = document.getElementById('profileStrength');
    const profileInfoName = document.getElementById('profileInfoName');
    const profileInfoEmail = document.getElementById('profileInfoEmail');
    const profileInfoPhone = document.getElementById('profileInfoPhone');
    const profileInfoGender = document.getElementById('profileInfoGender');

    // Edit profile elements
    const editNameBtn = document.getElementById('editNameBtn');
    const saveNameBtn = document.getElementById('saveNameBtn');
    const cancelNameBtn = document.getElementById('cancelNameBtn');
    const editNameInput = document.getElementById('editNameInput');
    
    const editPhoneBtn = document.getElementById('editPhoneBtn');
    const savePhoneBtn = document.getElementById('savePhoneBtn');
    const cancelPhoneBtn = document.getElementById('cancelPhoneBtn');
    const editPhoneInput = document.getElementById('editPhoneInput');
    
    const editGenderBtn = document.getElementById('editGenderBtn');
    const saveGenderBtn = document.getElementById('saveGenderBtn');
    const cancelGenderBtn = document.getElementById('cancelGenderBtn');
    const editGenderInput = document.getElementById('editGenderInput');
    const editGenderCheckboxes = document.querySelectorAll('input[name="editGender"]');

    // Photo edit elements
    const profilePhotoEditPreview = document.getElementById('profilePhotoEditPreview');
    const profilePhotoUpload = document.getElementById('profilePhotoUpload');
    const editPhotoBtn = document.getElementById('editPhotoBtn');
    const savePhotoBtn = document.getElementById('savePhotoBtn');
    const cancelPhotoBtn = document.getElementById('cancelPhotoBtn');

    // Account section elements
    const exportDataBtn = document.getElementById('exportDataBtn');
    const viewProfileBtn = document.getElementById('viewProfileBtn');
    const deleteAccountBtn = document.getElementById('deleteAccountBtn');
    const deleteAccountModal = document.getElementById('deleteAccountModal');
    const deleteAccountCancel = document.getElementById('deleteAccountCancel');
    const deleteAccountConfirm = document.getElementById('deleteAccountConfirm');

    const toastContainer = document.getElementById('toastContainer');

    // Constants
    const STORAGE_KEY = 'myapp_user_data';
    const NOTIF_STORAGE_KEY = 'myapp_notifications';
    const STORAGE_EXPIRY_DAYS = 150;

    // Utility Functions
    function showSidebar() {
      sidebar.classList.remove('-translate-x-full');
      sidebarOverlay.classList.add('active');
    }
    function hideSidebar() {
      sidebar.classList.add('-translate-x-full');
      sidebarOverlay.classList.remove('active');
    }
    function hidePopups() {
      joinWhatsappModal.classList.add('hidden');
      logoutModal.classList.add('hidden');
      loginModal.classList.add('hidden');
      signUpModal.classList.add('hidden');
      deleteAccountModal.classList.add('hidden');
      joinWhatsappModal.classList.remove('opacity-100');
      logoutModal.classList.remove('opacity-100');
      loginModal.classList.remove('opacity-100');
      signUpModal.classList.remove('opacity-100');
      deleteAccountModal.classList.remove('opacity-100');
    }
    function hideAll() {
      hideSidebar();
      hidePopups();
      profileDropdown.classList.add('hidden');
      profileDropdown.classList.remove('opacity-100', 'scale-100');
      profileBtn.setAttribute('aria-expanded', 'false');
      notificationDropdown.classList.add('hidden');
      notificationDropdown.classList.remove('opacity-100', 'scale-100');
      notificationBtn.setAttribute('aria-expanded', 'false');
    }
    function showPopup(modal) {
      hideSidebar();
      hidePopups();
      profileDropdown.classList.add('hidden');
      profileDropdown.classList.remove('opacity-100', 'scale-100');
      profileBtn.setAttribute('aria-expanded', 'false');
      notificationDropdown.classList.add('hidden');
      notificationDropdown.classList.remove('opacity-100', 'scale-100');
      notificationBtn.setAttribute('aria-expanded', 'false');
      modal.classList.remove('hidden');
      setTimeout(() => {
        modal.classList.add('opacity-100');
      }, 10);
    }
    function hidePopup(modal) {
      modal.classList.remove('opacity-100');
      setTimeout(() => {
        modal.classList.add('hidden');
      }, 200);
    }
    function toast(message, type = 'info') {
      const colors = {
        info: 'bg-blue-600',
        success: 'bg-green-600',
        error: 'bg-red-600',
        warning: 'bg-yellow-600',
      };
      const iconClasses = {
        info: 'fas fa-info-circle',
        success: 'fas fa-check-circle',
        error: 'fas fa-exclamation-circle',
        warning: 'fas fa-exclamation-triangle',
      };
      const toastEl = document.createElement('div');
      toastEl.className = `flex items-center text-white px-4 py-2 rounded-lg shadow-lg ${colors[type]} animate-fadeinout`;
      toastEl.style.animation = 'fadeinout 4s forwards';
      toastEl.innerHTML = `<i class="${iconClasses[type]} mr-2"></i><span>${message}</span>`;
      toastContainer.appendChild(toastEl);
      setTimeout(() => {
        toastEl.remove();
      }, 4000);
    }
    // Animation keyframes for toast
    const styleSheet = document.createElement("style");
    styleSheet.type = "text/css";
    styleSheet.innerText = `
      @keyframes fadeinout {
        0% {opacity: 0; transform: translateY(20px);}
        10% {opacity: 1; transform: translateY(0);}
        90% {opacity: 1; transform: translateY(0);}
        100% {opacity: 0; transform: translateY(20px);}
      }
    `;
    document.head.appendChild(styleSheet);

    // Local Storage Helpers with expiry
    function setWithExpiry(key, value, days) {
      const now = new Date();
      const item = {
        value: value,
        expiry: now.getTime() + days*24*60*60*1000,
      };
      localStorage.setItem(key, JSON.stringify(item));
    }
    function getWithExpiry(key) {
      const itemStr = localStorage.getItem(key);
      if (!itemStr) return null;
      try {
        const item = JSON.parse(itemStr);
        const now = new Date();
        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key);
          return null;
        }
        return item.value;
      } catch {
        localStorage.removeItem(key);
        return null;
      }
    }
    function removeItem(key) {
      localStorage.removeItem(key);
    }

    // User Data Management
    function saveUserData(userData) {
      setWithExpiry(STORAGE_KEY, userData, STORAGE_EXPIRY_DAYS);
      // Also update familyAppUsername for home welcome
      if(userData.fullName){
        const shortName = userData.fullName.trim().substring(0,8);
        localStorage.setItem('familyAppUsername', shortName);
        const usernameDisplay = document.getElementById('usernameDisplay');
        if(usernameDisplay) usernameDisplay.textContent = shortName;
      }
    }
    function getUserData() {
      return getWithExpiry(STORAGE_KEY);
    }
    function clearUserData() {
      removeItem(STORAGE_KEY);
      localStorage.removeItem('familyAppUsername');
      const usernameDisplay = document.getElementById('usernameDisplay');
      if(usernameDisplay) usernameDisplay.textContent = "Guest";
    }

    // Notifications Management
    function saveNotifications(notifs) {
      setWithExpiry(NOTIF_STORAGE_KEY, notifs, STORAGE_EXPIRY_DAYS);
    }
    function getNotifications() {
      return getWithExpiry(NOTIF_STORAGE_KEY) || [];
    }
    function clearNotifications() {
      saveNotifications([]);
    }

    // Update notification UI
    function updateNotificationUI() {
      const notifs = getNotifications();
      notificationList.innerHTML = '';
      if (notifs.length === 0) {
        noNotifications.classList.remove('hidden');
        notificationCount.style.display = 'none';
      } else {
        noNotifications.classList.add('hidden');
        notificationCount.style.display = 'flex';
        notificationCount.textContent = notifs.length;
        notifs.forEach((notif, idx) => {
          const li = document.createElement('li');
          li.className = 'px-4 py-3 hover:bg-gray-50 cursor-pointer flex flex-col';
          li.tabIndex = 0;
          li.setAttribute('role', 'menuitem');
          li.innerHTML = `
            <p class="text-gray-700 text-sm">${notif.message}</p>
            <span class="text-xs text-gray-400">${notif.time}</span>
          `;
          li.addEventListener('click', () => {
            // If notification has a link, navigate to that section
            if (notif.link === 'home') {
              showSection('home');
              hideAll();
            } else if (notif.link === 'profile') {
              showSidebarSection('sidebar-profile');
              hideAll();
            } else if (notif.link === 'upload') {
              const user = getUserData();
              if (user) {
                showSidebarSection('sidebar-profile');
                hideAll();
              } else {
                showPopup(loginModal);
              }
            }
          });
          notificationList.appendChild(li);
        });
      }
    }

    // Add notification
    function addNotification(message, link = null) {
      const notifs = getNotifications();
      const now = new Date();
      const timeStr = now.toLocaleString();
      notifs.unshift({message, time: timeStr, link});
      saveNotifications(notifs);
      updateNotificationUI();
    }

    // Show section helper
    function showSection(target) {
      const user = getUserData();
      
      // If trying to access restricted sections without login
      if (!user && target !== 'home') {
        showPopup(loginModal);
        toast('Please login to access this section', 'info');
        return;
      }
      
      downsideSections.forEach((section) => {
        const el = document.getElementById(section);
        if (section === target) {
          el.classList.remove('hidden');
        } else {
          el.classList.add('hidden');
        }
      });
      sidebarSections.forEach((section) => {
        const el = document.getElementById(section);
        el.classList.add('hidden');
      });
      // Update downside nav buttons active state
      navButtons.forEach((b) => {
        b.classList.remove('active', 'text-indigo-600', 'font-semibold');
        b.classList.add('text-gray-600');
      });
      const btn = [...navButtons].find(b => b.getAttribute('data-target') === target);
      if (btn) {
        btn.classList.add('active', 'text-indigo-600', 'font-semibold');
        btn.classList.remove('text-gray-600');
      }
      // Remove sidebar active states
      sidebarButtons.forEach((b) => {
        if (b.id !== 'joinWhatsappBtn' && b.id !== 'logoutBtn' && b.id !== 'sidebarLoginBtn') {
          b.classList.remove('bg-indigo-600', 'text-white');
          b.classList.add('text-gray-700', 'hover:bg-indigo-600', 'hover:text-white');
        }
      });
    }

    // Show sidebar section helper
    function showSidebarSection(target) {
      const user = getUserData();
      
      // If trying to access restricted sections without login
      if (!user && target !== 'sidebar-about') {
        showPopup(loginModal);
        toast('Please login to access this section', 'info');
        return;
      }
      
      sidebarSections.forEach((section) => {
        const el = document.getElementById(section);
        if (section === target) {
          el.classList.remove('hidden');
          
          // Update account greeting if showing account section
          if (section === 'sidebar-account' && user) {
            updateAccountGreeting();
          }
        } else {
          el.classList.add('hidden');
        }
      });
      downsideSections.forEach((section) => {
        const el = document.getElementById(section);
        el.classList.add('hidden');
      });
      // Update sidebar buttons active state
      sidebarButtons.forEach((b) => {
        if (b.id !== 'joinWhatsappBtn' && b.id !== 'logoutBtn' && b.id !== 'sidebarLoginBtn') {
          b.classList.remove('bg-indigo-600', 'text-white');
          b.classList.add('text-gray-700', 'hover:bg-indigo-600', 'hover:text-white');
        }
      });
      const btn = [...sidebarButtons].find(b => b.getAttribute('data-target') === target);
      if (btn) {
        btn.classList.add('bg-indigo-600', 'text-white');
        btn.classList.remove('text-gray-700', 'hover:bg-indigo-600', 'hover:text-white');
      }
      hideSidebar();
    }

    // Update account greeting based on time of day
    function updateAccountGreeting() {
      const user = getUserData();
      if (!user) return;
      
      const now = new Date();
      const hour = now.getHours();
      let greeting = 'Hello';
      
      if (hour < 12) {
        greeting = 'Good morning';
      } else if (hour < 18) {
        greeting = 'Good afternoon';
      } else {
        greeting = 'Good evening';
      }
      
      const accountSection = document.getElementById('sidebar-account');
      if(accountSection){
        let greetingEl = accountSection.querySelector('#accountGreeting');
        if(!greetingEl){
          greetingEl = document.createElement('p');
          greetingEl.id = 'accountGreeting';
          greetingEl.className = 'mb-4 text-lg font-semibold text-red-600';
          accountSection.prepend(greetingEl);
        }
        greetingEl.textContent = `${greeting}, ${user.fullName.split(' ')[0]}! Welcome to your account section.`;
      }
    }

    // Update profile UI with user data
    function updateProfileUI(user) {
      if (!user) {
        // Clear profile
        profilePhotoThumbnail.src = "https://placehold.co/80x80/png?text=User+Icon";
        headerProfilePhoto.src = "https://placehold.co/80x80/png?text=User+Icon";
        sidebarLoginLi.classList.remove('hidden');
        sidebarLogoutLi.classList.add('hidden');
        profileDropdownProfile.classList.add('hidden');
        profileDropdownDashboard.classList.add('hidden');
        profileDropdownExport.classList.add('hidden');
        profileDropdownViewProfile.classList.add('hidden');
        profileDropdownDelete.classList.add('hidden');
        profileDropdownLogout.classList.add('hidden');
        notificationContainer.classList.add('hidden');
        
        // Clear profile section
        profileFullName.textContent = "Guest User";
        profileEmail.textContent = "guest@example.com";
        profileAge.textContent = "--";
        profileGender.textContent = "--";
        profileMemberSince.textContent = "--";
        profileInfoName.textContent = "--";
        profileInfoEmail.textContent = "--";
        profileInfoPhone.textContent = "--";
        profileInfoGender.textContent = "--";
        completionPercent.textContent = "0%";
        profileStrength.textContent = "Low";
        updateProgressRing(0);
        profilePhotoEditPreview.src = "https://placehold.co/80x80/png?text=User+Icon";
        return;
      }
      
      // Update profile photo
      if (user.photo) {
        profilePhotoThumbnail.src = user.photo;
        headerProfilePhoto.src = user.photo;
        profilePhotoEditPreview.src = user.photo;
      } else {
        profilePhotoThumbnail.src = "https://placehold.co/80x80/png?text=User+Icon";
        headerProfilePhoto.src = "https://placehold.co/80x80/png?text=User+Icon";
        profilePhotoEditPreview.src = "https://placehold.co/80x80/png?text=User+Icon";
        
        // Add notification to upload photo if not already shown
        const notifs = getNotifications();
        const hasPhotoNotification = notifs.some(n => n.message.includes('Upload a profile photo'));
        if (!hasPhotoNotification) {
          addNotification('Upload a profile photo to make your account more attractive', 'upload');
        }
      }
      
      // Update profile section
      profileFullName.textContent = user.fullName || "--";
      profileEmail.textContent = user.email || "--";
      profileAge.textContent = user.age || "--";
      profileGender.textContent = user.gender || "--";
      profileInfoName.textContent = user.fullName || "--";
      profileInfoEmail.textContent = user.email || "--";
      profileInfoPhone.textContent = user.phone || "--";
      profileInfoGender.textContent = user.gender || "--";
      
      // Set member since date
      const now = new Date();
      profileMemberSince.textContent = now.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
      
      // Calculate profile completion percentage
      let completion = 0;
      if (user.fullName) completion += 20;
      if (user.email) completion += 20;
      if (user.phone) completion += 20;
      if (user.age) completion += 20;
      if (user.gender) completion += 20;
      
      completionPercent.textContent = `${completion}%`;
      profileStrength.textContent = completion < 40 ? "Low" : completion < 80 ? "Medium" : "High";
      updateProgressRing(completion);
      
      // Show logout button in sidebar and profile dropdown
      sidebarLoginLi.classList.add('hidden');
      sidebarLogoutLi.classList.remove('hidden');
      profileDropdownProfile.classList.remove('hidden');
      profileDropdownDashboard.classList.remove('hidden');
      profileDropdownExport.classList.remove('hidden');
      profileDropdownViewProfile.classList.remove('hidden');
      profileDropdownDelete.classList.remove('hidden');
      profileDropdownLogout.classList.remove('hidden');
      notificationContainer.classList.remove('hidden');
    }

    // Update progress ring visualization
    function updateProgressRing(percent) {
      const circle = document.querySelector('.progress-ring-circle');
      const radius = 45;
      const circumference = 2 * Math.PI * radius;
      const offset = circumference - (percent / 100) * circumference;
      circle.style.strokeDasharray = circumference;
      circle.style.strokeDashoffset = offset;
    }

    // Export user data as PDF
    async function exportUserData() {
      const user = getUserData();
      if (!user) {
        toast('No user data to export', 'error');
        return;
      }

      try {
        // Create a temporary div to hold the export content
        const exportContent = document.createElement('div');
        exportContent.className = 'p-6 bg-white rounded-lg shadow-sm';
        exportContent.style.position = 'absolute';
        exportContent.style.left = '-9999px';
        
        // Add content to the export div
        exportContent.innerHTML = `
          <h2 class="text-2xl font-bold mb-4 text-indigo-700">User Data Export</h2>
          <div class="flex items-center space-x-4 mb-6">
            ${user.photo ? `<img src="${user.photo}" alt="Profile photo" class="w-20 h-20 rounded-full object-cover border-2 border-indigo-200">` : ''}
            <div>
              <h3 class="text-xl font-semibold">${user.fullName || 'No name'}</h3>
              <p class="text-gray-600">${user.email || 'No email'}</p>
            </div>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-6">
            <div class="border border-gray-200 rounded-lg p-4">
              <h4 class="font-medium text-gray-900 mb-2">Personal Information</h4>
              <ul class="space-y-1">
                <li><span class="text-gray-600">Full Name:</span> ${user.fullName || '--'}</li>
                <li><span class="text-gray-600">Email:</span> ${user.email || '--'}</li>
                <li><span class="text-gray-600">Phone:</span> ${user.phone || '--'}</li>
                <li><span class="text-gray-600">Age:</span> ${user.age || '--'}</li>
                <li><span class="text-gray-600">Gender:</span> ${user.gender || '--'}</li>
              </ul>
            </div>
            <div class="border border-gray-200 rounded-lg p-4">
              <h4 class="font-medium text-gray-900 mb-2">Account Information</h4>
              <ul class="space-y-1">
                <li><span class="text-gray-600">Member Since:</span> ${new Date().toLocaleDateString('en-US', { month: 'short', year: 'numeric' })}</li>
                <li><span class="text-gray-600">Profile Completion:</span> ${Math.floor((completionPercent.textContent || '0').replace('%', ''))}%</li>
              </ul>
            </div>
          </div>
          <div class="text-xs text-gray-500 mt-6">
            <p>Exported on ${new Date().toLocaleString()}</p>
          </div>
        `;
        
        // Append to body and generate PDF
        document.body.appendChild(exportContent);
        
        // Use html2canvas to capture the content
        const canvas = await html2canvas(exportContent, {
          scale: 2,
          logging: false,
          useCORS: true,
          allowTaint: true
        });
        
        // Remove the temporary div
        document.body.removeChild(exportContent);
        
        // Create PDF
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF('p', 'mm', 'a4');
        const imgData = canvas.toDataURL('image/png');
        const pdfWidth = pdf.internal.pageSize.getWidth();
        const pdfHeight = (canvas.height * pdfWidth) / canvas.width;
        
        pdf.addImage(imgData, 'PNG', 0, 0, pdfWidth, pdfHeight);
        pdf.save(`user_data_${user.fullName || 'export'}.pdf`);
        
        toast('Data exported successfully!', 'success');
      } catch (error) {
        console.error('Export failed:', error);
        toast('Failed to export data', 'error');
      }
    }

    // Show profile data in table
    function showProfileTable() {
      const user = getUserData();
      if (!user) {
        toast('No user data to display', 'error');
        return;
      }
      const profileTableContainer = document.getElementById('profileTableContainer');
      const profileTableBody = document.getElementById('profileTableBody');
      profileTableBody.innerHTML = '';
      const fields = [
        { label: 'Full Name', value: user.fullName || '--' },
        { label: 'Email', value: user.email || '--' },
        { label: 'Phone', value: user.phone || '--' },
        { label: 'Age', value: user.age || '--' },
        { label: 'Gender', value: user.gender || '--' },
        { label: 'Member Since', value: new Date().toLocaleDateString('en-US', { month: 'short', year: 'numeric' }) },
        { label: 'Profile Completion', value: completionPercent.textContent || '0%' }
      ];
      fields.forEach(field => {
        const tr = document.createElement('tr');
        tr.className = 'border-b border-gray-200';
        tr.innerHTML = `
          <td class="px-6 py-3 whitespace-nowrap text-sm font-medium text-gray-900">${field.label}</td>
          <td class="px-6 py-3 whitespace-nowrap text-sm text-gray-700">${field.value}</td>
        `;
        profileTableBody.appendChild(tr);
      });
      profileTableContainer.classList.remove('hidden');
    }

    // Setup edit functionality for profile fields
    function setupProfileEditing() {
      // Name editing
      editNameBtn.addEventListener('click', () => {
        profileInfoName.classList.add('hidden');
        editNameInput.classList.remove('hidden');
        editNameInput.value = profileInfoName.textContent;
        editNameBtn.classList.add('hidden');
        saveNameBtn.classList.remove('hidden');
        cancelNameBtn.classList.remove('hidden');
      });
      
      saveNameBtn.addEventListener('click', () => {
        const newName = editNameInput.value.trim();
        if (newName.length < 3) {
          toast('Name must be at least 3 characters', 'error');
          return;
        }
        
        const user = getUserData();
        user.fullName = newName;
        saveUserData(user);
        
        profileInfoName.textContent = newName;
        profileInfoName.classList.remove('hidden');
        editNameInput.classList.add('hidden');
        editNameBtn.classList.remove('hidden');
        saveNameBtn.classList.add('hidden');
        cancelNameBtn.classList.add('hidden');
        
        // Update other name displays
        profileFullName.textContent = newName;
        
        addNotification('Profile updated successfully', 'profile');
        toast('Name updated successfully!', 'success');
        updateProfileUI(user);
      });
      
      cancelNameBtn.addEventListener('click', () => {
        profileInfoName.classList.remove('hidden');
        editNameInput.classList.add('hidden');
        editNameBtn.classList.remove('hidden');
        saveNameBtn.classList.add('hidden');
        cancelNameBtn.classList.add('hidden');
      });
      
      // Phone editing
      editPhoneBtn.addEventListener('click', () => {
        profileInfoPhone.classList.add('hidden');
        editPhoneInput.classList.remove('hidden');
        editPhoneInput.value = profileInfoPhone.textContent;
        editPhoneBtn.classList.add('hidden');
        savePhoneBtn.classList.remove('hidden');
        cancelPhoneBtn.classList.remove('hidden');
      });
      
      savePhoneBtn.addEventListener('click', () => {
        const newPhone = editPhoneInput.value.trim();
        if (!newPhone.match(/^\d{10}$/)) {
          toast('Phone must be exactly 10 digits', 'error');
          return;
        }
        
        const user = getUserData();
        user.phone = newPhone;
        saveUserData(user);
        
        profileInfoPhone.textContent = newPhone;
        profileInfoPhone.classList.remove('hidden');
        editPhoneInput.classList.add('hidden');
        editPhoneBtn.classList.remove('hidden');
        savePhoneBtn.classList.add('hidden');
        cancelPhoneBtn.classList.add('hidden');
        
        addNotification('Phone number updated successfully', 'profile');
        toast('Phone number updated!', 'success');
        updateProfileUI(user);
      });
      
      cancelPhoneBtn.addEventListener('click', () => {
        profileInfoPhone.classList.remove('hidden');
        editPhoneInput.classList.add('hidden');
        editPhoneBtn.classList.remove('hidden');
        savePhoneBtn.classList.add('hidden');
        cancelPhoneBtn.classList.add('hidden');
      });
      
      // Gender editing
      editGenderBtn.addEventListener('click', () => {
        profileInfoGender.classList.add('hidden');
        editGenderInput.classList.remove('hidden');
        
        // Set current gender in checkboxes
        const currentGender = profileInfoGender.textContent;
        editGenderCheckboxes.forEach(cb => {
          cb.checked = cb.value === currentGender;
        });
        
        editGenderBtn.classList.add('hidden');
        saveGenderBtn.classList.remove('hidden');
        cancelGenderBtn.classList.remove('hidden');
      });
      
      saveGenderBtn.addEventListener('click', () => {
        const selectedGender = document.querySelector('input[name="editGender"]:checked');
        if (!selectedGender) {
          toast('Please select a gender', 'error');
          return;
        }
        
        const newGender = selectedGender.value;
        const user = getUserData();
        user.gender = newGender;
        saveUserData(user);
        
        profileInfoGender.textContent = newGender;
        profileInfoGender.classList.remove('hidden');
        editGenderInput.classList.add('hidden');
        editGenderBtn.classList.remove('hidden');
        saveGenderBtn.classList.add('hidden');
        cancelGenderBtn.classList.add('hidden');
        
        // Update other gender displays
        profileGender.textContent = newGender;
        
        addNotification('Gender updated successfully', 'profile');
        toast('Gender updated!', 'success');
        updateProfileUI(user);
      });
      
      cancelGenderBtn.addEventListener('click', () => {
        profileInfoGender.classList.remove('hidden');
        editGenderInput.classList.add('hidden');
        editGenderBtn.classList.remove('hidden');
        saveGenderBtn.classList.add('hidden');
        cancelGenderBtn.classList.add('hidden');
      });
      
      // Gender checkbox behavior
      editGenderCheckboxes.forEach(cb => {
        cb.addEventListener('change', function() {
          if (this.checked) {
            editGenderCheckboxes.forEach(other => {
              if (other !== this) other.checked = false;
            });
          }
        });
      });

      // Photo editing
      editPhotoBtn.addEventListener('click', () => {
        profilePhotoUpload.click();
      });

      profilePhotoUpload.addEventListener('change', async () => {
        const file = profilePhotoUpload.files[0];
        if (file) {
          if (!file.type.startsWith('image/')) {
            toast('Please upload a valid image file', 'error');
            profilePhotoUpload.value = '';
            profilePhotoEditPreview.src = profilePhotoThumbnail.src || "https://placehold.co/80x80/png?text=User+Icon";
            return;
          }
          try {
            const base64 = await readPhotoFile(file);
            profilePhotoEditPreview.src = base64;
            savePhotoBtn.classList.remove('hidden');
            cancelPhotoBtn.classList.remove('hidden');
            editPhotoBtn.classList.add('hidden');
          } catch {
            toast('Failed to read image file', 'error');
            profilePhotoUpload.value = '';
            profilePhotoEditPreview.src = profilePhotoThumbnail.src || "https://placehold.co/80x80/png?text=User+Icon";
          }
        }
      });

      savePhotoBtn.addEventListener('click', () => {
        const file = profilePhotoUpload.files[0];
        if (!file) {
          toast('No photo selected', 'error');
          return;
        }
        readPhotoFile(file).then(base64 => {
          const user = getUserData();
          user.photo = base64;
          saveUserData(user);
          updateProfileUI(user);
          toast('Profile photo updated!', 'success');
          savePhotoBtn.classList.add('hidden');
          cancelPhotoBtn.classList.add('hidden');
          editPhotoBtn.classList.remove('hidden');
          profilePhotoUpload.value = '';
        }).catch(() => {
          toast('Failed to update photo', 'error');
        });
      });

      cancelPhotoBtn.addEventListener('click', () => {
        profilePhotoEditPreview.src = profilePhotoThumbnail.src || "https://placehold.co/80x80/png?text=User+Icon";
        profilePhotoUpload.value = '';
        savePhotoBtn.classList.add('hidden');
        cancelPhotoBtn.classList.add('hidden');
        editPhotoBtn.classList.remove('hidden');
      });
    }

    // Read photo file as base64 string
    function readPhotoFile(file) {
      return new Promise((resolve, reject) => {
        const reader = new FileReader();
        reader.onload = () => resolve(reader.result);
        reader.onerror = () => reject(new Error('Failed to read file'));
        reader.readAsDataURL(file);
      });
    }

    // Initialize app state
    function init() {
      // Load user data from storage
      const user = getUserData();
      updateProfileUI(user);
      updateNotificationUI();
      setupProfileEditing();
      setupGenderCheckboxes();

      // Show home section by default
      showSection('home');
    }

    // Event Listeners

    // Sidebar toggle
    sidebarToggle.addEventListener('click', (e) => {
      e.stopPropagation();
      const isSidebarHidden = sidebar.classList.contains('-translate-x-full');
      if (isSidebarHidden) {
        hidePopups();
        profileDropdown.classList.add('hidden');
        profileBtn.setAttribute('aria-expanded', 'false');
        notificationDropdown.classList.add('hidden');
        notificationBtn.setAttribute('aria-expanded', 'false');
        showSidebar();
      } else {
        hideSidebar();
      }
    });

    // Sidebar login button click
    sidebarLoginBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      showPopup(loginModal);
    });

    // Profile dropdown toggle
    profileBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      const user = getUserData();
      if(!user){
        showPopup(loginModal);
        return;
      }
      const isHidden = profileDropdown.classList.contains('hidden');
      if (isHidden) {
        hideSidebar();
        hidePopups();
        notificationDropdown.classList.add('hidden');
        notificationBtn.setAttribute('aria-expanded', 'false');
        profileDropdown.classList.remove('hidden');
        profileBtn.setAttribute('aria-expanded', 'true');
        setTimeout(() => {
          profileDropdown.classList.add('opacity-100', 'scale-100');
        }, 10);
      } else {
        profileDropdown.classList.remove('opacity-100', 'scale-100');
        setTimeout(() => {
          profileDropdown.classList.add('hidden');
        }, 150);
        profileBtn.setAttribute('aria-expanded', 'false');
      }
    });

    // Notification dropdown toggle
    notificationBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      const isHidden = notificationDropdown.classList.contains('hidden');
      if (isHidden) {
        hideSidebar();
        hidePopups();
        profileDropdown.classList.add('hidden');
        profileBtn.setAttribute('aria-expanded', 'false');
        notificationDropdown.classList.remove('hidden');
        notificationBtn.setAttribute('aria-expanded', 'true');
        setTimeout(() => {
          notificationDropdown.classList.add('opacity-100', 'scale-100');
        }, 10);
      } else {
        notificationDropdown.classList.remove('opacity-100', 'scale-100');
        setTimeout(() => {
          notificationDropdown.classList.add('hidden');
        }, 150);
        notificationBtn.setAttribute('aria-expanded', 'false');
      }
    });

    // Clear all notifications
    clearNotificationsBtn.addEventListener('click', () => {
      clearNotifications();
      updateNotificationUI();
      toast('Cleared all notifications', 'success');
    });

    // Close dropdowns if clicked outside
    window.addEventListener('click', () => {
      hideAll();
    });

    // Prevent clicks inside sidebar, dropdown, and modals from closing them
    sidebar.addEventListener('click', (e) => {
      e.stopPropagation();
    });
    profileDropdown.addEventListener('click', (e) => {
      e.stopPropagation();
    });
    notificationDropdown.addEventListener('click', (e) => {
      e.stopPropagation();
    });
    joinWhatsappModal.addEventListener('click', (e) => {
      e.stopPropagation();
    });
    logoutModal.addEventListener('click', (e) => {
      e.stopPropagation();
    });
    loginModal.addEventListener('click', (e) => {
      e.stopPropagation();
    });
    signUpModal.addEventListener('click', (e) => {
      e.stopPropagation();
    });
    deleteAccountModal.addEventListener('click', (e) => {
      e.stopPropagation();
    });
    sidebarOverlay.addEventListener('click', () => {
      hideSidebar();
    });

    // Navigation buttons click handler (Downside Navbar)
    navButtons.forEach((btn) => {
      btn.addEventListener('click', () => {
        const target = btn.getAttribute('data-target');
        showSection(target);
        hideAll();
      });
    });

    // Sidebar buttons click handler (except join WhatsApp and logout)
    sidebarButtons.forEach((btn) => {
      if (btn.id === 'joinWhatsappBtn' || btn.id === 'logoutBtn' || btn.id === 'sidebarLoginBtn') return;
      btn.addEventListener('click', () => {
        const target = btn.getAttribute('data-target');
        showSidebarSection(target);
      });
    });

    // Join WhatsApp button click
    joinWhatsappBtn.addEventListener('click', (e) => {
      e.stopPropagation();
      const user = getUserData();
      if (!user) {
        showPopup(loginModal);
        toast('Please login to join WhatsApp group', 'info');
        return;
      }
      showPopup(joinWhatsappModal);
    });
    joinWhatsappCancel.addEventListener('click', () => {
      hidePopup(joinWhatsappModal);
    });

    // Logout button click (sidebar)
    logoutBtnSidebar.addEventListener('click', (e) => {
      e.stopPropagation();
      const user = getUserData();
      if(user && user.photo){
        document.getElementById('logoutProfilePhoto').src = user.photo;
      } else {
        document.getElementById('logoutProfilePhoto').src = "https://placehold.co/80x80/png?text=User+Icon";
      }
      showPopup(logoutModal);
    });
    // Logout button click (profile dropdown)
    profileDropdownLogout.addEventListener('click', (e) => {
      e.stopPropagation();
      const user = getUserData();
      if(user && user.photo){
        document.getElementById('logoutProfilePhoto').src = user.photo;
      } else {
        document.getElementById('logoutProfilePhoto').src = "https://placehold.co/80x80/png?text=User+Icon";
      }
      showPopup(logoutModal);
      profileDropdown.classList.add('hidden');
      profileDropdown.classList.remove('opacity-100', 'scale-100');
      profileBtn.setAttribute('aria-expanded', 'false');
    });

    logoutCancel.addEventListener('click', () => {
      hidePopup(logoutModal);
    });

    logoutConfirm.addEventListener('click', () => {
      hidePopup(logoutModal);
      clearUserData();
      updateProfileUI(null);
      showSection('home');
      toast('Successfully logged out!', 'success');
    });

    // Profile dropdown profile button click
    profileDropdownProfile.addEventListener('click', () => {
      showSidebarSection('sidebar-profile');
      hideAll();
    });
    // Profile dropdown dashboard button click
    profileDropdownDashboard.addEventListener('click', () => {
      showSection('dashboard');
      hideAll();
    });
    // Profile dropdown export button click
    profileDropdownExport.addEventListener('click', () => {
      exportUserData();
      hideAll();
    });
    // Profile dropdown view profile button click
    profileDropdownViewProfile.addEventListener('click', () => {
      showSidebarSection('sidebar-account');
      // Show profile table
      showProfileTable();
      hideAll();
    });
    // Profile dropdown delete button click
    profileDropdownDelete.addEventListener('click', () => {
      const user = getUserData();
      if(user && user.photo){
        document.getElementById('deleteProfilePhoto').src = user.photo;
      } else {
        document.getElementById('deleteProfilePhoto').src = "https://placehold.co/80x80/png?text=User+Icon";
      }
      showPopup(deleteAccountModal);
      hideAll();
    });

    // Export data button click
    exportDataBtn.addEventListener('click', () => {
      exportUserData();
    });

    // View profile button click
    viewProfileBtn.addEventListener('click', () => {
      showProfileTable();
    });

    // Delete account button click
    deleteAccountBtn.addEventListener('click', () => {
      const user = getUserData();
      if(user && user.photo){
        document.getElementById('deleteProfilePhoto').src = user.photo;
      } else {
        document.getElementById('deleteProfilePhoto').src = "https://placehold.co/80x80/png?text=User+Icon";
      }
      showPopup(deleteAccountModal);
    });

    deleteAccountCancel.addEventListener('click', () => {
      hidePopup(deleteAccountModal);
    });

    deleteAccountConfirm.addEventListener('click', () => {
      hidePopup(deleteAccountModal);
      clearUserData();
      clearNotifications();
      updateProfileUI(null);
      showSection('home');
      toast('Account deleted successfully', 'success');
    });

    // Login modal form submit
    loginForm.addEventListener('submit', (e) => {
      e.preventDefault();
      const email = loginForm.loginEmail.value.trim().toLowerCase();
      const password = loginForm.loginPassword.value;
      if (!email || !password) {
        toast('Please enter email and password', 'error');
        return;
      }
      const user = getUserData();
      if (!user) {
        toast('No account found. Please sign up.', 'error');
        return;
      }
      if (user.email.toLowerCase() === email && user.password === password) {
        hidePopup(loginModal);
        updateProfileUI(user);
        addNotification(`Login success: Welcome ${user.fullName}`, 'profile');
        toast(`Welcome back, ${user.fullName.substring(0,8)}!`, 'success');
        showSection('home');
      } else {
        toast('Login failed: Invalid email or password', 'error');
      }
    });

    // Forgot password button click
    forgotPasswordBtn.addEventListener('click', () => {
      alert('Password recovery is not implemented in this demo.');
    });

    // Open sign up modal from login modal
    openSignUpFromLogin.addEventListener('click', () => {
      hidePopup(loginModal);
      showPopup(signUpModal);
    });

    // Open login modal from sign up modal
    openLoginFromSignUp.addEventListener('click', () => {
      hidePopup(signUpModal);
      showPopup(loginModal);
    });

    // Photo upload preview
    photoUpload.addEventListener('change', async () => {
      const file = photoUpload.files[0];
      if (file) {
        if (!file.type.startsWith('image/')) {
          toast('Please upload a valid image file', 'error');
          photoUpload.value = '';
          photoPreview.src = '';
          photoPreview.classList.add('hidden');
          return;
        }
        try {
          const base64 = await readPhotoFile(file);
          photoPreview.src = base64;
          photoPreview.classList.remove('hidden');
        } catch {
          toast('Failed to read image file', 'error');
          photoUpload.value = '';
          photoPreview.src = '';
          photoPreview.classList.add('hidden');
        }
      } else {
        photoPreview.src = '';
        photoPreview.classList.add('hidden');
      }
    });

    // Sign up form submit
    signUpForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const fullName = signUpForm.fullName.value.trim();
      const email = signUpForm.email.value.trim().toLowerCase();
      const phone = signUpForm.phone.value.trim();
      const age = parseInt(signUpForm.age.value, 10);
      const genderMale = document.getElementById('genderMale').checked;
      const genderFemale = document.getElementById('genderFemale').checked;
      const password = signUpForm.signUpPassword.value;
      let gender = '';
      if (genderMale) gender = 'Male';
      else if (genderFemale) gender = 'Female';

      // Validation
      if (!fullName || fullName.length < 3) {
        toast('Full name must be at least 3 characters', 'error');
        return;
      }
      if (!email || !email.includes('@')) {
        toast('Please enter a valid email', 'error');
        return;
      }
      if (!phone.match(/^\d{10}$/)) {
        toast('Phone must be exactly 10 digits', 'error');
        return;
      }
      if (isNaN(age) || age < 18 || age > 60) {
        toast('Age must be between 18 and 60', 'error');
        return;
      }
      if (!gender) {
        toast('Please select a gender', 'error');
        return;
      }
      if (!password || password.length < 6) {
        toast('Password must be at least 6 characters', 'error');
        return;
      }

      // Photo
      let photoBase64 = '';
      if (photoUpload.files.length > 0) {
        try {
          photoBase64 = await readPhotoFile(photoUpload.files[0]);
        } catch {
          toast('Failed to read uploaded photo', 'error');
          return;
        }
      }

      // Save user data
      const userData = {
        fullName,
        email,
        phone,
        age,
        gender,
        password,
        photo: photoBase64 || '',
      };
      saveUserData(userData);
      updateProfileUI(userData);
      hidePopup(signUpModal);
      addNotification('Account created successfully', 'home');
      toast('Account created successfully!', 'success');
      showSection('home');
      loginForm.reset();
      signUpForm.reset();
      photoPreview.src = '';
      photoPreview.classList.add('hidden');
    });

    // Initialize gender checkbox behavior
    function setupGenderCheckboxes() {
      const maleCheckbox = document.getElementById('genderMale');
      const femaleCheckbox = document.getElementById('genderFemale');
      maleCheckbox.addEventListener('change', () => {
        if (maleCheckbox.checked) femaleCheckbox.checked = false;
      });
      femaleCheckbox.addEventListener('change', () => {
        if (femaleCheckbox.checked) maleCheckbox.checked = false;
      });
    }

    // Initialize app on load
    window.addEventListener('load', () => {
      init();
    });
  </script>
</body>
</html>
